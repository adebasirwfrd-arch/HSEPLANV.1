<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HSE Plan Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --netflix-red: #C41E3A;
            --netflix-red-dark: #9A1830;
            --weatherford-red: #C41E3A;
            --bg-primary: #141414;
            --bg-secondary: #1F1F1F;
            --bg-tertiary: #2A2A2A;
            --text-primary: #FFFFFF;
            --text-secondary: #B3B3B3;
            --text-muted: #757575;
            --success: #46D369;
            --warning: #F5A623;
            --border: #333333;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ===== HEADER ===== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }

        .menu-btn {
            background: none;
            border: none;
            color: var(--netflix-red);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .create-btn {
            background: var(--netflix-red);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .create-btn:hover {
            background: var(--netflix-red-dark);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: var(--netflix-red);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
        }

        /* ===== SIDE DRAWER ===== */
        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .drawer-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .drawer {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background: var(--bg-secondary);
            z-index: 201;
            transition: left 0.3s ease, visibility 0.3s;
            display: flex;
            flex-direction: column;
            visibility: hidden;
            transform: translateX(-100%);
        }

        .drawer.active {
            left: 0;
            visibility: visible;
            transform: translateX(0);
        }

        .drawer-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .weatherford-logo {
            background: var(--netflix-red);
            padding: 10px 15px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .weatherford-logo span {
            font-size: 12px;
            font-weight: 600;
        }

        .drawer-close {
            background: none;
            border: none;
            color: var(--netflix-red);
            font-size: 24px;
            cursor: pointer;
        }

        .drawer-profile {
            text-align: center;
            padding: 20px;
        }

        .drawer-avatar {
            width: 70px;
            height: 70px;
            background: var(--netflix-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            margin: 0 auto 10px;
        }

        .drawer-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .drawer-email {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .drawer-nav {
            flex: 1;
            padding: 20px 0;
        }

        .drawer-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px 24px;
            color: var(--text-primary);
            text-decoration: none;
            cursor: pointer;
            transition: background 0.2s;
        }

        .drawer-item:hover {
            background: var(--bg-tertiary);
        }

        .drawer-item.active {
            color: var(--netflix-red);
        }

        .drawer-item svg {
            width: 22px;
            height: 22px;
        }

        .drawer-footer {
            padding: 20px;
            text-align: center;
            border-top: 1px solid var(--border);
        }

        .drawer-footer p {
            font-size: 12px;
            color: var(--text-muted);
        }


        /* ===== BOTTOM NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--bg-primary);
            display: flex;
            justify-content: flex-start;
            align-items: center;
            border-top: 1px solid var(--border);
            z-index: 100;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .bottom-nav::-webkit-scrollbar {
            display: none;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            padding: 6px 10px;
            min-width: 50px;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.2s;
            text-decoration: none;
            flex-shrink: 0;
        }

        .nav-item.active {
            color: var(--netflix-red);
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
        }

        .nav-item span {
            font-size: 9px;
            font-weight: 500;
        }

        /* ===== MAIN CONTENT ===== */
        .main {
            padding-top: 60px;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        .screen {
            display: none;
            padding: 20px 16px;
        }

        .screen.active {
            display: block;
        }

        /* ===== HOME SCREEN ===== */
        .home-logo {
            width: 80px;
            height: 80px;
            background: var(--netflix-red);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
        }

        .home-logo svg {
            width: 30px;
            height: 30px;
            margin-bottom: 4px;
        }

        .home-logo span {
            font-size: 10px;
            font-weight: 600;
        }

        .home-greeting {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--netflix-red);
        }

        .stat-card.success {
            border-left-color: var(--success);
        }

        .stat-card.warning {
            border-left-color: var(--warning);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* ===== PROJECTS/TASKS SCREEN ===== */
        .screen-tabs {
            display: flex;
            border-bottom: 2px solid var(--border);
            margin-bottom: 16px;
        }

        .screen-tab {
            padding: 12px 20px;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            font-weight: 500;
        }

        .screen-tab.active {
            color: var(--netflix-red);
            border-bottom-color: var(--netflix-red);
        }

        .status-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .status-dot {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .status-dot::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
        }

        .status-dot.active::before {
            background: var(--netflix-red);
        }

        .status-dot.active {
            background: var(--netflix-red);
            color: white;
        }

        .status-section {
            background: var(--netflix-red);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .status-section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .project-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .project-card:hover {
            transform: translateX(4px);
        }

        .project-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .project-card-title {
            font-size: 16px;
            font-weight: 600;
        }

        .project-card-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-upcoming {
            background: var(--warning);
            color: #000;
        }

        .badge-inprogress {
            background: var(--success);
        }

        .badge-ongoing {
            background: #17a2b8;
        }

        .badge-completed {
            background: #4A90D9;
        }

        .badge-onhold {
            background: #9B59B6;
        }

        .badge-canceled {
            background: var(--text-muted);
        }

        .project-card-meta {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* ===== FORM MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 300;
            display: none;
            flex-direction: column;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-header {
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 16px;
            border-bottom: 1px solid var(--border);
        }

        .modal-back {
            background: none;
            border: none;
            color: var(--netflix-red);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            margin-right: 16px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-label span {
            color: var(--netflix-red);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: var(--netflix-red);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .status-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .status-chip {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .status-chip.active {
            background: var(--netflix-red);
            border-color: var(--netflix-red);
            color: white;
        }

        .date-input-wrap {
            position: relative;
        }

        .date-input-wrap input {
            padding-right: 40px;
        }

        .date-input-wrap svg {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--netflix-red);
            width: 20px;
            height: 20px;
            pointer-events: none;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            padding: 16px;
            border-top: 1px solid var(--border);
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-cancel {
            background: transparent;
            border: 2px solid var(--netflix-red);
            color: var(--netflix-red);
        }

        .btn-save {
            background: var(--netflix-red);
            border: 2px solid var(--netflix-red);
            color: white;
        }

        .btn-save:hover {
            background: var(--netflix-red-dark);
        }

        /* ===== STATISTICS SCREEN ===== */
        .chart-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .progress-bar {
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            margin-bottom: 12px;
        }

        .progress-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* ===== TASK DETAIL MODAL ===== */
        .task-detail-content {
            padding: 20px;
        }

        .task-code {
            color: var(--netflix-red);
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .task-title-detail {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .task-category {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-top: 20px;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .upload-area:hover {
            border-color: var(--netflix-red);
        }

        .upload-area svg {
            width: 40px;
            height: 40px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .upload-area p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Hidden file input */
        input[type="file"] {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 767px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .modal-content,
            .drawer {
                width: 100%;
            }

            .status-filters {
                overflow-x: auto;
                padding-bottom: 8px;
                /* Hide scrollbar */
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            .status-filters::-webkit-scrollbar {
                display: none;
            }

            .screen {
                padding-bottom: 80px;
                /* Space for bottom nav if we had one, or just padding */
            }
        }

        @media (min-width: 768px) {
            .main {
                max-width: 800px;
                margin: 0 auto;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .modal-body {
                max-height: 70vh;
            }
        }

        /* Schedule Type Chips */
        .schedule-type-chip {
            padding: 10px 16px;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .schedule-type-chip:hover {
            background: var(--bg-hover);
        }

        .schedule-type-chip.active {
            background: rgba(196, 30, 58, 0.2);
            border-color: var(--netflix-red);
            color: var(--netflix-red);
        }

        /* ===== PREVIEW MODE ===== */
        body.preview-mode .hide-in-preview {
            display: none !important;
        }

        .preview-banner {
            display: none;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            text-align: center;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            z-index: 100;
        }

        body.preview-mode .preview-banner {
            display: block;
        }

        body.preview-mode .main {
            padding-top: 90px;
        }

        /* ===== ADMIN MODE ===== */
        /* Hide admin-only elements by default */
        .admin-only {
            display: none !important;
        }

        /* Show admin-only elements when admin mode is active */
        body.admin-mode .admin-only {
            display: flex !important;
        }

        /* Admin indicator badge */
        .admin-badge {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Delete button styles */
        .delete-btn {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-btn:hover {
            background: #e74c3c;
            color: white;
        }
    </style>
</head>

<!-- Header -->
<header class="header">
    <button class="menu-btn" onclick="toggleDrawer()">‚ò∞</button>
    <div style="font-weight: 600; font-size: 16px;"></div>

</header>

<!-- Preview Mode Banner -->
<div class="preview-banner">
    üëÅÔ∏è PREVIEW MODE - You are viewing this as a guest. Some features are disabled.
</div>

<!-- Side Drawer -->
<div class="drawer-overlay" onclick="toggleDrawer()"></div>
<nav class="drawer">
    <div class="drawer-header">
        <div class="weatherford-logo">
            <img src="/static/weatherford_logo.png" alt="Logo" style="height: 32px; width: auto;">
        </div>
        <button class="drawer-close" onclick="toggleDrawer()">‚úï</button>
    </div>


    <div class="drawer-nav">
        <div class="drawer-item active" onclick="navigateTo('home')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
            </svg>
            Home
        </div>
        <div class="drawer-item" onclick="navigateTo('hse-programs')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
            </svg>
            <span data-i18n="hsePrograms">HSE Programs</span>
        </div>
        <div class="drawer-item" onclick="navigateTo('tasks')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
            </svg>
            Tasks
        </div>
        <div class="drawer-item" onclick="navigateTo('statistics')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
            </svg>
            Statistics
        </div>
        <div class="drawer-item" onclick="navigateTo('schedule')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z" />
            </svg>
            Schedule
        </div>
        <div class="drawer-item" onclick="navigateTo('calendar')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z" />
            </svg>
            Calendar
        </div>
        <div class="drawer-item" onclick="navigateTo('related-docs')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
            </svg>
            <span data-i18n="relatedDocs">Related Docs</span>
        </div>
        <div class="drawer-item" onclick="navigateTo('hse-kpi')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z" />
            </svg>
            <span data-i18n="hseKpi">HSE KPI</span>
        </div>
        <div class="drawer-item" onclick="navigateTo('ll-indicator')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
            </svg>
            <span>LL Indicator</span>
        </div>
        <div class="drawer-item" onclick="navigateTo('otp')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z" />
            </svg>
            <span>HSE OTP</span>
        </div>
        <div class="drawer-item" onclick="navigateTo('matrix')">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M4 4h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 10h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 16h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4z" />
            </svg>
            <span>Matrix</span>
        </div>
        <div class="drawer-item" onclick="downloadReport()">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
            </svg>
            <span data-i18n="download">Download</span>
        </div>
        <!-- Admin Login/Logout -->
        <div class="drawer-item" id="admin-login-btn" onclick="showAdminLoginModal()">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
            <span data-i18n="adminLogin">Admin Login</span>
        </div>
        <div class="drawer-item admin-only" id="admin-logout-btn" onclick="adminLogout()" style="color: #e74c3c;">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
            </svg>
            <span data-i18n="logout">Logout</span> <span class="admin-badge" style="margin-left: 8px;">ADMIN</span>
        </div>

        <!-- Settings -->
        <div class="drawer-item" onclick="showSettingsModal()"
            style="margin-top: 16px; border-top: 1px solid var(--border); padding-top: 16px;">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.03-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
            </svg>
            ‚öôÔ∏è <span data-i18n="settings">Settings</span>
        </div>
    </div>

    <div class="drawer-footer">
        <p>CSMS App v1.0</p>
        <p id="admin-status" class="admin-only" style="color: #27ae60; font-size: 10px; margin-top: 4px;">‚úì <span
                data-i18n="adminModeActive">Admin Mode Active</span></p>
    </div>
</nav>

<!-- Main Content -->
<main class="main">
    <!-- Home Screen - Modern Dashboard -->
    <section class="screen active" id="screen-home" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Hero Banner with Logo -->
        <div
            style="background: linear-gradient(135deg, #C41E3A 0%, #9A1830 100%); border-radius: 16px; padding: 24px; margin-bottom: 20px; text-align: center;">
            <img src="/static/weatherford_logo.png" alt="Weatherford"
                style="width: 180px; height: auto; margin-bottom: 12px;">
            <h1 data-i18n="welcome" style="font-size: 24px; font-weight: 700; margin-bottom: 4px;">Welcome!</h1>
            <p data-i18n="hsePlanManagement" style="color: rgba(255,255,255,0.8); font-size: 14px;">HSE Plan Management
                System</p>
        </div>

        <!-- Quick Stats Row - HSE Programs -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
            <div onclick="navigateTo('hse-programs')"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;"
                onmouseover="this.style.transform='scale(1.02)'; this.style.background='var(--bg-hover)';"
                onmouseout="this.style.transform='scale(1)'; this.style.background='var(--bg-tertiary)';">
                <div id="home-total-projects" style="font-size: 28px; font-weight: 700; color: var(--weatherford-red);">
                    0</div>
                <div data-i18n="hsePrograms" style="font-size: 11px; color: var(--text-secondary);">Programs</div>
            </div>
            <div onclick="navigateTo('hse-programs')"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;"
                onmouseover="this.style.transform='scale(1.02)'; this.style.background='var(--bg-hover)';"
                onmouseout="this.style.transform='scale(1)'; this.style.background='var(--bg-tertiary)';">
                <div id="home-ongoing" style="font-size: 28px; font-weight: 700; color: var(--success);">0</div>
                <div data-i18n="implemented" style="font-size: 11px; color: var(--text-secondary);">Implemented</div>
            </div>
            <div onclick="navigateTo('hse-programs')"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;"
                onmouseover="this.style.transform='scale(1.02)'; this.style.background='var(--bg-hover)';"
                onmouseout="this.style.transform='scale(1)'; this.style.background='var(--bg-tertiary)';">
                <div id="home-upcoming" style="font-size: 28px; font-weight: 700; color: var(--warning);">0</div>
                <div data-i18n="planned" style="font-size: 11px; color: var(--text-secondary);">Planned</div>
            </div>
            <div onclick="navigateTo('statistics')"
                style="background: var(--bg-tertiary); border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;"
                onmouseover="this.style.transform='scale(1.02)'; this.style.background='var(--bg-hover)';"
                onmouseout="this.style.transform='scale(1)'; this.style.background='var(--bg-tertiary)';">
                <div id="home-completed" style="font-size: 28px; font-weight: 700; color: #4A90D9;">0%</div>
                <div data-i18n="compliance" style="font-size: 11px; color: var(--text-secondary);">Compliance</div>
            </div>
        </div>

        <!-- Leading Indicators Overview -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--border);">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: var(--success);">üìà Leading
                Indicators (Proactive Measures)</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 4px;">üéì</div>
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);" id="leading-training">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);">HSE Training</div>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 4px;">üö®</div>
                    <div style="font-size: 20px; font-weight: 700; color: var(--warning);" id="leading-drill">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);">Emergency Drill</div>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 4px;">üëÅ</div>
                    <div style="font-size: 20px; font-weight: 700; color: #3498db;" id="leading-radar">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);">RADAR Cards</div>
                </div>
            </div>
        </div>

        <!-- Lagging Indicators Overview -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--border);">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px; color: #e74c3c;">üìâ Lagging Indicators
                (Incident Statistics)</h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 12px;">
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--success);" id="lagging-manhours">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);">Safe Manhours (M)</div>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: #e74c3c;" id="lagging-lti">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);">LTI</div>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--warning);" id="lagging-trir">0.00</div>
                    <div style="font-size: 10px; color: var(--text-muted);">TRIR</div>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: var(--warning);" id="lagging-mtc">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);">MTC</div>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: #e74c3c;" id="lagging-recordable">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);">Recordable</div>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-align: center;">
                    <div style="font-size: 20px; font-weight: 700; color: #9b59b6;" id="lagging-mvir">0.00</div>
                    <div style="font-size: 10px; color: var(--text-muted);">MVIR</div>
                </div>
            </div>
            <p style="font-size: 11px; color: var(--text-muted); margin-top: 12px; text-align: center;">üìÖ 5-Year
                Historical Data</p>
        </div>

        <!-- Create Post Section -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--border);">
            <h4 style="font-size: 14px; margin-bottom: 12px; color: var(--text-secondary);">üí¨ <span
                    data-i18n="shareComment">Share a Comment</span></h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                <input type="text" id="post-name" placeholder="Your Name"
                    style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text-primary); font-size: 13px; width: 100%; box-sizing: border-box;">
                <input type="text" id="post-pl" placeholder="Product Line"
                    style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text-primary); font-size: 13px; width: 100%; box-sizing: border-box;">
            </div>
            <textarea id="post-input" placeholder="Write your comment or update..."
                style="width: 100%; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text-primary); font-size: 14px; min-height: 60px; resize: vertical; margin-bottom: 12px; box-sizing: border-box;"></textarea>

            <!-- Attachment Preview -->
            <div id="post-attachment-preview"
                style="display: none; margin-bottom: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span id="post-attachment-name" style="font-size: 12px; color: var(--success);">üìé Attachment
                        added</span>
                    <button onclick="removePostAttachment()"
                        style="background: none; border: none; color: var(--netflix-red); cursor: pointer; font-size: 16px;">‚úï</button>
                </div>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 16px;">
                    <span data-i18n="photo" onclick="pickCommentPhoto()"
                        style="color: var(--text-muted); font-size: 13px; cursor: pointer; padding: 6px 12px; border-radius: 6px; transition: all 0.2s;"
                        onmouseover="this.style.background='var(--bg-tertiary)'"
                        onmouseout="this.style.background='transparent'">üì∑ Photo</span>
                    <span data-i18n="file" onclick="pickCommentFile()"
                        style="color: var(--text-muted); font-size: 13px; cursor: pointer; padding: 6px 12px; border-radius: 6px; transition: all 0.2s;"
                        onmouseover="this.style.background='var(--bg-tertiary)'"
                        onmouseout="this.style.background='transparent'">üìé File</span>
                </div>
                <button data-i18n="post" onclick="postComment()"
                    style="background: var(--weatherford-red); color: white; border: none; padding: 8px 24px; border-radius: 20px; font-weight: 600; font-size: 13px; cursor: pointer;">Post</button>
            </div>

            <!-- Hidden file inputs -->
            <input type="file" id="comment-photo-input" accept="image/*" onchange="handleCommentPhotoSelect(event)"
                style="display: none;">
            <input type="file" id="comment-file-input" onchange="handleCommentFileSelect(event)" style="display: none;">
        </div>

        <!-- Dynamic Comments Container -->
        <div style="margin-bottom: 20px;">
            <h3 data-i18n="statusUpdates" style="font-size: 14px; color: var(--text-muted); margin-bottom: 12px;">Status
                Updates</h3>
            <div id="comments-container">
                <p style="color: var(--text-muted); text-align: center; padding: 20px;">Loading comments...</p>
            </div>
        </div>

        <!-- Posts Feed -->
        <div id="posts-container" style="margin-bottom: 20px;">
            <!-- Sample Post 1 -->
            <div class="post-card"
                style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border);">
                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                    <div
                        style="width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #C41E3A, #9A1830); display: flex; align-items: center; justify-content: center; font-weight: 600;">
                        üì¢</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;" data-i18n="csmsAdmin">CSMS Admin</div>
                        <div style="font-size: 12px; color: var(--text-muted);"><span
                                data-i18n="systemAnnouncement">System Announcement</span> ‚Ä¢ <span
                                data-i18n="justNow">Just now</span></div>
                    </div>
                </div>
                <p style="font-size: 14px; line-height: 1.5; margin-bottom: 12px;" data-i18n="welcomeNewDashboard">
                    Welcome to the new CSMS
                    Dashboard! We've added new features including project reports, email reminders, and an improved
                    statistics view. Let us know your feedback!</p>
                <div style="display: flex; gap: 24px; padding-top: 12px; border-top: 1px solid var(--border);">
                    <span onclick="toggleLike(this)" data-liked="false"
                        style="color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.2s;">üëç
                        <span data-i18n="like">Like</span></span>
                    <span onclick="toggleReplyForm(this.parentElement.parentElement)"
                        style="color: var(--text-secondary); font-size: 13px; cursor: pointer;">üí¨ <span
                            data-i18n="comment">Comment</span></span>
                </div>
                <!-- Reply Form (hidden by default) -->
                <div class="reply-form"
                    style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                    <div style="display: flex; gap: 10px; align-items: flex-start;">
                        <input type="text" class="reply-input" placeholder="Write a reply..."
                            style="flex: 1; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 20px; padding: 10px 16px; color: var(--text-primary); font-size: 13px;">
                        <span onclick="pickReplyPhoto(this.parentElement)"
                            style="cursor: pointer; font-size: 18px; padding: 8px;">üì∑</span>
                        <button onclick="submitReply(this.parentElement.parentElement)"
                            style="background: var(--netflix-red); color: white; border: none; padding: 10px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer;">Reply</button>
                    </div>
                    <div class="reply-photo-preview"
                        style="display: none; margin-top: 8px; font-size: 12px; color: var(--success);"></div>
                    <div class="replies-container" style="margin-top: 12px;"></div>
                </div>
            </div>

            <!-- Sample Post 2 - Project Update -->
            <div class="post-card"
                style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border);">
                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                    <div
                        style="width: 44px; height: 44px; border-radius: 50%; background: var(--success); display: flex; align-items: center; justify-content: center; font-weight: 600;">
                        ‚úì</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;" data-i18n="projectUpdate">Project Update</div>
                        <div style="font-size: 12px; color: var(--text-muted);"><span
                                data-i18n="autoGenerated">Auto-generated</span> ‚Ä¢ <span data-i18n="today">Today</span>
                        </div>
                    </div>
                </div>
                <p style="font-size: 14px; line-height: 1.5; margin-bottom: 8px;">üéâ <strong
                        data-i18n="greatProgress">Great
                        Progress!</strong> <span data-i18n="projectTasksMoving">Project tasks are moving forward
                        smoothly. Check the Statistics dashboard
                        for detailed completion rates.</span></p>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span style="font-size: 13px;" data-i18n="overallCompletion">Overall Completion</span>
                        <span style="font-size: 13px; font-weight: 600;" id="home-completion-rate">0%</span>
                    </div>
                    <div style="background: var(--border); border-radius: 4px; height: 8px; overflow: hidden;">
                        <div id="home-progress-bar"
                            style="height: 100%; background: var(--success); width: 0%; transition: width 0.5s;">
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 24px; padding-top: 12px; border-top: 1px solid var(--border);">
                    <span onclick="toggleLike(this)" data-liked="false"
                        style="color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.2s;">üëç
                        <span data-i18n="like">Like</span></span>
                    <span onclick="toggleReplyForm(this.parentElement.parentElement)"
                        style="color: var(--text-secondary); font-size: 13px; cursor: pointer;">üí¨ <span
                            data-i18n="comment">Comment</span></span>
                </div>
                <!-- Reply Form (hidden by default) -->
                <div class="reply-form"
                    style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                    <div style="display: flex; gap: 10px; align-items: flex-start;">
                        <input type="text" class="reply-input" placeholder="Write a reply..."
                            style="flex: 1; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 20px; padding: 10px 16px; color: var(--text-primary); font-size: 13px;">
                        <span onclick="pickReplyPhoto(this.parentElement)"
                            style="cursor: pointer; font-size: 18px; padding: 8px;">üì∑</span>
                        <button onclick="submitReply(this.parentElement.parentElement)"
                            style="background: var(--netflix-red); color: white; border: none; padding: 10px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer;">Reply</button>
                    </div>
                    <div class="reply-photo-preview"
                        style="display: none; margin-top: 8px; font-size: 12px; color: var(--success);"></div>
                    <div class="replies-container" style="margin-top: 12px;"></div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--border);">
            <h3 data-i18n="quickActions" style="font-size: 15px; font-weight: 600; margin-bottom: 12px;">Quick Actions
            </h3>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                <button onclick="showCreateModal()"
                    style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 10px; padding: 16px 8px; text-align: center; cursor: pointer; color: var(--text-primary);">
                    <div style="font-size: 24px; margin-bottom: 6px;">‚ûï</div>
                    <div data-i18n="newProject" style="font-size: 12px;">New Project</div>
                </button>
                <button onclick="navigateTo('tasks')"
                    style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 10px; padding: 16px 8px; text-align: center; cursor: pointer; color: var(--text-primary);">
                    <div style="font-size: 24px; margin-bottom: 6px;">üìã</div>
                    <div data-i18n="viewTasks" style="font-size: 12px;">View Tasks</div>
                </button>
                <button onclick="downloadReport()"
                    style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 10px; padding: 16px 8px; text-align: center; cursor: pointer; color: var(--text-primary);">
                    <div style="font-size: 24px; margin-bottom: 6px;">üì•</div>
                    <div data-i18n="download" style="font-size: 12px;">Download</div>
                </button>
            </div>
        </div>


        <!-- Recent Activity -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; border: 1px solid var(--border);">
            <h3 style="font-size: 15px; font-weight: 600; margin-bottom: 12px;">üìä <span
                    data-i18n="recentActivity">Recent Activity</span></h3>
            <div id="recent-activity" style="font-size: 13px; color: var(--text-secondary);">
                <div style="display: flex; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border);">
                    <span style="color: var(--success);">‚óè</span>
                    <span data-i18n="projectsLoadedSuccess">Projects loaded successfully</span>
                </div>
                <div style="display: flex; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border);">
                    <span style="color: var(--warning);">‚óè</span>
                    <span data-i18n="checkingScheduleReminders">Checking for schedule reminders...</span>
                </div>
                <div style="display: flex; gap: 10px; padding: 10px 0;">
                    <span style="color: var(--weatherford-red);">‚óè</span>
                    <span data-i18n="dashboardReady">Dashboard ready</span>
                </div>
            </div>
        </div>
    </section>

    <!-- HSE Programs Screen -->
    <section class="screen" id="screen-hse-programs" style="overflow-y: auto; height: calc(100vh - 130px);">
        <div class="screen-tabs">
            <div class="screen-tab active" data-i18n="hsePrograms">HSE Programs</div>
            <button onclick="showCreateModal()" class="hide-in-preview admin-only"
                style="background: var(--weatherford-red); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; cursor: pointer;">+
                <span data-i18n="createProgram">Create New Program</span></button>
        </div>

        <div class="status-filters" id="project-status-filters" style="flex-wrap: wrap;">
            <div class="status-dot active" data-filter="all" onclick="filterProjects('all')"><span
                    data-i18n="all">All</span> <span id="count-all" style="opacity: 0.7;">(0)</span></div>
            <div class="status-dot" data-filter="Upcoming" onclick="filterProjects('Upcoming')"><span
                    data-i18n="upcoming">Upcoming</span> <span id="count-upcoming" style="opacity: 0.7;">(0)</span>
            </div>
            <div class="status-dot" data-filter="InProgress" onclick="filterProjects('InProgress')"><span
                    data-i18n="inProgress">InProgress</span> <span id="count-inprogress"
                    style="opacity: 0.7;">(0)</span></div>
            <div class="status-dot" data-filter="Completed" onclick="filterProjects('Completed')"><span
                    data-i18n="completed">Completed</span> <span id="count-completed" style="opacity: 0.7;">(0)</span>
            </div>
            <div class="status-dot" data-filter="OnHold" onclick="filterProjects('OnHold')"><span
                    data-i18n="onHold">OnHold</span> <span id="count-onhold" style="opacity: 0.7;">(0)</span></div>
            <div class="status-dot" data-filter="Canceled" onclick="filterProjects('Canceled')"><span
                    data-i18n="canceled">Canceled</span> <span id="count-canceled" style="opacity: 0.7;">(0)</span>
            </div>
        </div>

        <div id="projects-container"></div>
    </section>

    <!-- Tasks Screen -->
    <section class="screen" id="screen-tasks" style="overflow-y: auto; height: calc(100vh - 130px);">
        <div class="screen-tabs">
            <div class="screen-tab active" data-i18n="tasks">Tasks</div>
            <button onclick="showTaskModal()" class="admin-only"
                style="background: var(--weatherford-red); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 12px; cursor: pointer;">+
                <span data-i18n="createTask">Create Task</span></button>
        </div>

        <div class="status-filters" id="task-status-filters" style="flex-wrap: wrap;">
            <div class="status-dot active" data-filter="all" onclick="filterTasks('all')"><span
                    data-i18n="all">All</span> <span id="task-count-all" style="opacity: 0.7;">(0)</span></div>
            <div class="status-dot" data-filter="Upcoming" onclick="filterTasks('Upcoming')"><span
                    data-i18n="upcoming">Upcoming</span> <span id="task-count-upcoming" style="opacity: 0.7;">(0)</span>
            </div>
            <div class="status-dot" data-filter="In Progress" onclick="filterTasks('In Progress')"><span
                    data-i18n="inProgress">In Progress</span> <span id="task-count-inprogress"
                    style="opacity: 0.7;">(0)</span></div>
            <div class="status-dot" data-filter="Completed" onclick="filterTasks('Completed')"><span
                    data-i18n="completed">Completed</span> <span id="task-count-completed"
                    style="opacity: 0.7;">(0)</span></div>
        </div>

        <div id="tasks-container"></div>
    </section>

    <!-- Statistics Screen - Modern Dashboard -->
    <section class="screen" id="screen-statistics" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Dashboard Header -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
            <svg viewBox="0 0 24 24" fill="var(--netflix-red)" width="28" height="28">
                <path
                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
            </svg>
            <h2 style="font-size: 24px; font-weight: 700;" data-i18n="dashboard">Dashboard</h2>
        </div>

        <!-- KPI Cards Row -->
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;">
            <div onclick="navigateTo('hse-programs')"
                style="background: linear-gradient(135deg, #E50914 0%, #B20710 100%); border-radius: 12px; padding: 16px; cursor: pointer; transition: transform 0.2s;">
                <div style="font-size: 12px; opacity: 0.8;" data-i18n="totalPrograms">Total HSE Programs</div>
                <div id="stat-total-projects" style="font-size: 32px; font-weight: 700;">0</div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;" data-i18n="tapToView">Tap to view ‚Üí</div>
            </div>
            <div onclick="navigateTo('tasks')"
                style="background: linear-gradient(135deg, #46D369 0%, #2E8B4F 100%); border-radius: 12px; padding: 16px; cursor: pointer; transition: transform 0.2s;">
                <div style="font-size: 12px; opacity: 0.8;" data-i18n="implementedPrograms">Implemented</div>
                <div id="stat-total-tasks" style="font-size: 32px; font-weight: 700;">0</div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;" data-i18n="tapToView">Tap to view ‚Üí</div>
            </div>
            <div onclick="navigateTo('tasks')"
                style="background: linear-gradient(135deg, #4A90D9 0%, #2E5A8C 100%); border-radius: 12px; padding: 16px; cursor: pointer; transition: transform 0.2s;">
                <div style="font-size: 12px; opacity: 0.8;" data-i18n="implementationRate">Implementation Rate</div>
                <div id="stat-completion-rate" style="font-size: 32px; font-weight: 700;">0%</div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;" data-i18n="tapForTasks">Tap for details ‚Üí
                </div>
            </div>
            <div onclick="navigateTo('schedule')"
                style="background: linear-gradient(135deg, #F5A623 0%, #C88820 100%); border-radius: 12px; padding: 16px; cursor: pointer; transition: transform 0.2s;">
                <div style="font-size: 12px; opacity: 0.8;" data-i18n="upcomingPrograms">Upcoming Programs</div>
                <div id="stat-upcoming-mwt" style="font-size: 32px; font-weight: 700;">0</div>
                <div style="font-size: 11px; opacity: 0.6; margin-top: 4px;" data-i18n="tapForSchedule">Tap for schedule
                    ‚Üí</div>
            </div>
        </div>

        <!-- Project Status Donut Chart -->
        <div onclick="navigateTo('hse-programs')"
            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px; cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="font-size: 16px; font-weight: 600;" data-i18n="programStatusDistribution">Program Status
                    Distribution</div>
                <span style="font-size: 11px; color: var(--text-muted);" data-i18n="tapToView">Tap to view ‚Üí</span>
            </div>
            <div style="display: flex; align-items: center; gap: 24px;">
                <div id="project-donut-chart" style="width: 120px; height: 120px; position: relative;">
                    <!-- SVG donut chart will be inserted here -->
                </div>
                <div id="project-legend-new" style="flex: 1;">
                    <!-- Legend items -->
                </div>
            </div>
        </div>

        <!-- Task Status Donut Chart -->
        <div onclick="navigateTo('tasks')"
            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px; cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="font-size: 16px; font-weight: 600;" data-i18n="taskStatusDistribution">Task Status
                    Distribution</div>
                <span style="font-size: 11px; color: var(--text-muted);" data-i18n="tapToView">Tap to view ‚Üí</span>
            </div>
            <div style="display: flex; align-items: center; gap: 24px;">
                <div id="task-donut-chart" style="width: 120px; height: 120px; position: relative;">
                    <!-- SVG donut chart will be inserted here -->
                </div>
                <div id="task-legend-new" style="flex: 1;">
                    <!-- Legend items -->
                </div>
            </div>
        </div>

        <!-- Project Completion Progress -->
        <div onclick="navigateTo('projects')"
            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px; cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="font-size: 16px; font-weight: 600;" data-i18n="projectTaskCompletion">Project Task
                    Completion</div>
                <span style="font-size: 11px; color: var(--text-muted);" data-i18n="tapToView">Tap to view ‚Üí</span>
            </div>
            <div id="project-completion-bars" style="max-height: 300px; overflow-y: auto;">
                <!-- Progress bars will be inserted here -->
            </div>
        </div>

        <!-- Schedule Quick Stats - All Meeting Types -->
        <div onclick="navigateTo('schedule')"
            style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px; cursor: pointer;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="font-size: 16px; font-weight: 600;" data-i18n="scheduleOverview">üìÖ Schedule Overview - All
                    Meeting Types</div>
                <span style="font-size: 11px; color: var(--text-muted);" data-i18n="tapToView">Tap to view ‚Üí</span>
            </div>
            <div
                style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center; margin-bottom: 12px;">
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px;">
                    <div style="font-size: 24px; font-weight: 700; color: #3498db;" id="stat-upcoming-mwt-count">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);" data-i18n="mwtPlan">üìÖ MWT Plan</div>
                </div>
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px;">
                    <div style="font-size: 24px; font-weight: 700; color: #9b59b6;" id="stat-upcoming-hse-count">0</div>
                    <div style="font-size: 10px; color: var(--text-muted);" data-i18n="hseCommittee">üè¢ HSE Committee
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center;">
                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px;">
                        <div style="font-size: 24px; font-weight: 700; color: #e67e22;"
                            id="stat-upcoming-hseplan-count">0
                        </div>
                        <div style="font-size: 10px; color: var(--text-muted);" data-i18n="hsePlan">üìã HSE Plan</div>
                    </div>
                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px;">
                        <div style="font-size: 24px; font-weight: 700; color: #1abc9c;" id="stat-upcoming-spr-count">0
                        </div>
                        <div style="font-size: 10px; color: var(--text-muted);" data-i18n="sprMeeting">üìä SPR Meeting
                        </div>
                    </div>
                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px;">
                        <div style="font-size: 24px; font-weight: 700; color: #e74c3c;" id="stat-upcoming-hazid-count">0
                        </div>
                        <div style="font-size: 10px; color: var(--text-muted);" data-i18n="hazidHazop">‚ö†Ô∏è HAZID/HAZOP
                        </div>
                    </div>
                </div>
                <div
                    style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--bg-tertiary); display: flex; justify-content: center; gap: 24px;">
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--netflix-red);"
                            id="stat-total-schedules">0</div>
                        <div style="font-size: 11px; color: var(--text-muted);" data-i18n="totalSchedules">Total
                            Schedules
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 28px; font-weight: 700; color: var(--success);" id="stat-this-month">0
                        </div>
                        <div style="font-size: 11px; color: var(--text-muted);" data-i18n="thisMonth">This Month</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Charts Section -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px;" data-i18n="analyticsDashboard">üìä
                Analytics Dashboard</div>

            <!-- Schedule Types Bar Chart -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; transition: background 0.2s;"
                onmouseover="this.style.background='var(--bg-tertiary)'"
                onmouseout="this.style.background='transparent'">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);" data-i18n="scheduleTypesDistribution">
                        Schedule Types Distribution</div>
                    <span style="font-size: 10px; color: var(--netflix-red);">‚Üí</span>
                </div>
                <div id="schedule-bar-chart"
                    style="height: 180px; display: flex; align-items: flex-end; justify-content: space-around; gap: 8px; padding: 0 10px;">
                    <!-- Bar chart will be inserted here -->
                </div>
            </div>

            <!-- Task Progress Overview Chart -->
            <div onclick="navigateTo('tasks')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; transition: background 0.2s;"
                onmouseover="this.style.background='var(--bg-tertiary)'"
                onmouseout="this.style.background='transparent'">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);" data-i18n="taskStatusOverview">Task
                        Status
                        Overview</div>
                    <span style="font-size: 10px; color: var(--netflix-red);">‚Üí</span>
                </div>
                <div id="task-progress-chart" style="height: 100px; display: flex; align-items: flex-end; gap: 12px;">
                    <!-- Task status bars will be inserted here -->
                </div>
            </div>

            <!-- Project Status Area Chart -->
            <div onclick="navigateTo('projects')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; transition: background 0.2s;"
                onmouseover="this.style.background='var(--bg-tertiary)'"
                onmouseout="this.style.background='transparent'">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);" data-i18n="projectProgressOverview">
                        Project
                        Progress Overview</div>
                    <span style="font-size: 10px; color: var(--netflix-red);">‚Üí</span>
                </div>
                <div id="progress-area-chart"
                    style="height: 120px; position: relative; background: linear-gradient(180deg, rgba(70, 211, 105, 0.1) 0%, transparent 100%); border-radius: 8px; overflow: hidden;">
                    <!-- Area chart will be inserted here -->
                </div>
            </div>

            <!-- Monthly Trend -->
            <div onclick="navigateTo('schedule')"
                style="cursor: pointer; padding: 10px; border-radius: 8px; transition: background 0.2s;"
                onmouseover="this.style.background='var(--bg-tertiary)'"
                onmouseout="this.style.background='transparent'">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <div style="font-size: 13px; color: var(--text-muted);" data-i18n="monthlyActivityTrend">Monthly
                        Activity Trend</div>
                    <span style="font-size: 10px; color: var(--netflix-red);">‚Üí</span>
                </div>
                <div id="monthly-trend-chart"
                    style="height: 100px; display: flex; align-items: flex-end; justify-content: space-between; gap: 4px;">
                    <!-- Line/bar chart will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Monthly Charts Gallery -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px;" data-i18n="monthlyChartsGallery">üìà
                Monthly Charts Gallery</div>
            <p style="font-size: 11px; color: var(--text-muted); margin-bottom: 16px;" data-i18n="janDecTrends">Jan
                -
                Dec trends across all data
            </p>

            <!-- MWT Schedule by Month -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #3498db; margin-bottom: 8px;"
                    data-i18n="mwtPlanScheduleByMonth">üìÖ MWT Plan Schedule by Month</div>
                <div id="monthly-mwt-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>

            <!-- HSE Committee by Month -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #9b59b6; margin-bottom: 8px;"
                    data-i18n="hseCommitteeMeetingByMonth">üè¢ HSE Committee
                    Meeting by Month</div>
                <div id="monthly-hse-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>

            <!-- HSE Plan by Month -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #e67e22; margin-bottom: 8px;"
                    data-i18n="hsePlanMeetingByMonth">üìã HSE Plan Meeting
                    by Month</div>
                <div id="monthly-hseplan-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>

            <!-- SPR Meeting by Month -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #1abc9c; margin-bottom: 8px;"
                    data-i18n="sprMeetingByMonth">üìä SPR Meeting by
                    Month</div>
                <div id="monthly-spr-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>

            <!-- HAZID/HAZOP by Month -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #e74c3c; margin-bottom: 8px;"
                    data-i18n="hazidHazopMeetingByMonth">‚ö†Ô∏è HAZID/HAZOP
                    Meeting by Month</div>
                <div id="monthly-hazid-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>

            <!-- CSMS PB Audit by Month -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #27ae60; margin-bottom: 8px;"
                    data-i18n="csmsPbAuditByMonth">‚úÖ CSMS PB Audit by
                    Month</div>
                <div id="monthly-csms-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>

            <!-- Projects by Month -->
            <div onclick="navigateTo('projects')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: var(--netflix-red); margin-bottom: 8px;"
                    data-i18n="projectsCreatedByMonth">üìÅ
                    Projects Created by Month</div>
                <div id="monthly-projects-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>

            <!-- Task Completion by Month -->
            <div onclick="navigateTo('tasks')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #46D369; margin-bottom: 8px;"
                    data-i18n="taskCompletionRateByMonth">‚úì Task Completion
                    Rate by Month</div>
                <div id="monthly-tasks-chart"
                    style="height: 80px; display: flex; align-items: flex-end; justify-content: space-between; gap: 2px;">
                </div>
                <div
                    style="display: flex; justify-content: space-between; font-size: 8px; color: var(--text-muted); margin-top: 4px;">
                    <span data-i18n="jan">Jan</span><span data-i18n="feb">Feb</span><span
                        data-i18n="mar">Mar</span><span data-i18n="apr">Apr</span><span data-i18n="may">May</span><span
                        data-i18n="jun">Jun</span><span data-i18n="jul">Jul</span><span data-i18n="aug">Aug</span><span
                        data-i18n="sep">Sep</span><span data-i18n="oct">Oct</span><span data-i18n="nov">Nov</span><span
                        data-i18n="dec">Dec</span>
                </div>
            </div>
        </div>

        <!-- Project Chart Gallery -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px;" data-i18n="projectChartGallery">üìÅ
                Project Chart Gallery</div>
            <p style="font-size: 11px; color: var(--text-muted); margin-bottom: 16px;"
                data-i18n="xAxisProjectsYAxisValues">X-axis: Projects | Y-axis: Values
            </p>

            <!-- Tasks per Project -->
            <div onclick="navigateTo('tasks')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #F5A623; margin-bottom: 8px;"
                    data-i18n="tasksPerProject">üìã Tasks per Project
                </div>
                <div id="project-tasks-chart"
                    style="height: 100px; display: flex; align-items: flex-end; gap: 4px; overflow-x: auto;"></div>
            </div>

            <!-- Schedules per Project -->
            <div onclick="navigateTo('schedule')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #3498db; margin-bottom: 8px;"
                    data-i18n="schedulesPerProject">üìÖ Schedules per
                    Project</div>
                <div id="project-schedules-chart"
                    style="height: 100px; display: flex; align-items: flex-end; gap: 4px; overflow-x: auto;"></div>
            </div>

            <!-- Task Completion Rate per Project -->
            <div onclick="navigateTo('projects')"
                style="margin-bottom: 20px; cursor: pointer; padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-size: 12px; font-weight: 600; color: #46D369; margin-bottom: 8px;"
                    data-i18n="taskCompletionRatePerProject">‚úì Task Completion
                    Rate per Project (%)</div>
                <div id="project-completion-chart"
                    style="height: 100px; display: flex; align-items: flex-end; gap: 4px; overflow-x: auto;"></div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px;" data-i18n="quickActions">Quick
                Actions
            </div>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button onclick="checkReminders()" class="btn btn-save" style="flex: 1; min-width: 120px;">
                    üìß <span data-i18n="checkReminders">Check Reminders</span>
                </button>
                <button onclick="loadDashboardStats()" class="btn btn-cancel" style="flex: 1; min-width: 120px;">
                    üîÑ <span data-i18n="refreshStats">Refresh Stats</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Schedule Screen -->
    <section class="screen" id="screen-schedule" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Header with icon -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
            <svg viewBox="0 0 24 24" fill="var(--netflix-red)" width="28" height="28">
                <path
                    d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z" />
            </svg>
            <h2 style="font-size: 24px; font-weight: 700;" data-i18n="schedule">Schedule</h2>
        </div>

        <!-- Create New Schedule Form -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
            <h3 style="font-size: 18px; margin-bottom: 20px;" data-i18n="createSchedule">Create New Schedule</h3>

            <form id="schedule-form">
                <!-- Schedule Type Selector -->
                <div class="form-group">
                    <label class="form-label"><span data-i18n="scheduleType">Schedule Type</span> <span>*</span></label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <div class="schedule-type-chip active" data-type="mwt" onclick="selectScheduleType('mwt')">
                            <span data-i18n="mwtPlan">üìÖ MWT Plan</span>
                        </div>
                        <div class="schedule-type-chip" data-type="hse" onclick="selectScheduleType('hse')">
                            <span data-i18n="hseCommittee">üè¢ HSE Committee</span>
                        </div>
                        <div class="schedule-type-chip" data-type="csms" onclick="selectScheduleType('csms')">
                            <span data-i18n="csmsPbAudit">‚úÖ CSMS PB Audit</span>
                        </div>
                        <div class="schedule-type-chip" data-type="hseplan" onclick="selectScheduleType('hseplan')">
                            <span data-i18n="hsePlanMeeting">üìã HSE Plan Meeting</span>
                        </div>
                        <div class="schedule-type-chip" data-type="spr" onclick="selectScheduleType('spr')">
                            <span data-i18n="sprMeeting">üìä SPR Meeting</span>
                        </div>
                        <div class="schedule-type-chip" data-type="hazid" onclick="selectScheduleType('hazid')">
                            <span data-i18n="hazidHazop">‚ö†Ô∏è HAZID/HAZOP</span>
                        </div>
                    </div>
                    <input type="hidden" name="schedule_type" id="schedule-type-input" value="mwt">
                </div>

                <!-- Project Name - Dropdown -->
                <div class="form-group">
                    <label class="form-label"><span data-i18n="projectName">Project Name</span> <span>*</span></label>
                    <select class="form-input" name="project_id" id="schedule-project-select" required
                        style="cursor: pointer;">
                        <option value="" data-i18n="selectAProject">Select a project</option>
                    </select>
                </div>

                <!-- Well Name -->
                <div class="form-group">
                    <label class="form-label"><span data-i18n="wellName">Well Name</span> <span>*</span></label>
                    <input type="text" class="form-input" name="well_name" placeholder="Enter well name"
                        data-placeholder="enterWellName" required>
                </div>

                <!-- MWT Plan Date -->
                <div class="form-group schedule-date-field" id="mwt-date-group">
                    <label class="form-label" data-i18n="mwtPlanDate">MWT Plan Date <span>*</span></label>
                    <div class="date-input-wrap">
                        <input type="date" class="form-input" name="mwt_plan_date" id="mwt-date-input">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                        </svg>
                    </div>
                </div>

                <!-- HSE Committee Meeting Plan -->
                <div class="form-group schedule-date-field" id="hse-date-group" style="display: none;">
                    <label class="form-label" data-i18n="hseCommitteeMeetingDate">HSE Committee Meeting Date
                        <span>*</span></label>
                    <div class="date-input-wrap">
                        <input type="date" class="form-input" name="hse_meeting_date" id="hse-date-input">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                        </svg>
                    </div>
                </div>

                <!-- CSMS PB Audit Date -->
                <div class="form-group schedule-date-field" id="csms-date-group" style="display: none;">
                    <label class="form-label" data-i18n="csmsPbAuditDate">CSMS PB Audit Date <span>*</span></label>
                    <div class="date-input-wrap">
                        <input type="date" class="form-input" name="csms_pb_date" id="csms-date-input">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                        </svg>
                    </div>
                </div>

                <!-- HSE Plan Meeting Date -->
                <div class="form-group schedule-date-field" id="hseplan-date-group" style="display: none;">
                    <label class="form-label" data-i18n="hsePlanMeetingDate">HSE Plan Meeting Date
                        <span>*</span></label>
                    <div class="date-input-wrap">
                        <input type="date" class="form-input" name="hseplan_date" id="hseplan-date-input">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                        </svg>
                    </div>
                </div>

                <!-- SPR Meeting Date -->
                <div class="form-group schedule-date-field" id="spr-date-group" style="display: none;">
                    <label class="form-label" data-i18n="sprMeetingDate">SPR Meeting Date <span>*</span></label>
                    <div class="date-input-wrap">
                        <input type="date" class="form-input" name="spr_date" id="spr-date-input">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                        </svg>
                    </div>
                </div>

                <!-- HAZID/HAZOP Meeting Date -->
                <div class="form-group schedule-date-field" id="hazid-date-group" style="display: none;">
                    <label class="form-label" data-i18n="hazidHazopMeetingDate">HAZID/HAZOP Meeting Date
                        <span>*</span></label>
                    <div class="date-input-wrap">
                        <input type="date" class="form-input" name="hazid_date" id="hazid-date-input">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                        </svg>
                    </div>
                </div>

                <!-- PIC Section -->
                <div class="form-group">
                    <label class="form-label" data-i18n="pic"
                        style="font-weight: 600; font-size: 16px; margin-bottom: 16px;">PIC</label>

                    <!-- PIC Name -->
                    <div style="margin-bottom: 12px;">
                        <input type="text" class="form-input" name="pic_name" placeholder="Name"
                            data-placeholder="namePlaceholder" value="ADE" required>
                    </div>

                    <!-- Assigned To Email -->
                    <div>
                        <input type="email" class="form-input" name="assigned_to_email"
                            placeholder="Email (e.g. john@weatherford.com)" data-placeholder="emailPlaceholder"
                            required>
                        <p style="font-size: 11px; color: var(--text-muted); margin-top: 6px;"
                            data-i18n="emailNotification">
                            An email notification will be sent to this address
                        </p>
                    </div>
                </div>

                <!-- Create Schedule Button -->
                <button type="button" class="btn btn-save" style="width: 100%; margin-top: 8px;"
                    onclick="createSchedule()">
                    <span data-i18n="createSchedule">Create Schedule</span>
                </button>
            </form>
        </div>

        <!-- Upcoming Schedules Section -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 12px; color: var(--netflix-red);"
                data-i18n="allUpcomingSchedules">
                üìã All Upcoming Schedules
            </h3>
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;"
                data-i18n="allCreatedSchedulesByType">All created schedules by type</p>
            <div id="upcoming-schedules-list">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- MWT Plan Schedule Calendar -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 12px; color: var(--netflix-red);"
                data-i18n="mwtPlanSchedule">
                MWT Plan Schedule
            </h3>
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;"
                data-i18n="showingUpcoming3Months">Showing upcoming 3 months</p>
            <!-- Month Filter -->
            <div id="mwt-month-filter" style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;">
                <!-- Populated by JS -->
            </div>
            <div id="mwt-calendar" style="min-height: 60px;">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- HSE Committee Meeting Schedule -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 12px; color: var(--netflix-red);"
                data-i18n="hseCommitteeMeetingSchedule">
                HSE Committee Meeting Schedule
            </h3>
            <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;"
                data-i18n="showingUpcoming3Months">Showing upcoming 3 months</p>
            <!-- Month Filter -->
            <div id="hse-month-filter" style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;">
                <!-- Populated by JS -->
            </div>
            <div id="hse-calendar" style="min-height: 60px;">
                <!-- Populated by JS -->
            </div>
        </div>
    </section>

    <!-- Calendar Screen -->
    <section class="screen" id="screen-calendar" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Header -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
            <div
                style="width: 48px; height: 48px; background: linear-gradient(135deg, #9b59b6, #8e44ad); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                üìÖ</div>
            <div>
                <h2 style="font-size: 20px; font-weight: 700; margin: 0;" data-i18n="calendarTitle">Calendar</h2>
                <p style="font-size: 12px; color: var(--text-muted); margin: 0;" data-i18n="meetingProjectCalendars">
                    Meeting & Project Calendars</p>
            </div>
        </div>

        <!-- Meeting Calendar Section -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div style="font-size: 16px; font-weight: 600; color: #3498db;" data-i18n="meetingCalendar">üìã Meeting
                    Calendar</div>
                <div style="display: flex; gap: 4px;">
                    <button id="meeting-weekly-btn" onclick="setMeetingCalendarView('weekly')"
                        style="background: var(--netflix-red); border: none; color: white; padding: 4px 10px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600;"
                        data-i18n="weekly">Weekly</button>
                    <button id="meeting-monthly-btn" onclick="setMeetingCalendarView('monthly')"
                        style="background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); padding: 4px 10px; border-radius: 6px; cursor: pointer; font-size: 11px;"
                        data-i18n="monthly">Monthly</button>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <button onclick="changeMeetingCalendarMonth(-1)"
                    style="background: var(--bg-tertiary); border: none; color: var(--text-primary); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">‚óÄ</button>
                <h3 id="meeting-calendar-month-title" style="font-size: 16px; font-weight: 700; margin: 0;"></h3>
                <button onclick="changeMeetingCalendarMonth(1)"
                    style="background: var(--bg-tertiary); border: none; color: var(--text-primary); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">‚ñ∂</button>
            </div>
            <div id="meeting-calendar-header"
                style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 8px; text-align: center;">
                <div style="font-size: 11px; color: var(--text-muted); font-weight: 600; padding: 4px;">Sun</div>
                <div style="font-size: 11px; color: var(--text-muted); font-weight: 600; padding: 4px;">Mon</div>
                <div style="font-size: 11px; color: var(--text-muted); font-weight: 600; padding: 4px;">Tue</div>
                <div style="font-size: 11px; color: var(--text-muted); font-weight: 600; padding: 4px;">Wed</div>
                <div style="font-size: 11px; color: var(--text-muted); font-weight: 600; padding: 4px;">Thu</div>
                <div style="font-size: 11px; color: var(--text-muted); font-weight: 600; padding: 4px;">Fri</div>
                <div style="font-size: 11px; color: var(--text-muted); font-weight: 600; padding: 4px;">Sat</div>
            </div>
            <div id="meeting-calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;">
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 12px; font-size: 11px;">
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #3498db; border-radius: 50%;"></span> MWT
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #9b59b6; border-radius: 50%;"></span> HSE
                    Committee
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #27ae60; border-radius: 50%;"></span> CSMS PB
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #e67e22; border-radius: 50%;"></span> HSE Plan
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #1abc9c; border-radius: 50%;"></span> SPR
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 8px; height: 8px; background: #e74c3c; border-radius: 50%;"></span> HAZID/HAZOP
                </div>
            </div>
        </div>

        <!-- Project Calendar Section -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div style="font-size: 16px; font-weight: 600; color: var(--netflix-red);" data-i18n="projectCalendar">
                    üìÅ Project Calendar</div>
                <div style="display: flex; gap: 4px;">
                    <button id="project-weekly-btn" onclick="setProjectCalendarView('weekly')"
                        style="background: var(--netflix-red); border: none; color: white; padding: 4px 10px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600;"
                        data-i18n="weekly">Weekly</button>
                    <button id="project-monthly-btn" onclick="setProjectCalendarView('monthly')"
                        style="background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); padding: 4px 10px; border-radius: 6px; cursor: pointer; font-size: 11px;"
                        data-i18n="monthly">Monthly</button>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <button onclick="changeProjectCalendarMonth(-1)"
                    style="background: var(--bg-tertiary); border: none; color: var(--text-primary); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">‚óÄ</button>
                <h3 id="project-calendar-month-title" style="font-size: 16px; font-weight: 700; margin: 0;"></h3>
                <button onclick="changeProjectCalendarMonth(1)"
                    style="background: var(--bg-tertiary); border: none; color: var(--text-primary); padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 16px;">‚ñ∂</button>
            </div>
            <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                <div
                    style="display: grid; grid-template-columns: repeat(7, minmax(45px, 1fr)); gap: 2px; margin-bottom: 4px; text-align: center; min-width: 350px;">
                    <div style="font-size: 10px; color: var(--text-muted); font-weight: 600; padding: 2px;">Sun</div>
                    <div style="font-size: 10px; color: var(--text-muted); font-weight: 600; padding: 2px;">Mon</div>
                    <div style="font-size: 10px; color: var(--text-muted); font-weight: 600; padding: 2px;">Tue</div>
                    <div style="font-size: 10px; color: var(--text-muted); font-weight: 600; padding: 2px;">Wed</div>
                    <div style="font-size: 10px; color: var(--text-muted); font-weight: 600; padding: 2px;">Thu</div>
                    <div style="font-size: 10px; color: var(--text-muted); font-weight: 600; padding: 2px;">Fri</div>
                    <div style="font-size: 10px; color: var(--text-muted); font-weight: 600; padding: 2px;">Sat</div>
                </div>
                <div id="project-calendar-grid"
                    style="display: grid; grid-template-columns: repeat(7, minmax(45px, 1fr)); gap: 2px; min-width: 350px;">
                </div>
            </div>
            <div id="project-calendar-legend"
                style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; font-size: 10px;">
                <!-- Project legend will be populated by JS -->
            </div>
        </div>

        <!-- HSE Annual Plan Matrix -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; border: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div style="font-size: 16px; font-weight: 600; color: #27ae60;">üìä HSE Annual Plan Matrix</div>
                <div style="display: flex; gap: 4px;">
                    <button onclick="changeAnnualPlanYear(-1)"
                        style="background: var(--bg-tertiary); border: none; color: var(--text-primary); padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 12px;">‚óÄ</button>
                    <span id="annual-plan-year" style="padding: 4px 12px; font-weight: 600;">2025</span>
                    <button onclick="changeAnnualPlanYear(1)"
                        style="background: var(--bg-tertiary); border: none; color: var(--text-primary); padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 12px;">‚ñ∂</button>
                </div>
            </div>
            <p style="font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">Plan vs Actual implementation
                tracking for HSE Programs and Tasks</p>

            <!-- Annual Matrix Container -->
            <div style="overflow-x: auto; -webkit-overflow-scrolling: touch;">
                <table id="annual-plan-table"
                    style="width: 100%; min-width: 1200px; border-collapse: collapse; font-size: 11px;">
                    <thead>
                        <tr style="background: var(--bg-tertiary);">
                            <th rowspan="2"
                                style="padding: 8px; text-align: left; border: 1px solid var(--border); min-width: 200px; position: sticky; left: 0; background: var(--bg-tertiary); z-index: 1;">
                                HSE Program / Task</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #e74c3c; color: white;">
                                Jan</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #e67e22; color: white;">
                                Feb</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #f1c40f; color: #333;">
                                Mar</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #2ecc71; color: white;">
                                Apr</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #1abc9c; color: white;">
                                May</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #3498db; color: white;">
                                Jun</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #9b59b6; color: white;">
                                Jul</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #e91e63; color: white;">
                                Aug</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #00bcd4; color: white;">
                                Sep</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #ff5722; color: white;">
                                Oct</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #795548; color: white;">
                                Nov</th>
                            <th colspan="2"
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); background: #607d8b; color: white;">
                                Dec</th>
                        </tr>
                        <tr style="background: var(--bg-secondary);">
                            <!-- Plan/Actual sub-headers for each month -->
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #3498db;">
                                P</th>
                            <th
                                style="padding: 4px; text-align: center; border: 1px solid var(--border); font-size: 9px; color: #27ae60;">
                                A</th>
                        </tr>
                    </thead>
                    <tbody id="annual-plan-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Legend -->
            <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 12px; font-size: 10px;">
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 12px; height: 12px; background: #3498db; border-radius: 2px;"></span> P = Plan
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 12px; height: 12px; background: #27ae60; border-radius: 2px;"></span> A = Actual
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 12px; height: 12px; background: #2ecc71; border-radius: 2px;"></span> ‚úì =
                    Completed
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <span style="width: 12px; height: 12px; background: #e74c3c; border-radius: 2px;"></span> ‚úó = Missed
                </div>
            </div>
        </div>
    </section>


    <!-- HSE KPI Dashboard Screen -->
    <section class="screen" id="screen-hse-kpi" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Header -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
            <div
                style="width: 48px; height: 48px; background: linear-gradient(135deg, #27ae60, #2ecc71); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                üìä</div>
            <div>
                <h2 style="font-size: 20px; font-weight: 700; margin: 0;">HSE KPI Dashboard</h2>
                <p style="font-size: 12px; color: var(--text-muted); margin: 0;">Key Performance Indicators</p>
            </div>
            <div style="margin-left: auto; display: flex; gap: 8px; align-items: center;">
                <div class="admin-only">
                    <button onclick="showAddKPIYearModal()"
                        style="padding: 8px 14px; border: none; border-radius: 8px; background: var(--netflix-red); color: white; cursor: pointer; font-weight: 600; font-size: 12px;">+
                        Add Year</button>
                </div>
                <select id="kpi-download-year"
                    style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary); font-size: 12px;">
                    <option value="all">All Years</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
                <button onclick="downloadKPIExcel(document.getElementById('kpi-download-year').value)"
                    style="padding: 8px 14px; border: none; border-radius: 8px; background: #27ae60; color: white; cursor: pointer; font-weight: 600; font-size: 12px;">üì•
                    Download</button>
            </div>
        </div>

        <!-- Year Selector Tabs -->
        <div style="display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="kpi-year-tab" data-year="2021" onclick="selectKPIYear(2021)"
                style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary); cursor: pointer; font-weight: 500;">2021</button>
            <button class="kpi-year-tab" data-year="2022" onclick="selectKPIYear(2022)"
                style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary); cursor: pointer; font-weight: 500;">2022</button>
            <button class="kpi-year-tab" data-year="2023" onclick="selectKPIYear(2023)"
                style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary); cursor: pointer; font-weight: 500;">2023</button>
            <button class="kpi-year-tab" data-year="2024" onclick="selectKPIYear(2024)"
                style="padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary); cursor: pointer; font-weight: 500;">2024</button>
            <button class="kpi-year-tab active" data-year="2025" onclick="selectKPIYear(2025)"
                style="padding: 8px 16px; border: 2px solid var(--netflix-red); border-radius: 8px; background: var(--netflix-red); color: white; cursor: pointer; font-weight: 600;">2025</button>
        </div>

        <!-- Summary Cards -->
        <div id="kpi-summary-cards"
            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 24px;"></div>

        <!-- KPI Table -->
        <div
            style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 20px; overflow-x: auto;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                <h3 style="font-size: 16px; margin: 0; color: var(--text-primary);">üìà Performance Metrics</h3>
                <button class="admin-only" onclick="openAddKPIMetric()"
                    style="padding: 6px 12px; border: none; border-radius: 6px; background: #27ae60; color: white; cursor: pointer; font-size: 12px; font-weight: 600; margin-right: 8px;">‚ûï
                    Add</button>
                <button class="admin-only" id="kpi-edit-btn" onclick="toggleKPIEditMode()"
                    style="padding: 6px 12px; border: 1px solid var(--netflix-red); border-radius: 6px; background: transparent; color: var(--netflix-red); cursor: pointer; font-size: 12px; font-weight: 600;">‚úèÔ∏è
                    Edit</button>
            </div>
            <table id="kpi-table" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead id="kpi-table-head"></thead>
                <tbody id="kpi-table-body"></tbody>
            </table>
        </div>

        <!-- Formula Reference -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 16px;">
            <h3 style="font-size: 14px; margin-bottom: 12px; color: var(--text-muted);">üìê Formula Reference</h3>
            <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">‚Ä¢ <strong>TRIR</strong> =
                (Number of Recordable Incidents √ó 1,000,000) / Man-Hours</p>
            <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">‚Ä¢ <strong>2025 TRIR
                    Target</strong> = 50% of 2024 TRIR Result (0.44)</p>
            <p style="font-size: 12px; color: var(--text-secondary);">‚Ä¢ <strong>TVSIR</strong> = (Volume of Spill /
                Number of Spill) / MH</p>
        </div>
    </section>

    <!-- LL Indicator Screen -->
    <section class="screen" id="screen-ll-indicator" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Header -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <div
                style="width: 48px; height: 48px; background: linear-gradient(135deg, #e74c3c, #27ae60); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                üìà</div>
            <div style="flex: 1;">
                <h2 style="font-size: 18px; font-weight: 700; margin: 0;" id="ll-year-title">2025 LL Indicator</h2>
                <p style="font-size: 11px; color: var(--text-muted); margin: 0;">Lagging & Leading Indicators</p>
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <button class="admin-only" id="ll-edit-btn" onclick="toggleLLEditMode()"
                    style="padding: 6px 12px; border: 1px solid var(--netflix-red); border-radius: 6px; background: transparent; color: var(--netflix-red); cursor: pointer; font-size: 12px; font-weight: 600;">‚úèÔ∏è
                    Edit</button>
                <button onclick="downloadLLIndicator()"
                    style="padding: 6px 12px; border: none; border-radius: 6px; background: #27ae60; color: white; cursor: pointer; font-size: 12px; font-weight: 600;">üì•
                    Download</button>
            </div>
        </div>

        <!-- LAGGING INDICATORS Section -->
        <div style="background: var(--bg-secondary); border-radius: 12px; margin-bottom: 16px; overflow: hidden;">
            <div onclick="toggleLLSection('lagging')"
                style="background: linear-gradient(135deg, #c0392b, #e74c3c); padding: 12px 16px; cursor: pointer; display: flex; align-items: center; justify-content: between;">
                <span style="font-weight: 700; color: white; flex: 1;">‚ö†Ô∏è LAGGING INDICATORS</span>
                <button class="admin-only" onclick="event.stopPropagation();openAddLLIndicator('lagging')"
                    style="padding: 4px 10px; border: none; border-radius: 4px; background: rgba(255,255,255,0.2); color: white; cursor: pointer; font-size: 11px; font-weight: 600;">‚ûï
                    Add</button>
                <span id="ll-lagging-arrow" style="color: white; font-size: 14px;">‚ñº</span>
            </div>
            <div id="ll-lagging-content" style="padding: 12px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="background: var(--bg-tertiary);">
                            <th
                                style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border); width: 30px;">
                                #</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">
                                Indicator</th>
                            <th
                                style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border); width: 80px;">
                                Target</th>
                            <th
                                style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border); width: 80px;">
                                Actual</th>
                            <th
                                style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border); width: 50px;">
                                Status</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Intent
                            </th>
                        </tr>
                    </thead>
                    <tbody id="ll-lagging-body"></tbody>
                </table>
            </div>
        </div>

        <!-- LEADING INDICATORS Section -->
        <div style="background: var(--bg-secondary); border-radius: 12px; margin-bottom: 16px; overflow: hidden;">
            <div onclick="toggleLLSection('leading')"
                style="background: linear-gradient(135deg, #27ae60, #2ecc71); padding: 12px 16px; cursor: pointer; display: flex; align-items: center; justify-content: between;">
                <span style="font-weight: 700; color: white; flex: 1;">‚úÖ LEADING INDICATORS</span>
                <button class="admin-only" onclick="event.stopPropagation();openAddLLIndicator('leading')"
                    style="padding: 4px 10px; border: none; border-radius: 4px; background: rgba(255,255,255,0.2); color: white; cursor: pointer; font-size: 11px; font-weight: 600;">‚ûï
                    Add</button>
                <span id="ll-leading-arrow" style="color: white; font-size: 14px;">‚ñº</span>
            </div>
            <div id="ll-leading-content" style="padding: 12px;">
                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <thead>
                        <tr style="background: var(--bg-tertiary);">
                            <th
                                style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border); width: 30px;">
                                #</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">
                                Indicator</th>
                            <th
                                style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border); width: 100px;">
                                Target</th>
                            <th
                                style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border); width: 80px;">
                                Actual</th>
                            <th
                                style="padding: 10px; text-align: center; border-bottom: 1px solid var(--border); width: 50px;">
                                Status</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 1px solid var(--border);">Intent
                            </th>
                        </tr>
                    </thead>
                    <tbody id="ll-leading-body"></tbody>
                </table>
            </div>
        </div>

    </section>


    <!-- HSE OTP Screen -->
    <section class="screen" id="screen-otp" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Header -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <div
                style="width: 48px; height: 48px; background: linear-gradient(135deg, #9b59b6, #8e44ad); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                üìã</div>
            <div style="flex: 1;">
                <h2 style="font-size: 18px; font-weight: 700; margin: 0;" id="otp-year-title">2026 HSE OTP</h2>
                <p style="font-size: 11px; color: var(--text-muted); margin: 0;">Objective, Target & Program Tracker</p>
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <select id="otp-region-select" onchange="changeOTPRegion(this.value)"
                    style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;">
                    <option value="indonesia" selected>üáÆüá© Indonesia</option>
                    <option value="asia">üåè Asia</option>
                </select>
                <select id="otp-base-select" onchange="changeOTPBase(this.value)"
                    style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;">
                    <option value="all" selected>All Bases</option>
                    <option value="narogong">üìç Narogong</option>
                    <option value="duri">üìç Duri</option>
                    <option value="balikpapan">üìç Balikpapan</option>
                </select>
                <select id="otp-year-select" onchange="changeOTPYear(this.value)"
                    style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;">
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026" selected>2026</option>
                    <option value="2027">2027</option>
                    <option value="2028">2028</option>
                    <option value="2029">2029</option>
                    <option value="2030">2030</option>
                </select>
                <button class="admin-only" onclick="openCreateOTPModal()"
                    style="padding: 6px 12px; border: none; border-radius: 6px; background: var(--netflix-red); color: white; cursor: pointer; font-size: 12px; font-weight: 600;">‚ûï
                    Add</button>
                <button onclick="downloadOTPReport()"
                    style="padding: 6px 12px; border: none; border-radius: 6px; background: #27ae60; color: white; cursor: pointer; font-size: 12px; font-weight: 600;">üì•
                    Export</button>
            </div>
        </div>

        <!-- Summary Cards -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
            <div
                style="background: linear-gradient(135deg, #27ae60, #2ecc71); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="otp-total-programs">56</div>
                <div style="font-size: 11px; opacity: 0.9;">Total Programs</div>
            </div>
            <div
                style="background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="otp-completed">0</div>
                <div style="font-size: 11px; opacity: 0.9;">Completed</div>
            </div>
            <div
                style="background: linear-gradient(135deg, #f39c12, #e67e22); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="otp-in-progress">0</div>
                <div style="font-size: 11px; opacity: 0.9;">In Progress</div>
            </div>
            <div
                style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="otp-avg-progress">0%</div>
                <div style="font-size: 11px; opacity: 0.9;">Avg Progress</div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="otp-search" placeholder="üîç Search programs..."
                style="flex: 1; min-width: 200px; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;"
                oninput="filterOTPPrograms()">
            <select id="otp-filter-status" onchange="filterOTPPrograms()"
                style="padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                <option value="all">All Status</option>
                <option value="completed">100% Complete</option>
                <option value="progress">In Progress (1-99%)</option>
                <option value="notstarted">Not Started (0%)</option>
            </select>
            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                <input type="checkbox" id="otp-show-actual" checked onchange="toggleOTPView()">
                Show Actual
            </label>
        </div>

        <!-- OTP Table Container -->
        <div style="background: var(--bg-secondary); border-radius: 12px; overflow: hidden;">
            <div style="overflow-x: auto;">
                <table id="otp-table"
                    style="width: 100%; border-collapse: collapse; font-size: 12px; min-width: 1100px;">
                    <thead>
                        <tr style="background: var(--bg-tertiary);">
                            <th
                                style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); position: sticky; left: 0; background: var(--bg-tertiary); z-index: 1; min-width: 50px;">
                                #</th>
                            <th
                                style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); position: sticky; left: 50px; background: var(--bg-tertiary); z-index: 1; min-width: 250px;">
                                Program</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 80px;">
                                Plan Type</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                JAN</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                FEB</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                MAR</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                APR</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                MAY</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                JUN</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                JUL</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                AUG</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                SEP</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                OCT</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                NOV</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                DEC</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 100px;">
                                Progress</th>
                            <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 60px;"
                                class="admin-only">Action</th>
                        </tr>
                    </thead>
                    <tbody id="otp-table-body">
                        <!-- Programs will be rendered here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Legend -->
        <div
            style="display: flex; gap: 20px; margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px; font-size: 11px; color: var(--text-secondary);">
            <span><span
                    style="display: inline-block; width: 12px; height: 12px; background: #27ae60; border-radius: 2px; margin-right: 6px;"></span>Plan
                = Actual</span>
            <span><span
                    style="display: inline-block; width: 12px; height: 12px; background: #f39c12; border-radius: 2px; margin-right: 6px;"></span>Actual
                > Plan</span>
            <span><span
                    style="display: inline-block; width: 12px; height: 12px; background: #e74c3c; border-radius: 2px; margin-right: 6px;"></span>Actual
                < Plan</span>
                    <span><span
                            style="display: inline-block; width: 12px; height: 12px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 2px; margin-right: 6px;"></span>No
                        Activity</span>
        </div>
    </section>


    <!-- OTP Create Modal -->
    <div id="otp-create-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3>‚ûï Add New OTP Program</h3>
                <button onclick="closeOTPCreateModal()" class="modal-close">&times;</button>
            </div>
            <form id="otp-create-form" onsubmit="submitNewOTP(event)">
                <div class="form-group">
                    <label class="form-label">Program Name <span>*</span></label>
                    <input type="text" class="form-input" name="name" id="otp-new-name" required
                        placeholder="Enter program name">
                </div>
                <div class="form-group">
                    <label class="form-label">Plan Type</label>
                    <select class="form-input" name="plan_type" id="otp-new-plan-type">
                        <option value="Annually">Annually</option>
                        <option value="Annually / Base">Annually / Base</option>
                        <option value="Quarterly">Quarterly</option>
                        <option value="Quarterly / Base">Quarterly / Base</option>
                        <option value="Monthly">Monthly</option>
                        <option value="Monthly / Base">Monthly / Base</option>
                        <option value="Per Semester">Per Semester</option>
                        <option value="Per Semester / Base">Per Semester / Base</option>
                        <option value="One time in year">One time in year</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Due Date</label>
                    <input type="date" class="form-input" name="due_date" id="otp-new-due-date">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeOTPCreateModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create Program</button>
                </div>
            </form>
        </div>
    </div>

    <!-- OTP Edit Cell Modal -->
    <div id="otp-edit-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header">
                <h3 id="otp-edit-title">Edit Month Data</h3>
                <button onclick="closeOTPEditModal()" class="modal-close">&times;</button>
            </div>
            <form id="otp-edit-form" onsubmit="submitOTPEdit(event)">
                <input type="hidden" id="otp-edit-program-id">
                <input type="hidden" id="otp-edit-month">
                <div class="form-group">
                    <label class="form-label">Plan Value</label>
                    <input type="number" class="form-input" id="otp-edit-plan" min="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Actual Value</label>
                    <input type="number" class="form-input" id="otp-edit-actual" min="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">WPTS ID</label>
                    <input type="text" class="form-input" id="otp-edit-wpts" placeholder="Enter WPTS ID (optional)">
                </div>
                <div class="form-group">
                    <label class="form-label">Plan Date</label>
                    <input type="date" class="form-input" id="otp-edit-plan-date">
                </div>
                <div class="form-group">
                    <label class="form-label">Implementation Date</label>
                    <input type="date" class="form-input" id="otp-edit-impl-date">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeOTPEditModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Matrix Screen -->
    <section class="screen" id="screen-matrix" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Header -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
            <div
                style="width: 48px; height: 48px; background: linear-gradient(135deg, #16a085, #1abc9c); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                üìä</div>
            <div style="flex: 1;">
                <h2 style="font-size: 18px; font-weight: 700; margin: 0;" id="matrix-title">2026 Matrix - Audit
                    (Indonesia)</h2>
                <p style="font-size: 11px; color: var(--text-muted); margin: 0;">HSE Matrix Tracker - Audit, Training,
                    Drill, Meeting</p>
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <select id="matrix-region-select" onchange="changeMatrixRegion(this.value)"
                    style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;">
                    <option value="indonesia" selected>üáÆüá© Indonesia</option>
                    <option value="asia">üåè Asia</option>
                </select>
                <select id="matrix-base-select" onchange="changeMatrixBase(this.value)"
                    style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;">
                    <option value="all" selected>All Bases</option>
                    <option value="narogong">üìç Narogong</option>
                    <option value="duri">üìç Duri</option>
                    <option value="balikpapan">üìç Balikpapan</option>
                </select>
                <select id="matrix-category-select" onchange="changeMatrixCategory(this.value)"
                    style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;">
                    <option value="audit" selected>üìã Audit</option>
                    <option value="training">üìö Training</option>
                    <option value="drill">üö® Emergency Drill</option>
                    <option value="meeting">ü§ù Meeting</option>
                </select>
                <select id="matrix-year-select" onchange="changeMatrixYear(this.value)"
                    style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px;">
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                    <option value="2026" selected>2026</option>
                    <option value="2027">2027</option>
                    <option value="2028">2028</option>
                    <option value="2029">2029</option>
                    <option value="2030">2030</option>
                </select>
                <button class="admin-only" onclick="openCreateMatrixModal()"
                    style="padding: 6px 12px; border: none; border-radius: 6px; background: var(--netflix-red); color: white; cursor: pointer; font-size: 12px; font-weight: 600;">‚ûï
                    Add</button>
                <button onclick="downloadMatrixReport()"
                    style="padding: 6px 12px; border: none; border-radius: 6px; background: #27ae60; color: white; cursor: pointer; font-size: 12px; font-weight: 600;">üì•
                    Export</button>
            </div>
        </div>

        <!-- Summary Cards -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
            <div
                style="background: linear-gradient(135deg, #16a085, #1abc9c); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="matrix-total-programs">0</div>
                <div style="font-size: 11px; opacity: 0.9;">Total Programs</div>
            </div>
            <div
                style="background: linear-gradient(135deg, #27ae60, #2ecc71); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="matrix-completed">0</div>
                <div style="font-size: 11px; opacity: 0.9;">Completed</div>
            </div>
            <div
                style="background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="matrix-in-progress">0</div>
                <div style="font-size: 11px; opacity: 0.9;">In Progress</div>
            </div>
            <div
                style="background: linear-gradient(135deg, #9b59b6, #8e44ad); border-radius: 10px; padding: 14px; text-align: center;">
                <div style="font-size: 24px; font-weight: 700;" id="matrix-avg-progress">0%</div>
                <div style="font-size: 11px; opacity: 0.9;">Avg Progress</div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="matrix-search" placeholder="üîç Search programs..."
                style="flex: 1; min-width: 200px; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;"
                oninput="filterMatrixPrograms()">
            <select id="matrix-filter-status" onchange="filterMatrixPrograms()"
                style="padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px;">
                <option value="all">All Status</option>
                <option value="completed">100% Complete</option>
                <option value="progress">In Progress (1-99%)</option>
                <option value="notstarted">Not Started (0%)</option>
            </select>
            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-secondary);">
                <input type="checkbox" id="matrix-show-actual" checked onchange="toggleMatrixView()"> Show Actual
            </label>
        </div>

        <!-- Matrix Table Container -->
        <div style="background: var(--bg-secondary); border-radius: 12px; overflow: hidden;">
            <div style="overflow-x: auto;">
                <table id="matrix-table"
                    style="width: 100%; border-collapse: collapse; font-size: 12px; min-width: 1100px;">
                    <thead>
                        <tr style="background: var(--bg-tertiary);">
                            <th
                                style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); position: sticky; left: 0; background: var(--bg-tertiary); z-index: 1; min-width: 50px;">
                                #</th>
                            <th
                                style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); position: sticky; left: 50px; background: var(--bg-tertiary); z-index: 1; min-width: 250px;">
                                Program</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 80px;">
                                Reference</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                JAN</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                FEB</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                MAR</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                APR</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                MAY</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                JUN</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                JUL</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                AUG</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                SEP</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                OCT</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                NOV</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 55px;">
                                DEC</th>
                            <th
                                style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 100px;">
                                Progress</th>
                            <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); min-width: 60px;"
                                class="admin-only">Action</th>
                        </tr>
                    </thead>
                    <tbody id="matrix-table-body">
                        <!-- Programs will be rendered here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Legend -->
        <div
            style="display: flex; gap: 20px; margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px; font-size: 11px; color: var(--text-secondary);">
            <span><span
                    style="display: inline-block; width: 12px; height: 12px; background: #27ae60; border-radius: 2px; margin-right: 6px;"></span>Actual
                ‚â• Plan</span>
            <span><span
                    style="display: inline-block; width: 12px; height: 12px; background: #f39c12; border-radius: 2px; margin-right: 6px;"></span>Actual
                > 0</span>
            <span><span
                    style="display: inline-block; width: 12px; height: 12px; background: #e74c3c; border-radius: 2px; margin-right: 6px;"></span>Actual
                < Plan</span>
                    <span><span
                            style="display: inline-block; width: 12px; height: 12px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 2px; margin-right: 6px;"></span>No
                        Activity</span>
        </div>
    </section>

    <!-- Matrix Create Modal -->
    <div id="matrix-create-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3>‚ûï Add New Matrix Program</h3>
                <button onclick="closeMatrixCreateModal()" class="modal-close">&times;</button>
            </div>
            <form id="matrix-create-form" onsubmit="submitNewMatrix(event)">
                <div class="form-group">
                    <label class="form-label">Program Name <span>*</span></label>
                    <input type="text" class="form-input" name="name" id="matrix-new-name" required
                        placeholder="Enter program name">
                </div>
                <div class="form-group">
                    <label class="form-label">Reference</label>
                    <input type="text" class="form-input" name="reference" id="matrix-new-reference"
                        placeholder="e.g., ISO 45001">
                </div>
                <div class="form-group">
                    <label class="form-label">Plan Type</label>
                    <select class="form-input" name="plan_type" id="matrix-new-plan-type">
                        <option value="Monthly">Monthly</option>
                        <option value="Quarterly">Quarterly</option>
                        <option value="Annually">Annually</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeMatrixCreateModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create Program</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Matrix Edit Cell Modal -->
    <div id="matrix-edit-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header">
                <h3 id="matrix-edit-title">Edit Month Data</h3>
                <button onclick="closeMatrixEditModal()" class="modal-close">&times;</button>
            </div>
            <form id="matrix-edit-form" onsubmit="submitMatrixEdit(event)">
                <input type="hidden" id="matrix-edit-program-id">
                <input type="hidden" id="matrix-edit-month">
                <div class="form-group">
                    <label class="form-label">Plan Value</label>
                    <input type="number" class="form-input" id="matrix-edit-plan" min="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Actual Value</label>
                    <input type="number" class="form-input" id="matrix-edit-actual" min="0" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">WPTS ID</label>
                    <input type="text" class="form-input" id="matrix-edit-wpts" placeholder="Enter WPTS ID (optional)">
                </div>
                <div class="form-group">
                    <label class="form-label">Plan Date</label>
                    <input type="date" class="form-input" id="matrix-edit-plan-date">
                </div>
                <div class="form-group">
                    <label class="form-label">Implementation Date</label>
                    <input type="date" class="form-input" id="matrix-edit-impl-date">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeMatrixEditModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Related Documents Screen -->
    <section class="screen" id="screen-related-docs" style="overflow-y: auto; height: calc(100vh - 130px);">
        <!-- Header -->
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
            <svg viewBox="0 0 24 24" fill="var(--netflix-red)" width="28" height="28">
                <path
                    d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
            </svg>
            <h2 style="font-size: 24px; font-weight: 700;" data-i18n="relatedDocs">Related Documents</h2>
        </div>

        <!-- Add Document Form -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
            <h3 style="font-size: 18px; margin-bottom: 20px;" data-i18n="uploadDocument">Upload Document</h3>

            <form id="related-doc-form">
                <div class="form-group">
                    <label class="form-label"><span data-i18n="projectName">Project Name</span> <span>*</span></label>
                    <select class="form-input" name="project_id" id="doc-project-select" required>
                        <option value="">Select Project</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" data-i18n="wellName">Well Name</label>
                    <input type="text" class="form-input" name="well_name" id="doc-well-name"
                        placeholder="Enter well name">
                </div>

                <div class="form-group">
                    <label class="form-label"><span data-i18n="documentName">Document Name</span> <span>*</span></label>
                    <input type="text" class="form-input" name="doc_name" required
                        placeholder="e.g. Safety Certificate">
                </div>

                <div class="form-group">
                    <label class="form-label"><span data-i18n="attachment">Attachment</span> <span>*</span></label>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <button type="button" onclick="document.getElementById('doc-file').click()"
                                style="background: var(--netflix-red); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-weight: 600;">
                                <svg viewBox="0 0 24 24" fill="white" width="18" height="18">
                                    <path
                                        d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z" />
                                </svg>
                                <span data-i18n="selectFile">Select File</span>
                            </button>
                            <span id="doc-file-name"
                                style="font-size: 13px; color: var(--text-muted); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                <span data-i18n="noFileSelected">No file selected</span>
                        </div>
                        <input type="file" id="doc-file" required style="display: none;"
                            onchange="updateDocFileName(this)">
                    </div>
                </div>

                <button type="button" class="btn btn-save" onclick="submitRelatedDoc()" style="width: 100%;">
                    <span data-i18n="uploadDocument">Upload Document</span>
                </button>
            </form>
        </div>

        <!-- Document List -->
        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px;">
            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;" data-i18n="uploadedDocuments">Uploaded
                Documents</h3>
            <div id="related-docs-list" style="min-height: 60px;">
                <!-- Filled by JS -->
                <div style="text-align: center; color: var(--text-muted); padding: 20px;" data-i18n="noDocumentsYet">
                    No documents uploaded yet
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <div class="nav-item active" onclick="navigateTo('home')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
        </svg>
        <span data-i18n="home">Home</span>
    </div>
    <div class="nav-item" onclick="navigateTo('hse-programs')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
        </svg>
        <span data-i18n="hsePrograms">Programs</span>
    </div>
    <div class="nav-item" onclick="navigateTo('tasks')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
        </svg>
        <span data-i18n="tasks">Tasks</span>
    </div>
    <div class="nav-item" onclick="navigateTo('statistics')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
        </svg>
        <span data-i18n="statistics">Statistics</span>
    </div>
    <div class="nav-item" onclick="navigateTo('schedule')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z" />
        </svg>
        <span data-i18n="schedule">Schedule</span>
    </div>
    <div class="nav-item" onclick="navigateTo('calendar')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z" />
        </svg>
        <span data-i18n="calendarTitle">Calendar</span>
    </div>
    <div class="nav-item" onclick="navigateTo('hse-kpi')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z" />
        </svg>
        <span data-i18n="hseKpi">KPI</span>
    </div>
    <div class="nav-item" onclick="navigateTo('ll-indicator')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
        </svg>
        <span>LL</span>
    </div>
    <div class="nav-item" onclick="navigateTo('otp')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l4.59-4.58L18 11l-6 6z" />
        </svg>
        <span>OTP</span>
    </div>
    <div class="nav-item" onclick="navigateTo('matrix')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M4 4h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 10h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 16h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4z" />
        </svg>
        <span>Matrix</span>
    </div>
    <div class="nav-item" onclick="navigateTo('related-docs')">
        <svg viewBox="0 0 24 24" fill="currentColor">
            <path
                d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
        </svg>
        <span data-i18n=\"docs\">Docs</span>
    </div>
</nav>

<!-- Admin Login Modal -->

<!-- Icon Gallery Modal -->
<div class="modal-overlay" id="icon-gallery-modal" onclick="if(event.target===this)closeIconGallery()">
    <div class="modal-content"
        style="max-width: 400px; background: var(--bg-secondary); border-radius: 16px; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="font-size: 16px; font-weight: 700;">üé® Select Icon</h3>
            <button onclick="closeIconGallery()"
                style="background: none; border: none; color: var(--text-primary); font-size: 20px; cursor: pointer;">√ó</button>
        </div>
        <div id="icon-gallery-grid"
            style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px; max-height: 300px; overflow-y: auto;">
        </div>
    </div>
</div>

<!-- Add/Edit KPI Metric Modal -->
<div class="modal-overlay" id="kpi-metric-modal" onclick="if(event.target===this)closeKPIMetricModal()">
    <div class="modal-content"
        style="max-width: 350px; background: var(--bg-secondary); border-radius: 16px; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="font-size: 16px; font-weight: 700;" id="kpi-metric-modal-title">Add KPI Metric</h3>
            <button onclick="closeKPIMetricModal()"
                style="background: none; border: none; color: var(--text-primary); font-size: 20px; cursor: pointer;">√ó</button>
        </div>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <button id="kpi-metric-icon-btn" onclick="openIconGallery('kpi')"
                    style="width: 50px; height: 50px; font-size: 28px; border: 2px dashed var(--border); border-radius: 8px; background: var(--bg-tertiary); cursor: pointer;">üìä</button>
                <span style="color: var(--text-muted); font-size: 12px;">Click to change icon</span>
            </div>
            <input type="text" id="kpi-metric-name" placeholder="Metric Name"
                style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px;">
            <input type="hidden" id="kpi-metric-id">
            <div style="display: flex; gap: 8px;">
                <button id="kpi-metric-delete-btn" onclick="deleteKPIMetric()"
                    style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: #e74c3c; color: white; cursor: pointer; font-weight: 600; display: none;">üóëÔ∏è
                    Delete</button>
                <button onclick="closeKPIMetricModal()"
                    style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: transparent; color: var(--text-primary); cursor: pointer;">Cancel</button>
                <button onclick="saveKPIMetric()"
                    style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: var(--netflix-red); color: white; cursor: pointer; font-weight: 600;">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit LL Indicator Modal -->
<div class="modal-overlay" id="ll-indicator-modal" onclick="if(event.target===this)closeLLIndicatorModal()">
    <div class="modal-content"
        style="max-width: 400px; background: var(--bg-secondary); border-radius: 16px; padding: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="font-size: 16px; font-weight: 700;" id="ll-indicator-modal-title">Add Indicator</h3>
            <button onclick="closeLLIndicatorModal()"
                style="background: none; border: none; color: var(--text-primary); font-size: 20px; cursor: pointer;">√ó</button>
        </div>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <button id="ll-indicator-icon-btn" onclick="openIconGallery('ll')"
                    style="width: 50px; height: 50px; font-size: 28px; border: 2px dashed var(--border); border-radius: 8px; background: var(--bg-tertiary); cursor: pointer;">üìä</button>
                <span style="color: var(--text-muted); font-size: 12px;">Click to change icon</span>
            </div>
            <input type="text" id="ll-indicator-name" placeholder="Indicator Name"
                style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px;">
            <input type="text" id="ll-indicator-target" placeholder="Target (e.g., 0, 100%, Quarterly)"
                style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px;">
            <textarea id="ll-indicator-intent" placeholder="Intent / Description" rows="2"
                style="padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); font-size: 14px; resize: none;"></textarea>
            <input type="hidden" id="ll-indicator-id">
            <input type="hidden" id="ll-indicator-type">
            <div style="display: flex; gap: 8px;">
                <button id="ll-indicator-delete-btn" onclick="deleteLLIndicator()"
                    style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: #e74c3c; color: white; cursor: pointer; font-weight: 600; display: none;">üóëÔ∏è
                    Delete</button>
                <button onclick="closeLLIndicatorModal()"
                    style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: transparent; color: var(--text-primary); cursor: pointer;">Cancel</button>
                <button onclick="saveLLIndicator()"
                    style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: var(--netflix-red); color: white; cursor: pointer; font-weight: 600;">Save</button>
            </div>
        </div>
    </div>
</div>
<div class="modal-overlay" id="admin-login-modal">
    <div class="modal-header">
        <button class="modal-back" onclick="closeAdminLoginModal()">‚Üê</button>
        <span class="modal-title">Admin Login</span>
    </div>
    <div class="modal-body" style="padding: 40px 20px;">
        <div style="text-align: center; margin-bottom: 30px;">
            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 60px; height: 60px; color: var(--netflix-red);">
                <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
            <h2 style="margin-top: 12px; font-size: 20px;">Admin Access</h2>
            <p style="color: var(--text-muted); font-size: 13px;">Enter your credentials to continue</p>
        </div>

        <form id="admin-login-form" onsubmit="handleAdminLogin(event)">
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" class="form-input" id="admin-username" placeholder="Enter username" required>
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="admin-password" placeholder="Enter password" required>
            </div>

            <div id="admin-login-error"
                style="display: none; color: #e74c3c; background: rgba(231,76,60,0.1); padding: 10px; border-radius: 8px; margin-bottom: 16px; font-size: 13px;">
            </div>

            <button type="submit" class="btn-primary"
                style="width: 100%; padding: 14px; font-size: 16px; font-weight: 600;">
                Login
            </button>
        </form>
    </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settings-modal"
    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center;">
    <div
        style="background: var(--bg-secondary); border-radius: 16px; padding: 24px; width: 90%; max-width: 400px; max-height: 80vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h2 style="font-size: 20px; font-weight: 700;">‚öôÔ∏è Settings</h2>
            <button onclick="closeSettingsModal()"
                style="background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer;">‚úï</button>
        </div>

        <!-- Language Selection -->
        <div style="margin-bottom: 24px;">
            <h3
                style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">
                üåê Language / Bahasa</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="lang-option" data-lang="id" onclick="setLanguage('id')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;">
                    <div style="font-size: 24px; margin-bottom: 6px;">üáÆüá©</div>
                    <div style="font-weight: 600;">Indonesia</div>
                </div>
                <div class="lang-option" data-lang="en" onclick="setLanguage('en')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;">
                    <div style="font-size: 24px; margin-bottom: 6px;">üá¨üáß</div>
                    <div style="font-weight: 600;">English</div>
                </div>
                <div class="lang-option" data-lang="ar" onclick="setLanguage('ar')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;">
                    <div style="font-size: 24px; margin-bottom: 6px;">üá∏üá¶</div>
                    <div style="font-weight: 600;">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</div>
                </div>
                <div class="lang-option" data-lang="hi" onclick="setLanguage('hi')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.2s;">
                    <div style="font-size: 24px; margin-bottom: 6px;">üáÆüá≥</div>
                    <div style="font-weight: 600;">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</div>
                </div>
            </div>
        </div>

        <!-- Theme Selection -->
        <div style="margin-bottom: 24px;">
            <h3
                style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">
                üé® Theme</h3>
            <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                <div class="theme-option" data-theme="dark" onclick="setTheme('dark')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; display: flex; align-items: center; gap: 14px; cursor: pointer; transition: all 0.2s;">
                    <div
                        style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #1a1a1a, #2d2d2d);">
                    </div>
                    <div>
                        <div style="font-weight: 600;">Dark Mode</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Default dark theme</div>
                    </div>
                </div>
                <div class="theme-option" data-theme="light" onclick="setTheme('light')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; display: flex; align-items: center; gap: 14px; cursor: pointer; transition: all 0.2s;">
                    <div
                        style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #ffffff, #f5f5f5);">
                    </div>
                    <div>
                        <div style="font-weight: 600;">Light Mode</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Bright and clean</div>
                    </div>
                </div>
                <div class="theme-option" data-theme="ocean" onclick="setTheme('ocean')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; display: flex; align-items: center; gap: 14px; cursor: pointer; transition: all 0.2s;">
                    <div
                        style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #0c2d48, #1a5276);">
                    </div>
                    <div>
                        <div style="font-weight: 600;">Ocean Blue</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Deep sea colors</div>
                    </div>
                </div>
                <div class="theme-option" data-theme="forest" onclick="setTheme('forest')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; display: flex; align-items: center; gap: 14px; cursor: pointer; transition: all 0.2s;">
                    <div
                        style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #134e0f, #1e7e19);">
                    </div>
                    <div>
                        <div style="font-weight: 600;">Forest Green</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Nature inspired</div>
                    </div>
                </div>
                <div class="theme-option" data-theme="sunset" onclick="setTheme('sunset')"
                    style="background: var(--bg-tertiary); border: 2px solid transparent; border-radius: 12px; padding: 14px; display: flex; align-items: center; gap: 14px; cursor: pointer; transition: all 0.2s;">
                    <div
                        style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #6e1e14, #b04420);">
                    </div>
                    <div>
                        <div style="font-weight: 600;">Sunset Orange</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Warm evening colors</div>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center; padding-top: 16px; border-top: 1px solid var(--border);">
            <p style="font-size: 12px; color: var(--text-muted);">CSMS App v1.0 | Settings saved automatically</p>
        </div>
    </div>
</div>

<!-- Create Program Modal -->
<div class="modal-overlay" id="create-modal">
    <div class="modal-header">
        <button class="modal-back" onclick="closeCreateModal()">‚Üê</button>
        <span class="modal-title" data-i18n="createNewProgram">Create New Program</span>
    </div>
    <div class="modal-body">
        <form id="project-form">
            <div class="form-group">
                <label class="form-label"><span data-i18n="programName">Program Name</span> <span>*</span></label>
                <input type="text" class="form-input" name="name" placeholder="Enter program name" required>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="description">Description</span></label>
                <textarea class="form-input" name="title" placeholder="Enter program description" rows="3"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="programCategory">Category</label>
                <select class="form-input" name="category">
                    <option value="hse-training">HSE Training</option>
                    <option value="emergency-drill">Emergency Drill</option>
                    <option value="observation-card">Observation Card (RADAR)</option>
                    <option value="safety-meeting">Safety Meeting</option>
                    <option value="inspection">Inspection</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="programStatus">Program Status</label>
                <div class="status-chips">
                    <div class="status-chip active" data-status="Upcoming" onclick="selectStatus(this)"><span
                            data-i18n="upcoming">Planned</span>
                    </div>
                    <div class="status-chip" data-status="InProgress" onclick="selectStatus(this)"><span
                            data-i18n="inprogress">In Progress</span></div>
                    <div class="status-chip" data-status="Completed" onclick="selectStatus(this)"><span
                            data-i18n="completed">Implemented</span></div>
                    <div class="status-chip" data-status="OnHold" onclick="selectStatus(this)"><span
                            data-i18n="onhold">On Hold</span></div>
                    <div class="status-chip" data-status="Canceled" onclick="selectStatus(this)"><span
                            data-i18n="canceled">Canceled</span></div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="startDate">Start Date</span> <span>*</span></label>
                <div class="date-input-wrap">
                    <input type="date" class="form-input" name="start_date">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                    </svg>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="targetDate">Target Implementation Date</label>
                <div class="date-input-wrap">
                    <input type="date" class="form-input" name="rig_down">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                    </svg>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="endDate">End Date</span> <span>*</span></label>
                <div class="date-input-wrap">
                    <input type="date" class="form-input" name="end_date">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                    </svg>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="assignedTo">Assigned To</label>
                <input type="text" class="form-input" name="assigned_to" value="ADE" placeholder="Assigned to">
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="picEmail">PIC Email</span> <span>*</span></label>
                <input type="email" class="form-input" name="pic_email" id="project-pic-email"
                    placeholder="PIC email for reminders" autocomplete="off" required>
                <p style="font-size: 11px; color: var(--text-muted); margin-top: 6px;" data-i18n="emailReminderHint">
                    Email will receive reminder 2 days before Rig Down if tasks &lt; 80% complete
                </p>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="picManagerEmail">PIC Manager Email (CC)</label>
                <input type="email" class="form-input" name="pic_manager_email" id="project-manager-email"
                    placeholder="Manager email for CC (optional)" autocomplete="new-password">
                <p style="font-size: 11px; color: var(--text-muted); margin-top: 6px;" data-i18n="managerCcHint">
                    Will be CC'd on all reminder emails
                </p>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-cancel" onclick="closeCreateModal()" data-i18n="cancel">Cancel</button>
        <button class="btn btn-save" onclick="saveProject()" data-i18n="save">Save</button>
    </div>
</div>

<!-- Create Task Modal -->
<div class="modal-overlay" id="create-task-modal">
    <div class="modal-header">
        <button class="modal-back" onclick="closeCreateTaskModal()">‚Üê</button>
        <span class="modal-title" data-i18n="createNewTask">Create New Task</span>
    </div>
    <div class="modal-body">
        <form id="create-task-form">
            <div class="form-group">
                <label class="form-label"><span data-i18n="hseProgram">HSE Program</span> <span>*</span></label>
                <select class="form-input" id="task-project-select" name="project_id"
                    onchange="onTaskProjectChange(this.value)" required>
                    <option value="" data-i18n="selectProgram">Select Program</option>
                    <!-- Filled by JS -->
                </select>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="taskIdCode">Task ID/Code</span> <span>*</span></label>
                <input type="text" class="form-input" name="code" placeholder="e.g. T-001" required>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="taskDescription">Task Description</span>
                    <span>*</span></label>
                <textarea class="form-input" name="title" placeholder="Describe the task..." rows="3"
                    required></textarea>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="implementationDate">Implementation Plan Date</span>
                    <span>*</span></label>
                <div class="date-input-wrap">
                    <input type="date" class="form-input" name="implementation_date" onchange="updateFrequencyHint()"
                        required>
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z" />
                    </svg>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="frequency">Frequency</span> <span>*</span></label>
                <select class="form-input" name="frequency" onchange="updateFrequencyHint()" required>
                    <option value="once">Once (Ad-hoc)</option>
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly (Every 3 Months)</option>
                    <option value="semi-annual">Semi-Annual (Every 6 Months)</option>
                    <option value="annual">Annual (Yearly)</option>
                </select>
                <p id="frequency-hint" style="font-size: 11px; color: var(--success); margin-top: 4px; display: none;">
                </p>
                <p id="reminder-hint" style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">üìß Email
                    reminders sent 1 month and 2 weeks before implementation date</p>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="picName">PIC Name</span> <span>*</span></label>
                <input type="text" class="form-input" name="pic_name" placeholder="Person in Charge name" required>
            </div>

            <div class="form-group">
                <label class="form-label"><span data-i18n="picEmail">PIC Email</span> <span>*</span></label>
                <input type="email" class="form-input" name="pic_email" placeholder="email@company.com" required>
                <p style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Email notifications will be sent
                    to this address</p>
            </div>

            <div class="form-group">
                <label class="form-label" data-i18n="status">Status</label>
                <div class="status-chips">
                    <div class="status-chip active" data-status="Upcoming" onclick="selectTaskStatus(this)"><span
                            data-i18n="planned">Planned</span></div>
                    <div class="status-chip" data-status="In Progress" onclick="selectTaskStatus(this)"><span
                            data-i18n="inProgress">In Progress</span></div>
                    <div class="status-chip" data-status="Completed" onclick="selectTaskStatus(this)"><span
                            data-i18n="implemented">Implemented</span></div>
                </div>
                <input type="hidden" name="status" value="Upcoming" id="new-task-status">
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-cancel" onclick="closeCreateTaskModal()" data-i18n="cancel">Cancel</button>
        <button class="btn btn-save" onclick="createNewTask()" data-i18n="saveTask">Save Task</button>
    </div>
</div>

<!-- Task Detail Modal -->
<div class="modal-overlay" id="task-modal">
    <div class="modal-header">
        <button class="modal-back" onclick="closeTaskModal()">‚Üê</button>
        <span class="modal-title" data-i18n="taskDetail">Task Detail</span>
    </div>
    <div class="modal-body">
        <div class="task-detail-content" id="task-detail-content">
            <!-- Filled by JS -->
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-cancel" onclick="closeTaskModal()">Close</button>
        <button class="btn btn-save" onclick="saveTaskChanges()">Save</button>
    </div>
</div>

<!-- Project Detail Modal -->
<div class="modal-overlay" id="project-detail-modal">
    <div class="modal-header">
        <button class="modal-back" onclick="closeProjectDetailModal()">‚Üê</button>
        <span class="modal-title" id="project-detail-title">Project Detail</span>
    </div>
    <div class="modal-body" id="project-detail-content">
        <!-- Filled by JS -->
    </div>
</div>

<!-- Download Report Modal -->
<div class="modal-overlay" id="download-modal">
    <div class="modal-header">
        <button class="modal-back" onclick="closeDownloadModal()">‚Üê</button>
        <span class="modal-title">Download Report</span>
    </div>
    <div class="modal-body" style="padding: 16px;">
        <p style="color: var(--text-secondary); margin-bottom: 16px;">
            Select a project to download compiled PDF report with all attachments.
        </p>

        <!-- Search -->
        <input type="text" class="form-input" id="download-search" placeholder="Search projects..."
            oninput="filterDownloadProjects()" style="margin-bottom: 16px;">

        <!-- Project List -->
        <div id="download-project-list" style="max-height: 400px; overflow-y: auto;">
            <!-- Filled by JS -->
        </div>

        <!-- Loading Indicator -->
        <div id="download-loading" style="display: none; text-align: center; padding: 40px;">
            <div style="font-size: 24px; margin-bottom: 10px;">üìÑ</div>
            <p style="color: var(--netflix-red);">Generating PDF Report...</p>
            <p style="font-size: 12px; color: var(--text-muted);">This may take a moment</p>
        </div>
    </div>
</div>

<script>
    // ===== CONFIG =====
    // API is on same origin since we're served from the backend
    const API_BASE = '';
    let isAdmin = false; // Global admin status for KPI and other features

    // ===== STATE =====
    let allProjects = [];
    let allTasks = [];
    let currentProjectFilter = 'all';
    let currentTaskFilter = 'all';
    let selectedStatus = 'Upcoming';
    let currentTaskId = null;
    let postAttachment = null; // For comment attachments
    let lastBackPress = 0; // Track last back button press time

    // ===== PREVIEW MODE DETECTION =====
    // Check if ?mode=preview is in URL to enable read-only mode
    const urlParams = new URLSearchParams(window.location.search);
    const isPreviewMode = urlParams.get('mode') === 'preview';

    if (isPreviewMode) {
        document.body.classList.add('preview-mode');
        console.log('[CSMS] Preview mode enabled - edit features disabled');
    }

    // ===== ADMIN AUTHENTICATION =====
    const ADMIN_CREDENTIALS = {
        username: 'CSMS_WFRD',
        password: 'Facebook1234'
    };

    // Check if admin is logged in on page load
    function checkAdminStatus() {
        isAdmin = localStorage.getItem('csms_admin_logged_in') === 'true';
        if (isAdmin) {
            document.body.classList.add('admin-mode');
            document.getElementById('admin-login-btn').style.display = 'none';
        } else {
            document.body.classList.remove('admin-mode');
            document.getElementById('admin-login-btn').style.display = 'flex';
        }
        console.log('[CSMS] Admin mode:', isAdmin);
    }

    // Show admin login modal
    function showAdminLoginModal() {
        toggleDrawer(); // Close drawer first
        document.getElementById('admin-login-modal').classList.add('active');
        document.getElementById('admin-username').value = '';
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-login-error').style.display = 'none';
    }

    // Close admin login modal
    function closeAdminLoginModal() {
        document.getElementById('admin-login-modal').classList.remove('active');
    }

    // Handle admin login
    function handleAdminLogin(event) {
        event.preventDefault();
        const username = document.getElementById('admin-username').value;
        const password = document.getElementById('admin-password').value;
        const errorDiv = document.getElementById('admin-login-error');

        if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
            // Login successful
            localStorage.setItem('csms_admin_logged_in', 'true');
            document.body.classList.add('admin-mode');
            document.getElementById('admin-login-btn').style.display = 'none';
            closeAdminLoginModal();
            showToast('Admin login successful!', 'success');
            console.log('[CSMS] Admin logged in');
        } else {
            // Login failed
            errorDiv.textContent = 'Invalid username or password';
            errorDiv.style.display = 'block';
        }
    }

    // Admin logout
    function adminLogout() {
        localStorage.removeItem('csms_admin_logged_in');
        document.body.classList.remove('admin-mode');
        document.getElementById('admin-login-btn').style.display = 'flex';
        toggleDrawer(); // Close drawer
        showToast('Logged out successfully', 'success');
        console.log('[CSMS] Admin logged out');
    }

    // Make functions global
    window.showAdminLoginModal = showAdminLoginModal;
    window.closeAdminLoginModal = closeAdminLoginModal;
    window.handleAdminLogin = handleAdminLogin;
    window.adminLogout = adminLogout;

    // Check admin status on page load
    checkAdminStatus();

    // ===== SETTINGS SYSTEM =====
    let currentLanguage = localStorage.getItem('csms_language') || 'id';
    let currentTheme = localStorage.getItem('csms_theme') || 'dark';

    function showSettingsModal() {
        const modal = document.getElementById('settings-modal');
        modal.style.display = 'flex';
        toggleDrawer(); // Close drawer
        updateSettingsUI();
    }

    function closeSettingsModal() {
        document.getElementById('settings-modal').style.display = 'none';
    }

    function updateSettingsUI() {
        // Update language selection UI
        document.querySelectorAll('.lang-option').forEach(el => {
            if (el.dataset.lang === currentLanguage) {
                el.style.borderColor = 'var(--netflix-red)';
                el.style.background = 'rgba(196, 30, 58, 0.2)';
            } else {
                el.style.borderColor = 'transparent';
                el.style.background = 'var(--bg-tertiary)';
            }
        });
        // Update theme selection UI
        document.querySelectorAll('.theme-option').forEach(el => {
            if (el.dataset.theme === currentTheme) {
                el.style.borderColor = 'var(--netflix-red)';
                el.style.background = 'rgba(196, 30, 58, 0.2)';
            } else {
                el.style.borderColor = 'transparent';
                el.style.background = 'var(--bg-tertiary)';
            }
        });
    }

    function setLanguage(lang) {
        currentLanguage = lang;
        localStorage.setItem('csms_language', lang);
        updateSettingsUI();
        // Instant full page translation
        applyAllTranslations();
    }

    function getLanguageName(code) {
        const names = { 'id': 'Bahasa Indonesia', 'en': 'English', 'ar': 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', 'hi': '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä' };
        return names[code] || code;
    }

    function setTheme(theme) {
        currentTheme = theme;
        localStorage.setItem('csms_theme', theme);
        applyTheme(theme);
        updateSettingsUI();
        showToast('Theme changed!', 'success');
    }

    function applyTheme(theme) {
        const root = document.documentElement;
        const themes = {
            dark: { bg: '#121212', bgSecondary: '#1E1E1E', bgTertiary: '#2D2D2D', border: '#404040', text: '#FFFFFF', textSecondary: '#B3B3B3', textMuted: '#808080' },
            light: { bg: '#FFFFFF', bgSecondary: '#F8F9FA', bgTertiary: '#E9ECEF', border: '#DEE2E6', text: '#212529', textSecondary: '#495057', textMuted: '#6C757D' },
            ocean: { bg: '#0A1929', bgSecondary: '#0C2D48', bgTertiary: '#145C8E', border: '#1A5276', text: '#E8F4FC', textSecondary: '#B3D9F2', textMuted: '#7AB8D9' },
            forest: { bg: '#0D1F0C', bgSecondary: '#134E0F', bgTertiary: '#1E7E19', border: '#28A821', text: '#E8F5E9', textSecondary: '#A5D6A7', textMuted: '#66BB6A' },
            sunset: { bg: '#1A0A06', bgSecondary: '#3E1A10', bgTertiary: '#6E2C18', border: '#B04420', text: '#FFEEE6', textSecondary: '#FFB399', textMuted: '#FF8050' }
        };
        const t = themes[theme] || themes.dark;
        root.style.setProperty('--bg-primary', t.bg);
        root.style.setProperty('--bg-secondary', t.bgSecondary);
        root.style.setProperty('--bg-tertiary', t.bgTertiary);
        root.style.setProperty('--border', t.border);
        root.style.setProperty('--text-primary', t.text);
        root.style.setProperty('--text-secondary', t.textSecondary);
        root.style.setProperty('--text-muted', t.textMuted);
        document.body.style.background = t.bg;
    }

    // ===== TRANSLATIONS =====
    const translations = {
        id: {
            // Navigation
            home: 'Beranda', projects: 'Proyek', tasks: 'Tugas', statistics: 'Statistik',
            schedule: 'Jadwal', csmsPb: 'CSMS-PB', calendar: 'Kalender', settings: 'Pengaturan',
            adminLogin: 'Masuk Admin', logout: 'Keluar',
            // Home
            welcome: 'Selamat Datang!', projectManagement: 'Sistem Manajemen Proyek CSMS',
            inProgress: 'Dalam Proses', upcoming: 'Akan Datang', completed: 'Selesai', onhold: 'Ditahan', canceled: 'Dibatalkan', ongoing: 'Berlangsung',
            progress: 'Kemajuan',
            // Actions
            createProject: 'Buat Proyek', createTask: 'Buat Tugas', post: 'Kirim',
            reply: 'Balas', like: 'Suka', likes: 'Suka', save: 'Simpan', cancel: 'Batal',
            delete: 'Hapus', edit: 'Edit', search: 'Cari', filter: 'Filter',
            // Comments
            shareComment: 'Bagikan Komentar', yourName: 'Nama Anda', productLine: 'Lini Produk',
            writeComment: 'Tulis komentar atau update...', statusUpdates: 'Status Update',
            photo: 'Foto', file: 'File', writeReply: 'Tulis balasan...',
            // Project Form
            projectName: 'Nama Proyek', title: 'Judul', well: 'Sumur', status: 'Status', kontrakNo: 'No Kontrak',
            startDate: 'Tanggal Mulai', endDate: 'Tanggal Selesai', client: 'Klien', deleteProject: 'Hapus Proyek', deleteTask: 'Hapus Tugas',
            // Create Forms
            createNewProject: 'Buat Proyek Baru', createNewTask: 'Buat Tugas Baru', projectStatus: 'Status Proyek',
            rigDownEstimate: 'Estimasi Rig Down', assignedTo: 'Ditugaskan Ke', picEmail: 'Email PIC', picManagerEmail: 'Email Manajer PIC (CC)',
            emailReminderHint: 'Email akan menerima pengingat 2 hari sebelum Rig Down jika tugas < 80% selesai',
            managerCcHint: 'Akan di-CC di semua email pengingat', selectProject: 'Pilih Proyek', wellName: 'Nama Sumur',
            taskIdCode: 'ID/Kode Tugas', taskDescription: 'Deskripsi Tugas', taskDetail: 'Detail Tugas',
            // Task
            taskCode: 'Kode Tugas', taskName: 'Nama Tugas', description: 'Deskripsi',
            dueDate: 'Tenggat Waktu', priority: 'Prioritas', assignee: 'Ditugaskan Ke',
            // Task Detail
            project: 'PROYEK', unknownProject: 'Proyek Tidak Dikenal', uploadAttachment: 'Unggah Lampiran (Tak Terbatas)',
            clickToUpload: 'Klik untuk mengunggah file ke Google Drive', filesStoredInDrive: 'File disimpan di Drive saja, tidak di aplikasi',
            uploadedFiles: 'File Terunggah', close: 'Tutup',
            // Status
            all: 'Semua', onHold: 'Ditahan', canceled: 'Dibatalkan',
            // Statistics Dashboard
            dashboard: 'Dasbor', totalProjects: 'Total Proyek', totalTasks: 'Total Tugas',
            completionRate: 'Tingkat Penyelesaian', upcomingMWT: 'MWT Mendatang', tapToView: 'Ketuk untuk melihat ‚Üí',
            tapForTasks: 'Ketuk untuk tugas ‚Üí', tapForSchedule: 'Ketuk untuk jadwal ‚Üí',
            projectStatusDistribution: 'Distribusi Status Proyek', taskStatusDistribution: 'Distribusi Status Tugas',
            projectTaskCompletion: 'Penyelesaian Tugas Proyek', scheduleOverview: 'üìÖ Ikhtisar Jadwal - Semua Jenis Rapat',
            mwtPlan: 'üìÖ Rencana MWT', hseCommittee: 'üè¢ Komite HSE', csmsPb: '‚úÖ CSMS PB',
            hsePlan: 'üìã Rencana HSE', sprMeeting: 'üìä Rapat SPR', hazidHazop: '‚ö†Ô∏è HAZID/HAZOP',
            csmsPbAudit: '‚úÖ Audit CSMS PB', hsePlanMeeting: 'üìã Rapat Rencana HSE',
            totalSchedules: 'Total Jadwal', thisMonth: 'Bulan Ini',
            csmsPbAuditScores: 'üìã Skor Audit CSMS PB', totalRecords: 'Total Rekaman',
            lowestScore: 'Skor Terendah', highestScore: 'Skor Tertinggi', average: 'Rata-rata',
            pbScoresByWell: 'Skor PB per Sumur', analyticsDashboard: 'üìä Dasbor Analitik',
            scheduleTypesDistribution: 'Distribusi Jenis Jadwal', taskStatusOverview: 'Ikhtisar Status Tugas',
            projectProgressOverview: 'Ikhtisar Kemajuan Proyek', monthlyActivityTrend: 'Tren Aktivitas Bulanan',
            monthlyChartsGallery: 'üìà Galeri Grafik Bulanan', mwtPlanScheduleByMonth: 'üìÖ Jadwal Rencana MWT per Bulan',
            submitPbRecord: 'Kirim Rekaman PB', recentRecords: 'Rekaman Terbaru', csmsPbScreen: 'Status CSMS PB',
            // Settings
            language: 'Bahasa', theme: 'Tema', darkMode: 'Mode Gelap', lightMode: 'Mode Terang',
            oceanBlue: 'Biru Lautan', forestGreen: 'Hijau Hutan', sunsetOrange: 'Oranye Senja',
            // Time
            justNow: 'Baru saja', minutesAgo: 'm lalu', hoursAgo: 'j lalu', daysAgo: 'h lalu',
            // Quick Actions
            quickActions: 'Aksi Cepat', newProject: 'Proyek Baru', viewTasks: 'Lihat Tugas', download: 'Unduh', recentActivity: 'Aktivitas Terkini',
            // Additional Drawer
            relatedDocs: 'Dokumen Terkait', adminModeActive: 'Mode Admin Aktif', previewMode: 'MODE PRATINJAU',
            // Calendar
            calendarTitle: 'Kalender', meetingProjectCalendars: 'Kalender Rapat & Proyek', meetingCalendar: 'Kalender Rapat', projectCalendar: 'Kalender Proyek',
            // Bottom Nav
            statistics: 'Statistik', docs: 'Dokumen',
            // Related Documents
            uploadDocument: 'Unggah Dokumen', documentName: 'Nama Dokumen', attachment: 'Lampiran', selectFile: 'Pilih File',
            noFileSelected: 'Tidak ada file dipilih', uploadedDocuments: 'Dokumen Terunggah', noDocumentsYet: 'Belum ada dokumen yang diunggah',
            noStatusUpdatesYet: 'Belum ada pembaruan status. Jadilah yang pertama memposting!',
            checkReminders: 'Cek Pengingat', refreshStats: 'Muat Ulang Statistik',
            upcoming: 'Akan Datang', inprogress: 'Sedang Berlangsung', completed: 'Selesai', onhold: 'Ditunda', canceled: 'Dibatalkan',
            allProjects: 'Semua Proyek', allTasks: 'Semua Tugas', noProjectsIn: 'Tidak ada proyek di', noTasksIn: 'Tidak ada tugas di',
            enterProjectName: 'Masukkan nama proyek', enterTitle: 'Masukkan judul', enterWell: 'Masukkan sumur', enterKontrakNumber: 'Masukkan nomor kontrak', enterWellName: 'Masukkan nama sumur',
            ongoing: 'Sedang Berlangsung', assignedToPlaceholder: 'Ditugaskan ke', picEmailPlaceholder: 'Email PIC untuk pengingat', managerEmailPlaceholder: 'Email manajer untuk CC (opsional)',
            taskCodePlaceholder: 'contoh T-001', describeTask: 'Jelaskan tugas...',
            weekly: 'Mingguan', monthly: 'Bulanan',
            sun: 'Min', mon: 'Sen', tue: 'Sel', wed: 'Rab', thu: 'Kam', fri: 'Jum', sat: 'Sab',
            jan: 'Jan', feb: 'Feb', mar: 'Mar', apr: 'Apr', may: 'Mei', jun: 'Jun', jul: 'Jul', aug: 'Agu', sep: 'Sep', oct: 'Okt', nov: 'Nov', dec: 'Des',
            // Schedule
            scheduleTitle: 'Jadwal', createSchedule: 'Buat Jadwal', allUpcomingSchedules: 'üìã Semua Jadwal Mendatang', scheduledFor: 'Dijadwalkan untuk',
            mwtPlanSchedule: 'Jadwal Rencana MWT', hseCommitteeMeeting: 'Rapat Komite HSE', showingUpcoming3Months: 'Menampilkan 3 bulan mendatang',
            scheduleType: 'Jenis Jadwal', selectScheduleType: 'Pilih jenis jadwal', selectProject: 'Pilih proyek', assignedTo: 'Ditugaskan Ke',
            // Schedule Form Fields
            selectAProject: 'Pilih proyek', mwtPlanDate: 'Tanggal Rencana MWT', hseCommitteeMeetingDate: 'Tanggal Rapat Komite HSE',
            csmsPbAuditDate: 'Tanggal Audit CSMS PB', hsePlanMeetingDate: 'Tanggal Rapat Rencana HSE', sprMeetingDate: 'Tanggal Rapat SPR',
            hazidHazopMeetingDate: 'Tanggal Rapat HAZID/HAZOP', pic: 'PIC', namePlaceholder: 'Nama', emailPlaceholder: 'Email (contoh: john@weatherford.com)',
            hseCommitteeMeetingSchedule: 'Jadwal Rapat Komite HSE', noSchedulesInPeriod: 'Tidak ada jadwal di periode terpilih', all: 'Semua',
            // Statistics
            statisticsTitle: 'Statistik', projectOverview: 'Ringkasan Proyek', taskOverview: 'Ringkasan Tugas', monthlyCharts: 'Grafik Bulanan',
            tasksPerProject: 'Tugas per Proyek', projectsCreatedByMonth: 'Proyek Dibuat per Bulan', taskCompletionRate: 'Tingkat Penyelesaian Tugas',
            // Monthly Charts Gallery
            janDecTrends: 'Tren Jan - Des untuk semua data', hseCommitteeMeetingByMonth: 'üè¢ Rapat Komite HSE per Bulan',
            hsePlanMeetingByMonth: 'üìã Rapat Rencana HSE per Bulan', sprMeetingByMonth: 'üìä Rapat SPR per Bulan',
            hazidHazopMeetingByMonth: '‚ö†Ô∏è Rapat HAZID/HAZOP per Bulan', csmsPbAuditByMonth: '‚úÖ Audit CSMS PB per Bulan',
            taskCompletionRateByMonth: '‚úì Tingkat Penyelesaian Tugas per Bulan', pbScoresByMonth: 'üìã Skor PB per Bulan',
            yAxisScoreLabel: 'Sumbu Y: Skor (0-100) | Titik berwarna per proyek',
            // Schedule Type Labels
            mwtShort: 'MWT', hseShort: 'HSE', csmsShort: 'CSMS', hsePlanShort: 'Rencana HSE', sprShort: 'SPR', hazidShort: 'HAZID',
            // Project Chart Gallery
            projectChartGallery: 'üìÅ Galeri Grafik Proyek', xAxisProjectsYAxisValues: 'Sumbu X: Proyek | Sumbu Y: Nilai',
            schedulesPerProject: 'üìÖ Jadwal per Proyek', pbRecordsPerProject: 'üìã Rekaman PB per Proyek',
            taskCompletionRatePerProject: '‚úì Tingkat Penyelesaian Tugas per Proyek (%)', averagePbScorePerProject: 'üìä Rata-rata Skor PB per Proyek',
            pbScoreColorLegend: 'Warna: üü¢ ‚â•80 | üü° ‚â•60 | üî¥ <60', noData: 'Tidak ada data',
            // Forms
            emailNotification: 'Notifikasi email akan dikirim ke alamat ini', allCreatedSchedulesByType: 'Semua jadwal yang dibuat berdasarkan jenis',
            // PB Screen
            csmsPbScreen: 'CSMS PB', addNewRecord: 'Tambah Rekaman Baru', pbRecords: 'Rekaman PB', score: 'Skor', date: 'Tanggal', notes: 'Catatan',
            // Home Screen Posts
            csmsAdmin: 'Admin CSMS', systemAnnouncement: 'Pengumuman Sistem', welcomeNewDashboard: 'Selamat datang di Dashboard CSMS baru! Kami telah menambahkan fitur baru termasuk laporan proyek, pengingat email, dan tampilan statistik yang lebih baik. Beri tahu kami umpan balik Anda!',
            projectUpdate: 'Update Proyek', autoGenerated: 'Otomatis', today: 'Hari ini', greatProgress: 'Kemajuan Hebat!',
            projectTasksMoving: 'Tugas proyek berjalan lancar. Periksa dasbor Statistik untuk tingkat penyelesaian terperinci.',
            overallCompletion: 'Penyelesaian Keseluruhan', like: 'Suka', comment: 'Komentar',
            // Activity Log
            projectsLoadedSuccess: 'Proyek berhasil dimuat', checkingScheduleReminders: 'Memeriksa pengingat jadwal...', dashboardReady: 'Dashboard siap'
        },
        en: {
            // Navigation
            home: 'Home', hsePrograms: 'HSE Programs', tasks: 'Tasks', statistics: 'Statistics',
            schedule: 'Schedule', csmsPb: 'CSMS-PB', calendar: 'Calendar', settings: 'Settings',
            adminLogin: 'Admin Login', logout: 'Logout',
            // Home - HSE specific
            welcome: 'Welcome!', hsePlanManagement: 'HSE Plan Management System',
            inProgress: 'In Progress', upcoming: 'Planned', completed: 'Implemented', onhold: 'On Hold', canceled: 'Canceled', ongoing: 'Ongoing',
            planned: 'Planned', implemented: 'Implemented', compliance: 'Compliance',
            progress: 'Progress',
            // HSE Program specific
            totalPrograms: 'Total HSE Programs', implementedPrograms: 'Implemented', implementationRate: 'Implementation Rate',
            upcomingPrograms: 'Upcoming Programs', programStatusDistribution: 'Program Status Distribution',
            createProgram: 'Create New Program', createNewProgram: 'Create New Program', programName: 'Program Name',
            programCategory: 'Category', programStatus: 'Program Status', targetDate: 'Target Implementation Date',
            // Leading/Lagging Indicators
            leadingIndicators: 'Leading Indicators', laggingIndicators: 'Lagging Indicators',
            hseTraining: 'HSE Training', emergencyDrill: 'Emergency Drill', observationCard: 'Observation Card (RADAR)',
            safeManhours: 'Safe Manhours', lti: 'LTI', mtc: 'MTC', recordableIncident: 'Recordable Incident',
            trir: 'TRIR', mvir: 'MVIR', fiveYearData: '5-Year Historical Data',
            // Actions
            createProject: 'Create Program', createTask: 'Create Task', post: 'Post',
            reply: 'Reply', like: 'Like', likes: 'Likes', save: 'Save', cancel: 'Cancel',
            delete: 'Delete', edit: 'Edit', search: 'Search', filter: 'Filter',
            // Comments
            shareComment: 'Share a Comment', yourName: 'Your Name', productLine: 'Product Line',
            writeComment: 'Write your comment or update...', statusUpdates: 'Status Updates',
            photo: 'Photo', file: 'File', writeReply: 'Write a reply...',
            // Project Form
            projectName: 'Project Name', title: 'Title', well: 'Well', status: 'Status', kontrakNo: 'Contract No',
            startDate: 'Start Date', endDate: 'End Date', client: 'Client', deleteProject: 'Delete Project', deleteTask: 'Delete Task',
            // Create Forms
            createNewProject: 'Create New Project', createNewTask: 'Create New Task', projectStatus: 'Project Status',
            rigDownEstimate: 'Rig Down Estimate', assignedTo: 'Assigned To', picEmail: 'PIC Email', picManagerEmail: 'PIC Manager Email (CC)',
            emailReminderHint: 'Email will receive reminder 2 days before Rig Down if tasks < 80% complete',
            managerCcHint: 'Will be CC\'d on all reminder emails', selectProject: 'Select Project', wellName: 'Well Name',
            taskIdCode: 'Task ID/Code', taskDescription: 'Task Description', taskDetail: 'Task Detail',
            // Task
            taskCode: 'Task Code', taskName: 'Task Name', description: 'Description',
            dueDate: 'Due Date', priority: 'Priority', assignee: 'Assignee',
            // Task Detail
            project: 'PROJECT', unknownProject: 'Unknown Project', uploadAttachment: 'Upload Attachment (Unlimited)',
            clickToUpload: 'Click to upload file to Google Drive', filesStoredInDrive: 'Files are stored in Drive only, not in app',
            uploadedFiles: 'Uploaded Files', close: 'Close',
            // Status
            all: 'All', onHold: 'On Hold', canceled: 'Canceled',
            // Statistics Dashboard
            dashboard: 'Dashboard', totalProjects: 'Total Projects', totalTasks: 'Total Tasks',
            completionRate: 'Completion Rate', upcomingMWT: 'Upcoming MWT', tapToView: 'Tap to view ‚Üí',
            tapForTasks: 'Tap for tasks ‚Üí', tapForSchedule: 'Tap for schedule ‚Üí',
            projectStatusDistribution: 'Project Status Distribution', taskStatusDistribution: 'Task Status Distribution',
            projectTaskCompletion: 'Project Task Completion', scheduleOverview: 'üìÖ Schedule Overview - All Meeting Types',
            mwtPlan: 'üìÖ MWT Plan', hseCommittee: 'üè¢ HSE Committee', csmsPb: '‚úÖ CSMS PB',
            hsePlan: 'üìã HSE Plan', sprMeeting: 'üìä SPR Meeting', hazidHazop: '‚ö†Ô∏è HAZID/HAZOP',
            csmsPbAudit: '‚úÖ CSMS PB Audit', hsePlanMeeting: 'üìã HSE Plan Meeting',
            totalSchedules: 'Total Schedules', thisMonth: 'This Month',
            csmsPbAuditScores: 'üìã CSMS PB Audit Scores', totalRecords: 'Total Records',
            lowestScore: 'Lowest Score', highestScore: 'Highest Score', average: 'Average',
            pbScoresByWell: 'PB Scores by Well', analyticsDashboard: 'üìä Analytics Dashboard',
            scheduleTypesDistribution: 'Schedule Types Distribution', taskStatusOverview: 'Task Status Overview',
            projectProgressOverview: 'Project Progress Overview', monthlyActivityTrend: 'Monthly Activity Trend',
            monthlyChartsGallery: 'üìà Monthly Charts Gallery', mwtPlanScheduleByMonth: 'üìÖ MWT Plan Schedule by Month',
            submitPbRecord: 'Submit PB Record', recentRecords: 'Recent Records', csmsPbScreen: 'CSMS PB Status',
            // Settings
            language: 'Language', theme: 'Theme', darkMode: 'Dark Mode', lightMode: 'Light Mode',
            oceanBlue: 'Ocean Blue', forestGreen: 'Forest Green', sunsetOrange: 'Sunset Orange',
            // Time
            justNow: 'Just now', minutesAgo: 'm ago', hoursAgo: 'h ago', daysAgo: 'd ago',
            // Quick Actions
            quickActions: 'Quick Actions', newProject: 'New Project', viewTasks: 'View Tasks', download: 'Download', recentActivity: 'Recent Activity',
            // Additional Drawer
            relatedDocs: 'Related Docs', adminModeActive: 'Admin Mode Active', previewMode: 'PREVIEW MODE',
            // Calendar
            calendarTitle: 'Calendar', meetingProjectCalendars: 'Meeting & Project Calendars', meetingCalendar: 'Meeting Calendar', projectCalendar: 'Project Calendar',
            // Bottom Nav
            statistics: 'Statistics', docs: 'Docs',
            // Related Documents
            uploadDocument: 'Upload Document', documentName: 'Document Name', attachment: 'Attachment', selectFile: 'Select File',
            noFileSelected: 'No file selected', uploadedDocuments: 'Uploaded Documents', noDocumentsYet: 'No documents uploaded yet',
            noStatusUpdatesYet: 'No status updates yet. Be the first to post!',
            checkReminders: 'Check Reminders', refreshStats: 'Refresh Stats',
            upcoming: 'Upcoming', inprogress: 'In Progress', completed: 'Completed', onhold: 'On Hold', canceled: 'Canceled',
            allProjects: 'All Projects', allTasks: 'All Tasks', noProjectsIn: 'No projects in', noTasksIn: 'No tasks in',
            enterProjectName: 'Enter project name', enterTitle: 'Enter title', enterWell: 'Enter well', enterKontrakNumber: 'Enter kontrak number', enterWellName: 'Enter well name',
            ongoing: 'Ongoing', assignedToPlaceholder: 'Assigned to', picEmailPlaceholder: 'PIC email for reminders', managerEmailPlaceholder: 'Manager email for CC (optional)',
            taskCodePlaceholder: 'e.g. T-001', describeTask: 'Describe the task...',
            weekly: 'Weekly', monthly: 'Monthly',
            sun: 'Sun', mon: 'Mon', tue: 'Tue', wed: 'Wed', thu: 'Thu', fri: 'Fri', sat: 'Sat',
            jan: 'Jan', feb: 'Feb', mar: 'Mar', apr: 'Apr', may: 'May', jun: 'Jun', jul: 'Jul', aug: 'Aug', sep: 'Sep', oct: 'Oct', nov: 'Nov', dec: 'Dec',
            // Schedule
            scheduleTitle: 'Schedule', createSchedule: 'Create Schedule', allUpcomingSchedules: 'üìã All Upcoming Schedules', scheduledFor: 'Scheduled for',
            mwtPlanSchedule: 'MWT Plan Schedule', hseCommitteeMeeting: 'HSE Committee Meeting', showingUpcoming3Months: 'Showing upcoming 3 months',
            scheduleType: 'Schedule Type', selectScheduleType: 'Select schedule type', selectProject: 'Select project', assignedTo: 'Assigned To',
            // Schedule Form Fields
            selectAProject: 'Select a project', mwtPlanDate: 'MWT Plan Date', hseCommitteeMeetingDate: 'HSE Committee Meeting Date',
            csmsPbAuditDate: 'CSMS PB Audit Date', hsePlanMeetingDate: 'HSE Plan Meeting Date', sprMeetingDate: 'SPR Meeting Date',
            hazidHazopMeetingDate: 'HAZID/HAZOP Meeting Date', pic: 'PIC', namePlaceholder: 'Name', emailPlaceholder: 'Email (e.g. john@weatherford.com)',
            hseCommitteeMeetingSchedule: 'HSE Committee Meeting Schedule', noSchedulesInPeriod: 'No schedules in selected period', all: 'All',
            // Statistics
            statisticsTitle: 'Statistics', projectOverview: 'Project Overview', taskOverview: 'Task Overview', monthlyCharts: 'Monthly Charts',
            tasksPerProject: 'Tasks per Project', projectsCreatedByMonth: 'Projects Created by Month', taskCompletionRate: 'Task Completion Rate',
            // Monthly Charts Gallery
            janDecTrends: 'Jan - Dec trends across all data', hseCommitteeMeetingByMonth: 'üè¢ HSE Committee Meeting by Month',
            hsePlanMeetingByMonth: 'üìã HSE Plan Meeting by Month', sprMeetingByMonth: 'üìä SPR Meeting by Month',
            hazidHazopMeetingByMonth: '‚ö†Ô∏è HAZID/HAZOP Meeting by Month', csmsPbAuditByMonth: '‚úÖ CSMS PB Audit by Month',
            taskCompletionRateByMonth: '‚úì Task Completion Rate by Month', pbScoresByMonth: 'üìã PB Scores by Month',
            yAxisScoreLabel: 'Y-axis: Score (0-100) | Dots colored by project',
            // Schedule Type Labels
            mwtShort: 'MWT', hseShort: 'HSE', csmsShort: 'CSMS', hsePlanShort: 'HSE Plan', sprShort: 'SPR', hazidShort: 'HAZID',
            // Project Chart Gallery
            projectChartGallery: 'üìÅ Project Chart Gallery', xAxisProjectsYAxisValues: 'X-axis: Projects | Y-axis: Values',
            schedulesPerProject: 'üìÖ Schedules per Project', pbRecordsPerProject: 'üìã PB Records per Project',
            taskCompletionRatePerProject: '‚úì Task Completion Rate per Project (%)', averagePbScorePerProject: 'üìä Average PB Score per Project',
            pbScoreColorLegend: 'Color: üü¢ ‚â•80 | üü° ‚â•60 | üî¥ <60', noData: 'No data',
            // Forms
            emailNotification: 'An email notification will be sent to this address', allCreatedSchedulesByType: 'All created schedules by type',
            // PB Screen
            csmsPbScreen: 'CSMS PB', addNewRecord: 'Add New Record', pbRecords: 'PB Records', score: 'Score', date: 'Date', notes: 'Notes',
            // Home Screen Posts
            csmsAdmin: 'CSMS Admin', systemAnnouncement: 'System Announcement', welcomeNewDashboard: 'Welcome to the new CSMS Dashboard! We\'ve added new features including project reports, email reminders, and an improved statistics view. Let us know your feedback!',
            projectUpdate: 'Project Update', autoGenerated: 'Auto-generated', today: 'Today', greatProgress: 'Great Progress!',
            projectTasksMoving: 'Project tasks are moving forward smoothly. Check the Statistics dashboard for detailed completion rates.',
            overallCompletion: 'Overall Completion', like: 'Like', comment: 'Comment',
            // Activity Log
            projectsLoadedSuccess: 'Projects loaded successfully', checkingScheduleReminders: 'Checking for schedule reminders...', dashboardReady: 'Dashboard ready'
        },
        ar: {
            // Navigation
            home: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©', projects: 'ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ', tasks: 'ÿßŸÑŸÖŸáÿßŸÖ', statistics: 'ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™',
            schedule: 'ÿßŸÑÿ¨ÿØŸàŸÑ', csmsPb: 'CSMS-PB', calendar: 'ÿßŸÑÿ™ŸÇŸàŸäŸÖ', settings: 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
            adminLogin: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ¥ÿ±ŸÅ', logout: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨',
            // Home
            welcome: 'ŸÖÿ±ÿ≠ÿ®ÿßŸã!', projectManagement: 'ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ŸÖÿ¥ÿßÿ±Ÿäÿπ CSMS',
            inProgress: 'ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞', upcoming: 'ŸÇÿßÿØŸÖ', completed: 'ŸÖŸÉÿ™ŸÖŸÑ', onhold: 'ŸÖÿπŸÑŸÇ', canceled: 'ŸÖŸÑÿ∫Ÿä', ongoing: 'ÿ¨ÿßÿ±Ÿç',
            progress: 'ÿßŸÑÿ™ŸÇÿØŸÖ',
            // Home Screen Posts
            csmsAdmin: 'ŸÖÿ¥ÿ±ŸÅ CSMS', systemAnnouncement: 'ÿ•ÿπŸÑÿßŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ', welcomeNewDashboard: 'ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÑŸàÿ≠ÿ© ŸÇŸäÿßÿØÿ© CSMS ÿßŸÑÿ¨ÿØŸäÿØÿ©!',
            projectUpdate: 'ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', autoGenerated: 'ÿ™ŸÑŸÇÿßÿ¶Ÿä', today: 'ÿßŸÑŸäŸàŸÖ', greatProgress: 'ÿ™ŸÇÿØŸÖ ÿ±ÿßÿ¶ÿπ!',
            projectTasksMoving: 'ŸÖŸáÿßŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ ÿ™ÿ≥Ÿäÿ± ÿ®ÿ≥ŸÑÿßÿ≥ÿ©.', overallCompletion: 'ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑŸÉŸÑŸä', comment: 'ÿ™ÿπŸÑŸäŸÇ',
            projectsLoadedSuccess: 'ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ ÿ®ŸÜÿ¨ÿßÿ≠', checkingScheduleReminders: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™ ÿßŸÑÿ¨ÿØŸàŸÑ...', dashboardReady: 'ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ© ÿ¨ÿßŸáÿ≤ÿ©',
            createProject: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ', createTask: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ©', post: 'ŸÜÿ¥ÿ±',
            reply: 'ÿ±ÿØ', like: 'ÿ•ÿπÿ¨ÿßÿ®', likes: 'ÿ•ÿπÿ¨ÿßÿ®ÿßÿ™', save: 'ÿ≠ŸÅÿ∏', cancel: 'ÿ•ŸÑÿ∫ÿßÿ°',
            delete: 'ÿ≠ÿ∞ŸÅ', edit: 'ÿ™ÿπÿØŸäŸÑ', search: 'ÿ®ÿ≠ÿ´', filter: 'ÿ™ÿµŸÅŸäÿ©',
            // Comments
            shareComment: 'ÿ¥ÿßÿ±ŸÉ ÿ™ÿπŸÑŸäŸÇ', yourName: 'ÿßÿ≥ŸÖŸÉ', productLine: 'ÿÆÿ∑ ÿßŸÑŸÖŸÜÿ™ÿ¨',
            writeComment: 'ÿßŸÉÿ™ÿ® ÿ™ÿπŸÑŸäŸÇŸÉ ÿ£Ÿà ÿ™ÿ≠ÿØŸäÿ´ŸÉ...', statusUpdates: 'ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑÿ©',
            photo: 'ÿµŸàÿ±ÿ©', file: 'ŸÖŸÑŸÅ', writeReply: 'ÿßŸÉÿ™ÿ® ÿ±ÿØ...',
            // Project Form
            projectName: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', title: 'ÿßŸÑÿπŸÜŸàÿßŸÜ', well: 'ÿßŸÑÿ®ÿ¶ÿ±', status: 'ÿßŸÑÿ≠ÿßŸÑÿ©', kontrakNo: 'ÿ±ŸÇŸÖ ÿßŸÑÿπŸÇÿØ',
            startDate: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿ°', endDate: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°', client: 'ÿßŸÑÿπŸÖŸäŸÑ', deleteProject: 'ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', deleteTask: 'ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸáŸÖÿ©',
            // Create Forms
            createNewProject: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¥ÿ±Ÿàÿπ ÿ¨ÿØŸäÿØ', createNewTask: 'ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸáŸÖÿ© ÿ¨ÿØŸäÿØÿ©', projectStatus: 'ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ',
            rigDownEstimate: 'ÿ™ŸÇÿØŸäÿ± ÿ•ŸÜÿ≤ÿßŸÑ ÿßŸÑÿ≠ŸÅÿßÿ±', assignedTo: 'ŸÖÿ≥ŸÜÿØ ÿ•ŸÑŸâ', picEmail: 'ÿ®ÿ±ŸäÿØ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ', picManagerEmail: 'ÿ®ÿ±ŸäÿØ ŸÖÿØŸäÿ± ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ (CC)',
            emailReminderHint: 'ÿ≥Ÿäÿ™ŸÑŸÇŸâ ÿßŸÑÿ®ÿ±ŸäÿØ ÿ™ÿ∞ŸÉŸäÿ±Ÿãÿß ŸÇÿ®ŸÑ ŸäŸàŸÖŸäŸÜ ŸÖŸÜ ÿ•ŸÜÿ≤ÿßŸÑ ÿßŸÑÿ≠ŸÅÿßÿ± ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑŸÖŸáÿßŸÖ < 80% ŸÖŸÉÿ™ŸÖŸÑÿ©',
            managerCcHint: 'ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ŸÜÿ≥ÿÆÿ© ŸÑŸÑŸÖÿØŸäÿ± ŸÅŸä ÿ¨ŸÖŸäÿπ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ÿ∞ŸÉŸäÿ±', selectProject: 'ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', wellName: 'ÿßÿ≥ŸÖ ÿßŸÑÿ®ÿ¶ÿ±',
            taskIdCode: 'ÿ±ŸÖÿ≤ ÿßŸÑŸÖŸáŸÖÿ©', taskDescription: 'ŸàÿµŸÅ ÿßŸÑŸÖŸáŸÖÿ©', taskDetail: 'ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸáŸÖÿ©',
            // Task
            taskCode: 'ÿ±ŸÖÿ≤ ÿßŸÑŸÖŸáŸÖÿ©', taskName: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸáŸÖÿ©', description: 'ÿßŸÑŸàÿµŸÅ',
            dueDate: 'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßÿ≥ÿ™ÿ≠ŸÇÿßŸÇ', priority: 'ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©', assignee: 'ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ',
            // Task Detail
            project: 'ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', unknownProject: 'ŸÖÿ¥ÿ±Ÿàÿπ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ', uploadAttachment: 'ÿ±ŸÅÿπ ÿßŸÑŸÖÿ±ŸÅŸÇÿßÿ™ (ÿ∫Ÿäÿ± ŸÖÿ≠ÿØŸàÿØ)',
            clickToUpload: 'ÿßŸÜŸÇÿ± ŸÑÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ ÿ•ŸÑŸâ Google Drive', filesStoredInDrive: 'Ÿäÿ™ŸÖ ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÅŸä Drive ŸÅŸÇÿ∑',
            uploadedFiles: 'ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ±ŸÅŸàÿπÿ©', close: 'ÿ•ÿ∫ŸÑÿßŸÇ',
            all: 'ÿßŸÑŸÉŸÑ', onHold: 'ŸÖÿπŸÑŸÇ', canceled: 'ŸÖŸÑÿ∫Ÿä',
            // Statistics Dashboard
            dashboard: 'ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ©', totalProjects: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ', totalTasks: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸáÿßŸÖ',
            completionRate: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤', upcomingMWT: 'MWT ÿßŸÑŸÇÿßÿØŸÖÿ©', tapToView: 'ÿßŸÜŸÇÿ± ŸÑŸÑÿπÿ±ÿ∂ ‚Üí',
            tapForTasks: 'ÿßŸÜŸÇÿ± ŸÑŸÑŸÖŸáÿßŸÖ ‚Üí', tapForSchedule: 'ÿßŸÜŸÇÿ± ŸÑŸÑÿ¨ÿØŸàŸÑ ‚Üí',
            projectStatusDistribution: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', taskStatusDistribution: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸáÿßŸÖ',
            projectTaskCompletion: 'ÿ•ŸÜÿ¨ÿßÿ≤ ŸÖŸáÿßŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', scheduleOverview: 'üìÖ ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑÿ¨ÿØŸàŸÑ - ÿ¨ŸÖŸäÿπ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπÿßÿ™',
            mwtPlan: 'üìÖ ÿÆÿ∑ÿ© MWT', hseCommittee: 'üè¢ ŸÑÿ¨ŸÜÿ© HSE', csmsPb: '‚úÖ CSMS PB',
            hsePlan: 'üìã ÿÆÿ∑ÿ© HSE', sprMeeting: 'üìä ÿßÿ¨ÿ™ŸÖÿßÿπ SPR', hazidHazop: '‚ö†Ô∏è HAZID/HAZOP',
            csmsPbAudit: '‚úÖ ÿ™ÿØŸÇŸäŸÇ CSMS PB', hsePlanMeeting: 'üìã ÿßÿ¨ÿ™ŸÖÿßÿπ ÿÆÿ∑ÿ© HSE',
            totalSchedules: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ¨ÿØÿßŸàŸÑ', thisMonth: 'Ÿáÿ∞ÿß ÿßŸÑÿ¥Ÿáÿ±',
            csmsPbAuditScores: 'üìã ÿØÿ±ÿ¨ÿßÿ™ ÿ™ÿØŸÇŸäŸÇ CSMS PB', totalRecords: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™',
            lowestScore: 'ÿ£ÿØŸÜŸâ ÿØÿ±ÿ¨ÿ©', highestScore: 'ÿ£ÿπŸÑŸâ ÿØÿ±ÿ¨ÿ©', average: 'ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑',
            pbScoresByWell: 'ÿØÿ±ÿ¨ÿßÿ™ PB ÿ≠ÿ≥ÿ® ÿßŸÑÿ®ÿ¶ÿ±', analyticsDashboard: 'üìä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
            scheduleTypesDistribution: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ¨ÿØŸàŸÑ', taskStatusOverview: 'ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸáÿßŸÖ',
            projectProgressOverview: 'ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', monthlyActivityTrend: 'ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ¥Ÿáÿ±Ÿä',
            monthlyChartsGallery: 'üìà ŸÖÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ© ÿßŸÑÿ¥Ÿáÿ±Ÿäÿ©', mwtPlanScheduleByMonth: 'üìÖ ÿ¨ÿØŸàŸÑ ÿÆÿ∑ÿ© MWT ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±',
            submitPbRecord: 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿ≥ÿ¨ŸÑ PB', recentRecords: 'ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©', csmsPbScreen: 'ÿ≠ÿßŸÑÿ© CSMS PB',
            // Settings
            language: 'ÿßŸÑŸÑÿ∫ÿ©', theme: 'ÿßŸÑÿ≥ŸÖÿ©', darkMode: 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ', lightMode: 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠',
            oceanBlue: 'ÿ£ÿ≤ÿ±ŸÇ ÿßŸÑŸÖÿ≠Ÿäÿ∑', forestGreen: 'ÿ£ÿÆÿ∂ÿ± ÿßŸÑÿ∫ÿßÿ®ÿ©', sunsetOrange: 'ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä ÿßŸÑÿ∫ÿ±Ÿàÿ®',
            // Time
            justNow: 'ÿßŸÑÿ¢ŸÜ', minutesAgo: 'ÿØ ŸÖÿ∂ÿ™', hoursAgo: 'ÿ≥ ŸÖÿ∂ÿ™', daysAgo: 'Ÿä ŸÖÿ∂ÿ™',
            // Quick Actions
            quickActions: 'ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ©', newProject: 'ŸÖÿ¥ÿ±Ÿàÿπ ÿ¨ÿØŸäÿØ', viewTasks: 'ÿπÿ±ÿ∂ ÿßŸÑŸÖŸáÿßŸÖ', download: 'ÿ™ÿ≠ŸÖŸäŸÑ', recentActivity: 'ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿÆŸäÿ±',
            // Additional Drawer
            relatedDocs: 'ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ ÿ∞ÿßÿ™ ÿµŸÑÿ©', adminModeActive: 'Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ŸÜÿ¥ÿ∑', previewMode: 'Ÿàÿ∂ÿπ ÿßŸÑŸÖÿπÿßŸäŸÜÿ©',
            // Calendar
            calendarTitle: 'ÿßŸÑÿ™ŸÇŸàŸäŸÖ', meetingProjectCalendars: 'ÿ™ŸÇÿßŸàŸäŸÖ ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπÿßÿ™ ŸàÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ', meetingCalendar: 'ÿ™ŸÇŸàŸäŸÖ ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπÿßÿ™', projectCalendar: 'ÿ™ŸÇŸàŸäŸÖ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ',
            // Bottom Nav
            statistics: 'ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™', docs: 'ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™',
            // Related Documents
            uploadDocument: 'ÿ±ŸÅÿπ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ', documentName: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØ', attachment: 'ÿßŸÑŸÖÿ±ŸÅŸÇ', selectFile: 'ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ',
            noFileSelected: 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ', uploadedDocuments: 'ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ ÿßŸÑŸÖÿ±ŸÅŸàÿπÿ©', noDocumentsYet: 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπ ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ ÿ®ÿπÿØ',
            noStatusUpdatesYet: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™ ÿ≠ÿßŸÑÿ© ÿ®ÿπÿØ. ŸÉŸÜ ÿ£ŸàŸÑ ŸÖŸÜ ŸäŸÜÿ¥ÿ±!',
            checkReminders: 'ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™', refreshStats: 'ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™',
            upcoming: 'ŸÇÿßÿØŸÖ', inprogress: 'ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞', completed: 'ŸÖŸÉÿ™ŸÖŸÑ', onhold: 'ŸÖÿπŸÑŸÇ', canceled: 'ŸÖŸÑÿ∫Ÿä',
            allProjects: 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ', allTasks: 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸáÿßŸÖ', noProjectsIn: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ¥ÿßÿ±Ÿäÿπ ŸÅŸä', noTasksIn: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸáÿßŸÖ ŸÅŸä',
            enterProjectName: 'ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ', enterTitle: 'ÿ£ÿØÿÆŸÑ ÿßŸÑÿπŸÜŸàÿßŸÜ', enterWell: 'ÿ£ÿØÿÆŸÑ ÿßŸÑÿ®ÿ¶ÿ±', enterKontrakNumber: 'ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ÿßŸÑÿπŸÇÿØ', enterWellName: 'ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ®ÿ¶ÿ±',
            ongoing: 'ÿ¨ÿßÿ±Ÿä', assignedToPlaceholder: 'ŸÖÿπŸäŸÜ ÿ•ŸÑŸâ', picEmailPlaceholder: 'ÿ®ÿ±ŸäÿØ PIC ŸÑŸÑÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™', managerEmailPlaceholder: 'ÿ®ÿ±ŸäÿØ ÿßŸÑŸÖÿØŸäÿ± ŸÑŸÑŸÜÿ≥ÿÆÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)',
            taskCodePlaceholder: 'ŸÖÿ´ÿßŸÑ T-001', describeTask: 'ŸàÿµŸÅ ÿßŸÑŸÖŸáŸÖÿ©...',
            weekly: 'ÿ£ÿ≥ÿ®ŸàÿπŸä', monthly: 'ÿ¥Ÿáÿ±Ÿä',
            sun: 'ÿ£ÿ≠ÿØ', mon: 'ÿ•ÿ´ŸÜ', tue: 'ÿ´ŸÑÿß', wed: 'ÿ£ÿ±ÿ®ÿπ', thu: 'ÿÆŸÖŸäÿ≥', fri: 'ÿ¨ŸÖÿπÿ©', sat: 'ÿ≥ÿ®ÿ™',
            jan: 'ŸäŸÜÿßŸäÿ±', feb: 'ŸÅÿ®ÿ±ÿßŸäÿ±', mar: 'ŸÖÿßÿ±ÿ≥', apr: 'ÿ£ÿ®ÿ±ŸäŸÑ', may: 'ŸÖÿßŸäŸà', jun: 'ŸäŸàŸÜŸäŸà', jul: 'ŸäŸàŸÑŸäŸà', aug: 'ÿ£ÿ∫ÿ≥ÿ∑ÿ≥', sep: 'ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±', oct: 'ÿ£ŸÉÿ™Ÿàÿ®ÿ±', nov: 'ŸÜŸàŸÅŸÖÿ®ÿ±', dec: 'ÿØŸäÿ≥ŸÖÿ®ÿ±',
            // Schedule
            scheduleTitle: 'ÿßŸÑÿ¨ÿØŸàŸÑ', createSchedule: 'ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿØŸàŸÑ', allUpcomingSchedules: 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÇÿßÿØŸÖÿ©', scheduledFor: 'ŸÖÿ¨ÿØŸàŸÑ ŸÑŸÄ',
            mwtPlanSchedule: 'ÿ¨ÿØŸàŸÑ ÿÆÿ∑ÿ© MWT', hseCommitteeMeeting: 'ÿßÿ¨ÿ™ŸÖÿßÿπ ŸÑÿ¨ŸÜÿ© HSE', showingUpcoming3Months: 'ÿπÿ±ÿ∂ 3 ÿ£ÿ¥Ÿáÿ± ÿßŸÑŸÇÿßÿØŸÖÿ©',
            scheduleType: 'ŸÜŸàÿπ ÿßŸÑÿ¨ÿØŸàŸÑ', selectScheduleType: 'ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ¨ÿØŸàŸÑ', selectProject: 'ÿßÿÆÿ™ÿ± ŸÖÿ¥ÿ±Ÿàÿπ', assignedTo: 'ŸÖÿπŸäŸÜ ÿ•ŸÑŸâ',
            // Statistics
            statisticsTitle: 'ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™', projectOverview: 'ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ', taskOverview: 'ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑŸÖŸáÿßŸÖ', monthlyCharts: 'ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ¥Ÿáÿ±Ÿäÿ©',
            tasksPerProject: 'ÿßŸÑŸÖŸáÿßŸÖ ŸÑŸÉŸÑ ŸÖÿ¥ÿ±Ÿàÿπ', projectsCreatedByMonth: 'ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ ÿßŸÑŸÖŸÜÿ¥ÿ£ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±', taskCompletionRate: 'ŸÖÿπÿØŸÑ ÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑŸÖŸáÿßŸÖ',
            // Monthly Charts Gallery
            janDecTrends: 'ÿßÿ™ÿ¨ÿßŸáÿßÿ™ ŸäŸÜÿßŸäÿ± - ÿØŸäÿ≥ŸÖÿ®ÿ± ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', hseCommitteeMeetingByMonth: 'üè¢ ÿßÿ¨ÿ™ŸÖÿßÿπ ŸÑÿ¨ŸÜÿ© HSE ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±',
            hsePlanMeetingByMonth: 'üìã ÿßÿ¨ÿ™ŸÖÿßÿπ ÿÆÿ∑ÿ© HSE ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±', sprMeetingByMonth: 'üìä ÿßÿ¨ÿ™ŸÖÿßÿπ SPR ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±',
            hazidHazopMeetingByMonth: '‚ö†Ô∏è ÿßÿ¨ÿ™ŸÖÿßÿπ HAZID/HAZOP ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±', csmsPbAuditByMonth: '‚úÖ ÿ™ÿØŸÇŸäŸÇ CSMS PB ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±',
            taskCompletionRateByMonth: '‚úì ŸÖÿπÿØŸÑ ÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑŸÖŸáÿßŸÖ ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±', pbScoresByMonth: 'üìã ÿØÿ±ÿ¨ÿßÿ™ PB ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥Ÿáÿ±',
            yAxisScoreLabel: 'ÿßŸÑŸÖÿ≠Ÿàÿ± Y: ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© (0-100) | ÿßŸÑŸÜŸÇÿßÿ∑ ŸÖŸÑŸàŸÜÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿ¥ÿ±Ÿàÿπ',
            // Schedule Type Labels
            mwtShort: 'MWT', hseShort: 'HSE', csmsShort: 'CSMS', hsePlanShort: 'ÿÆÿ∑ÿ© HSE', sprShort: 'SPR', hazidShort: 'HAZID',
            // Project Chart Gallery
            projectChartGallery: 'üìÅ ŸÖÿπÿ±ÿ∂ ÿ±ÿ≥ŸàŸÖ ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ', xAxisProjectsYAxisValues: 'ÿßŸÑŸÖÿ≠Ÿàÿ± X: ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπ | ÿßŸÑŸÖÿ≠Ÿàÿ± Y: ÿßŸÑŸÇŸäŸÖ',
            schedulesPerProject: 'üìÖ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ŸÑŸÉŸÑ ŸÖÿ¥ÿ±Ÿàÿπ', pbRecordsPerProject: 'üìã ÿ≥ÿ¨ŸÑÿßÿ™ PB ŸÑŸÉŸÑ ŸÖÿ¥ÿ±Ÿàÿπ',
            taskCompletionRatePerProject: '‚úì ŸÖÿπÿØŸÑ ÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑŸÖŸáÿßŸÖ ŸÑŸÉŸÑ ŸÖÿ¥ÿ±Ÿàÿπ (%)', averagePbScorePerProject: 'üìä ŸÖÿ™Ÿàÿ≥ÿ∑ ÿØÿ±ÿ¨ÿ© PB ŸÑŸÉŸÑ ŸÖÿ¥ÿ±Ÿàÿπ',
            pbScoreColorLegend: 'ÿßŸÑŸÑŸàŸÜ: üü¢ ‚â•80 | üü° ‚â•60 | üî¥ <60', noData: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™',
            // Forms
            emailNotification: 'ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ÿ®ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ•ŸÑŸâ Ÿáÿ∞ÿß ÿßŸÑÿπŸÜŸàÿßŸÜ', allCreatedSchedulesByType: 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ¨ÿØÿßŸàŸÑ ÿßŸÑŸÖŸÜÿ¥ÿ£ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸàÿπ',
            // PB Screen
            csmsPbScreen: 'CSMS PB', addNewRecord: 'ÿ•ÿ∂ÿßŸÅÿ© ÿ≥ÿ¨ŸÑ ÿ¨ÿØŸäÿØ', pbRecords: 'ÿ≥ÿ¨ŸÑÿßÿ™ PB', score: 'ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©', date: 'ÿßŸÑÿ™ÿßÿ±ŸäÿÆ', notes: 'ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™'
        },
        hi: {
            // Navigation
            home: '‡§π‡•ã‡§Æ', projects: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü', tasks: '‡§ï‡§æ‡§∞‡•ç‡§Ø', statistics: '‡§Ü‡§Ç‡§ï‡§°‡§º‡•á',
            schedule: '‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä', csmsPb: 'CSMS-PB', calendar: '‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞', settings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
            adminLogin: '‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ï ‡§≤‡•â‡§ó‡§ø‡§®', logout: '‡§≤‡•â‡§ó ‡§Ü‡§â‡§ü',
            // Home
            welcome: '‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!', projectManagement: 'CSMS ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä',
            inProgress: '‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç', upcoming: '‡§Ü‡§ó‡§æ‡§Æ‡•Ä', completed: '‡§™‡•Ç‡§∞‡•ç‡§£', onhold: '‡§∞‡•ã‡§ï‡§æ ‡§ó‡§Ø‡§æ', canceled: '‡§∞‡§¶‡•ç‡§¶', ongoing: '‡§ú‡§æ‡§∞‡•Ä',
            progress: '‡§™‡•ç‡§∞‡§ó‡§§‡§ø',
            // Home Screen Posts
            csmsAdmin: 'CSMS ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ï', systemAnnouncement: '‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ò‡•ã‡§∑‡§£‡§æ', welcomeNewDashboard: '‡§®‡§à CSMS ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!',
            projectUpdate: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§Ö‡§™‡§°‡•á‡§ü', autoGenerated: '‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§', today: '‡§Ü‡§ú', greatProgress: '‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§™‡•ç‡§∞‡§ó‡§§‡§ø!',
            projectTasksMoving: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∏‡•Å‡§ö‡§æ‡§∞‡•Ç ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º ‡§∞‡§π‡•á ‡§π‡•à‡§Ç.', overallCompletion: '‡§ï‡•Å‡§≤ ‡§™‡•Ç‡§∞‡•ç‡§£‡§§‡§æ', comment: '‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä',
            projectsLoadedSuccess: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§≤‡•ã‡§° ‡§π‡•Å‡§è', checkingScheduleReminders: '‡§∂‡•á‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...', dashboardReady: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à',
            // Actions
            createProject: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç', createTask: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¨‡§®‡§æ‡§è‡§Ç', post: '‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
            reply: '‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§Ç', like: '‡§™‡§∏‡§Ç‡§¶', likes: '‡§™‡§∏‡§Ç‡§¶', save: '‡§∏‡§π‡•á‡§ú‡•á‡§Ç', cancel: '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
            delete: '‡§π‡§ü‡§æ‡§è‡§Ç', edit: '‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç', search: '‡§ñ‡•ã‡§ú‡•á‡§Ç', filter: '‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞',
            // Comments
            shareComment: '‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç', yourName: '‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ', productLine: '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§≤‡§æ‡§á‡§®',
            writeComment: '‡§Ö‡§™‡§®‡•Ä ‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä ‡§≤‡§ø‡§ñ‡•á‡§Ç...', statusUpdates: '‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Ö‡§™‡§°‡•á‡§ü',
            photo: '‡§´‡•ã‡§ü‡•ã', file: '‡§´‡§æ‡§á‡§≤', writeReply: '‡§ú‡§µ‡§æ‡§¨ ‡§≤‡§ø‡§ñ‡•á‡§Ç...',
            // Project Form
            projectName: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§®‡§æ‡§Æ', title: '‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï', well: '‡§ï‡•Å‡§Ü‡§Ç', status: '‡§∏‡•ç‡§•‡§ø‡§§‡§ø', kontrakNo: '‡§Ö‡§®‡•Å‡§¨‡§Ç‡§ß ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ',
            startDate: '‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§§‡§ø‡§•‡§ø', endDate: '‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡§ø ‡§§‡§ø‡§•‡§ø', client: '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï', deleteProject: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§π‡§ü‡§æ‡§è‡§Ç', deleteTask: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§π‡§ü‡§æ‡§è‡§Ç',
            // Create Forms
            createNewProject: '‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç', createNewTask: '‡§®‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¨‡§®‡§æ‡§è‡§Ç', projectStatus: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
            rigDownEstimate: '‡§∞‡§ø‡§ó ‡§°‡§æ‡§â‡§® ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®', assignedTo: '‡§ï‡•ã ‡§∏‡•å‡§Ç‡§™‡§æ ‡§ó‡§Ø‡§æ', picEmail: 'PIC ‡§à‡§Æ‡•á‡§≤', picManagerEmail: 'PIC ‡§Æ‡•à‡§®‡•á‡§ú‡§∞ ‡§à‡§Æ‡•á‡§≤ (CC)',
            emailReminderHint: '‡§∞‡§ø‡§ó ‡§°‡§æ‡§â‡§® ‡§∏‡•á 2 ‡§¶‡§ø‡§® ‡§™‡§π‡§≤‡•á ‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§ó‡§æ ‡§Ø‡§¶‡§ø ‡§ï‡§æ‡§∞‡•ç‡§Ø < 80% ‡§™‡•Ç‡§∞‡•ç‡§£',
            managerCcHint: '‡§∏‡§≠‡•Ä ‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§à‡§Æ‡•á‡§≤ ‡§Æ‡•á‡§Ç CC ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ', selectProject: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç', wellName: '‡§ï‡•Å‡§Ü‡§Ç ‡§®‡§æ‡§Æ',
            taskIdCode: '‡§ï‡§æ‡§∞‡•ç‡§Ø ID/‡§ï‡•ã‡§°', taskDescription: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£', taskDetail: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£',
            // Task
            taskCode: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡•ã‡§°', taskName: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§®‡§æ‡§Æ', description: '‡§µ‡§ø‡§µ‡§∞‡§£',
            dueDate: '‡§®‡§ø‡§Ø‡§§ ‡§§‡§ø‡§•‡§ø', priority: '‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ', assignee: '‡§Ö‡§∏‡§æ‡§á‡§®‡•Ä',
            // Task Detail
            project: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü', unknownProject: '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü', uploadAttachment: '‡§Ö‡§ü‡•à‡§ö‡§Æ‡•á‡§Ç‡§ü ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (‡§Ö‡§∏‡•Ä‡§Æ‡§ø‡§§)',
            clickToUpload: 'Google Drive ‡§Æ‡•á‡§Ç ‡§´‡§º‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç', filesStoredInDrive: '‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç ‡§ï‡•á‡§µ‡§≤ Drive ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§π‡•à‡§Ç',
            uploadedFiles: '‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡•Ä ‡§ó‡§à ‡§´‡§º‡§æ‡§á‡§≤‡•á‡§Ç', close: '‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
            // Status
            all: '‡§∏‡§≠‡•Ä', onHold: '‡§π‡•ã‡§≤‡•ç‡§° ‡§™‡§∞', canceled: '‡§∞‡§¶‡•ç‡§¶',
            // Statistics Dashboard
            dashboard: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°', totalProjects: '‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü', totalTasks: '‡§ï‡•Å‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø',
            completionRate: '‡§™‡•Ç‡§∞‡•ç‡§£‡§§‡§æ ‡§¶‡§∞', upcomingMWT: '‡§Ü‡§ó‡§æ‡§Æ‡•Ä MWT', tapToView: '‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç ‚Üí',
            tapForTasks: '‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç ‚Üí', tapForSchedule: '‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç ‚Üí',
            projectStatusDistribution: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§µ‡§ø‡§§‡§∞‡§£', taskStatusDistribution: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§µ‡§ø‡§§‡§∞‡§£',
            projectTaskCompletion: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§£‡§§‡§æ', scheduleOverview: 'üìÖ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§® - ‡§∏‡§≠‡•Ä ‡§¨‡•à‡§†‡§ï ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
            mwtPlan: 'üìÖ MWT ‡§Ø‡•ã‡§ú‡§®‡§æ', hseCommittee: 'üè¢ HSE ‡§∏‡§Æ‡§ø‡§§‡§ø', csmsPb: '‚úÖ CSMS PB',
            hsePlan: 'üìã HSE ‡§Ø‡•ã‡§ú‡§®‡§æ', sprMeeting: 'üìä SPR ‡§¨‡•à‡§†‡§ï', hazidHazop: '‚ö†Ô∏è HAZID/HAZOP',
            csmsPbAudit: '‚úÖ CSMS PB ‡§ë‡§°‡§ø‡§ü', hsePlanMeeting: 'üìã HSE ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡•à‡§†‡§ï',
            totalSchedules: '‡§ï‡•Å‡§≤ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡§ø‡§Ø‡§æ‡§Ç', thisMonth: '‡§á‡§∏ ‡§Æ‡§π‡•Ä‡§®‡•á',
            csmsPbAuditScores: 'üìã CSMS PB ‡§ë‡§°‡§ø‡§ü ‡§∏‡•ç‡§ï‡•ã‡§∞', totalRecords: '‡§ï‡•Å‡§≤ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°',
            lowestScore: '‡§∏‡§¨‡§∏‡•á ‡§ï‡§Æ ‡§∏‡•ç‡§ï‡•ã‡§∞', highestScore: '‡§∏‡§¨‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï ‡§∏‡•ç‡§ï‡•ã‡§∞', average: '‡§î‡§∏‡§§',
            pbScoresByWell: '‡§ï‡•Å‡§è‡§Ç ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ PB ‡§∏‡•ç‡§ï‡•ã‡§∞', analyticsDashboard: 'üìä ‡§è‡§®‡§æ‡§≤‡§ø‡§ü‡§ø‡§ï‡•ç‡§∏ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
            scheduleTypesDistribution: '‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§µ‡§ø‡§§‡§∞‡§£', taskStatusOverview: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®',
            projectProgressOverview: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®', monthlyActivityTrend: '‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø ‡§™‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø',
            monthlyChartsGallery: 'üìà ‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ö‡§æ‡§∞‡•ç‡§ü ‡§ó‡•à‡§≤‡§∞‡•Ä', mwtPlanScheduleByMonth: 'üìÖ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ MWT ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä',
            submitPbRecord: 'PB ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç', recentRecords: '‡§π‡§æ‡§≤ ‡§ï‡•á ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°', csmsPbScreen: 'CSMS PB ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
            // Settings
            language: '‡§≠‡§æ‡§∑‡§æ', theme: '‡§•‡•Ä‡§Æ', darkMode: '‡§°‡§æ‡§∞‡•ç‡§ï ‡§Æ‡•ã‡§°', lightMode: '‡§≤‡§æ‡§á‡§ü ‡§Æ‡•ã‡§°',
            oceanBlue: '‡§∏‡§Æ‡•Å‡§¶‡•ç‡§∞ ‡§®‡•Ä‡§≤‡§æ', forestGreen: '‡§µ‡§® ‡§π‡§∞‡§æ', sunsetOrange: '‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§∏‡•ç‡§§ ‡§®‡§æ‡§∞‡§Ç‡§ó‡•Ä',
            // Time
            justNow: '‡§Ö‡§≠‡•Ä', minutesAgo: '‡§Æ‡§ø ‡§™‡§π‡§≤‡•á', hoursAgo: '‡§ò‡§Ç ‡§™‡§π‡§≤‡•á', daysAgo: '‡§¶‡§ø ‡§™‡§π‡§≤‡•á',
            // Quick Actions
            quickActions: '‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Ç', newProject: '‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü', viewTasks: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¶‡•á‡§ñ‡•á‡§Ç', download: '‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°', recentActivity: '‡§π‡§æ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø',
            // Additional Drawer
            relatedDocs: '‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º', adminModeActive: '‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ï ‡§Æ‡•ã‡§° ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø', previewMode: '‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§µ‡§≤‡•ã‡§ï‡§® ‡§Æ‡•ã‡§°',
            // Calendar
            calendarTitle: '‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞', meetingProjectCalendars: '‡§¨‡•à‡§†‡§ï ‡§î‡§∞ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞', meetingCalendar: '‡§¨‡•à‡§†‡§ï ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞', projectCalendar: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞',
            // Bottom Nav
            statistics: '‡§∏‡§æ‡§Ç‡§ñ‡•ç‡§Ø‡§ø‡§ï‡•Ä', docs: '‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º',
            // Related Documents
            uploadDocument: '‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç', documentName: '‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§ï‡§æ ‡§®‡§æ‡§Æ', attachment: '‡§∏‡§Ç‡§≤‡§ó‡•ç‡§®‡§ï', selectFile: '‡§´‡§º‡§æ‡§á‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç',
            noFileSelected: '‡§ï‡•ã‡§à ‡§´‡§º‡§æ‡§á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ö‡•Å‡§®‡•Ä ‡§ó‡§à', uploadedDocuments: '‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§ø‡§è ‡§ó‡§è ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º', noDocumentsYet: '‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§Ö‡§™‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
            noStatusUpdatesYet: '‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§™‡§π‡§≤‡•á ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§¨‡§®‡•á‡§Ç!',
            checkReminders: '‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç', refreshStats: '‡§Ü‡§Ç‡§ï‡§°‡§º‡•á ‡§∞‡•Ä‡§´‡•ç‡§∞‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç',
            upcoming: '‡§Ü‡§ó‡§æ‡§Æ‡•Ä', inprogress: '‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç', completed: '‡§™‡•Ç‡§∞‡•ç‡§£', onhold: '‡§∞‡•Å‡§ï‡§æ ‡§π‡•Å‡§Ü', canceled: '‡§∞‡§¶‡•ç‡§¶',
            allProjects: '‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü', allTasks: '‡§∏‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø', noProjectsIn: '‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç', noTasksIn: '‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç',
            enterProjectName: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', enterTitle: '‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', enterWell: '‡§ï‡•Å‡§Ü‡§Ç ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', enterKontrakNumber: '‡§Ö‡§®‡•Å‡§¨‡§Ç‡§ß ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', enterWellName: '‡§ï‡•Å‡§è‡§Ç ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
            ongoing: '‡§ú‡§æ‡§∞‡•Ä', assignedToPlaceholder: '‡§ï‡•ã ‡§∏‡•å‡§Ç‡§™‡§æ ‡§ó‡§Ø‡§æ', picEmailPlaceholder: '‡§∞‡§ø‡§Æ‡§æ‡§á‡§Ç‡§°‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è PIC ‡§à‡§Æ‡•á‡§≤', managerEmailPlaceholder: 'CC ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•à‡§®‡•á‡§ú‡§∞ ‡§à‡§Æ‡•á‡§≤ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)',
            taskCodePlaceholder: '‡§ú‡•à‡§∏‡•á T-001', describeTask: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç...',
            weekly: '‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï', monthly: '‡§Æ‡§æ‡§∏‡§ø‡§ï',
            sun: '‡§∞‡§µ‡§ø', mon: '‡§∏‡•ã‡§Æ', tue: '‡§Æ‡§Ç‡§ó‡§≤', wed: '‡§¨‡•Å‡§ß', thu: '‡§ó‡•Å‡§∞‡•Å', fri: '‡§∂‡•Å‡§ï‡•ç‡§∞', sat: '‡§∂‡§®‡§ø',
            jan: '‡§ú‡§®', feb: '‡§´‡§∞', mar: '‡§Æ‡§æ‡§∞‡•ç‡§ö', apr: '‡§Ö‡§™‡•ç‡§∞‡•à', may: '‡§Æ‡§à', jun: '‡§ú‡•Ç‡§®', jul: '‡§ú‡•Å‡§≤‡§æ', aug: '‡§Ö‡§ó', sep: '‡§∏‡§ø‡§§', oct: '‡§Ö‡§ï‡•ç‡§ü‡•Ç', nov: '‡§®‡§µ', dec: '‡§¶‡§ø‡§∏',
            // Schedule
            scheduleTitle: '‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä', createSchedule: '‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§¨‡§®‡§æ‡§è‡§Ç', allUpcomingSchedules: '‡§∏‡§≠‡•Ä ‡§Ü‡§ó‡§æ‡§Æ‡•Ä ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡§ø‡§Ø‡§æ‡§Ç', scheduledFor: '‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§',
            mwtPlanSchedule: 'MWT ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä', hseCommitteeMeeting: 'HSE ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§¨‡•à‡§†‡§ï', showingUpcoming3Months: '‡§Ü‡§ó‡§æ‡§Æ‡•Ä 3 ‡§Æ‡§π‡•Ä‡§®‡•á ‡§¶‡§ø‡§ñ‡§æ ‡§∞‡§π‡§æ ‡§π‡•à',
            scheduleType: '‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞', selectScheduleType: '‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç', selectProject: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç', assignedTo: '‡§ï‡•ã ‡§∏‡•å‡§Ç‡§™‡§æ ‡§ó‡§Ø‡§æ',
            // Statistics
            statisticsTitle: '‡§Ü‡§Ç‡§ï‡§°‡§º‡•á', projectOverview: '‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®', taskOverview: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ö‡§µ‡§≤‡•ã‡§ï‡§®', monthlyCharts: '‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§ö‡§æ‡§∞‡•ç‡§ü',
            tasksPerProject: '‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§Ø', projectsCreatedByMonth: '‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü', taskCompletionRate: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§£‡§§‡§æ ‡§¶‡§∞',
            // Monthly Charts Gallery
            janDecTrends: '‡§ú‡§®‡§µ‡§∞‡•Ä - ‡§¶‡§ø‡§∏‡§Ç‡§¨‡§∞ ‡§∞‡•Å‡§ù‡§æ‡§® ‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è', hseCommitteeMeetingByMonth: 'üè¢ HSE ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§¨‡•à‡§†‡§ï ‡§Æ‡§æ‡§∏‡§ø‡§ï',
            hsePlanMeetingByMonth: 'üìã HSE ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡•à‡§†‡§ï ‡§Æ‡§æ‡§∏‡§ø‡§ï', sprMeetingByMonth: 'üìä SPR ‡§¨‡•à‡§†‡§ï ‡§Æ‡§æ‡§∏‡§ø‡§ï',
            hazidHazopMeetingByMonth: '‚ö†Ô∏è HAZID/HAZOP ‡§¨‡•à‡§†‡§ï ‡§Æ‡§æ‡§∏‡§ø‡§ï', csmsPbAuditByMonth: '‚úÖ CSMS PB ‡§ë‡§°‡§ø‡§ü ‡§Æ‡§æ‡§∏‡§ø‡§ï',
            taskCompletionRateByMonth: '‚úì ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§£‡§§‡§æ ‡§¶‡§∞ ‡§Æ‡§æ‡§∏‡§ø‡§ï', pbScoresByMonth: 'üìã PB ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§Æ‡§æ‡§∏‡§ø‡§ï',
            yAxisScoreLabel: 'Y-‡§Ö‡§ï‡•ç‡§∑: ‡§∏‡•ç‡§ï‡•ã‡§∞ (0-100) | ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§∞‡§Ç‡§ó‡•Ä‡§® ‡§¨‡§ø‡§Ç‡§¶‡•Å',
            // Schedule Type Labels
            mwtShort: 'MWT', hseShort: 'HSE', csmsShort: 'CSMS', hsePlanShort: 'HSE ‡§Ø‡•ã‡§ú‡§®‡§æ', sprShort: 'SPR', hazidShort: 'HAZID',
            // Project Chart Gallery
            projectChartGallery: 'üìÅ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ö‡§æ‡§∞‡•ç‡§ü ‡§ó‡•à‡§≤‡§∞‡•Ä', xAxisProjectsYAxisValues: 'X-‡§Ö‡§ï‡•ç‡§∑: ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü | Y-‡§Ö‡§ï‡•ç‡§∑: ‡§Æ‡§æ‡§®',
            schedulesPerProject: 'üìÖ ‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä', pbRecordsPerProject: 'üìã ‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü PB ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°',
            taskCompletionRatePerProject: '‚úì ‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§™‡•Ç‡§∞‡•ç‡§£‡§§‡§æ ‡§¶‡§∞ (%)', averagePbScorePerProject: 'üìä ‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü ‡§î‡§∏‡§§ PB ‡§∏‡•ç‡§ï‡•ã‡§∞',
            pbScoreColorLegend: '‡§∞‡§Ç‡§ó: üü¢ ‚â•80 | üü° ‚â•60 | üî¥ <60', noData: '‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç',
            // Forms
            emailNotification: '‡§á‡§∏ ‡§™‡§§‡•á ‡§™‡§∞ ‡§à‡§Æ‡•á‡§≤ ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§≠‡•á‡§ú‡•Ä ‡§ú‡§æ‡§è‡§ó‡•Ä', allCreatedSchedulesByType: '‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§∏‡§≠‡•Ä ‡§¨‡§®‡§æ‡§à ‡§ó‡§à ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡§ø‡§Ø‡§æ‡§Ç',
            // PB Screen
            csmsPbScreen: 'CSMS PB', addNewRecord: '‡§®‡§Ø‡§æ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', pbRecords: 'PB ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°', score: '‡§∏‡•ç‡§ï‡•ã‡§∞', date: '‡§§‡§æ‡§∞‡•Ä‡§ñ', notes: '‡§®‡•ã‡§ü‡•ç‡§∏'
        }
    };

    function t(key) {
        return translations[currentLanguage][key] || translations['en'][key] || key;
    }

    // Task name translations (33 default HSE tasks)
    const taskTrans = {
        'MWT Report': { en: 'MWT Report', ar: 'ÿ™ŸÇÿ±Ÿäÿ± MWT', hi: 'MWT ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü' },
        'HSE Committee Meeting': { en: 'HSE Committee Meeting', ar: 'ÿßÿ¨ÿ™ŸÖÿßÿπ ŸÑÿ¨ŸÜÿ© HSE', hi: 'HSE ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§¨‡•à‡§†‡§ï' },
        'Poster IOGP CLSR': { en: 'IOGP CLSR Poster', ar: 'ŸÖŸÑÿµŸÇ IOGP CLSR', hi: 'IOGP CLSR ‡§™‡•ã‡§∏‡•ç‡§ü‡§∞' },
        'Foto Rambu K3 (Rambu Titik Jepit, Chemical, No Smoking, Electricity)': { en: 'Safety Signs Photo', ar: 'ÿµŸàÿ± ŸÑÿßŸÅÿ™ÿßÿ™ ÿßŸÑÿ≥ŸÑÿßŸÖÿ©', hi: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§´‡•ã‡§ü‡•ã' },
        'Foto Pemasangan Poster Live Saving Rules': { en: 'Life Saving Rules Poster', ar: 'ŸÖŸÑÿµŸÇ ŸÇŸàÿßÿπÿØ ÿ•ŸÜŸÇÿßÿ∞ ÿßŸÑÿ≠Ÿäÿßÿ©', hi: '‡§ú‡•Ä‡§µ‡§® ‡§∞‡§ï‡•ç‡§∑‡§ï ‡§®‡§ø‡§Ø‡§Æ ‡§™‡•ã‡§∏‡•ç‡§ü‡§∞' },
        'Foto Meeting dilokasi (HSE Weekly, PJSM, Tailgate)': { en: 'Site Meeting Photo', ar: 'ÿµŸàÿ±ÿ© ÿßÿ¨ÿ™ŸÖÿßÿπ ÿßŸÑŸÖŸàŸÇÿπ', hi: '‡§∏‡§æ‡§á‡§ü ‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó ‡§´‡•ã‡§ü‡•ã' },
        'Foto saat menyampaikan safety moment dilokasi': { en: 'Safety Moment Photo', ar: 'ÿµŸàÿ±ÿ© ŸÑÿ≠ÿ∏ÿ© ÿßŸÑÿ≥ŸÑÿßŸÖÿ©', hi: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§Æ‡•ã‡§Æ‡•á‡§Ç‡§ü ‡§´‡•ã‡§ü‡•ã' },
        'Foto training dilokasi (H2S, SIKA, JSA, etc)': { en: 'Training Photo', ar: 'ÿµŸàÿ±ÿ© ÿßŸÑÿ™ÿØÿ±Ÿäÿ®', hi: '‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ ‡§´‡•ã‡§ü‡•ã' },
        'Foto HSE Campaign (Reward, Safety Moment, Marshal)': { en: 'HSE Campaign Photo', ar: 'ÿµŸàÿ±ÿ© ÿ≠ŸÖŸÑÿ© HSE', hi: 'HSE ‡§Ö‡§≠‡§ø‡§Ø‡§æ‡§® ‡§´‡•ã‡§ü‡•ã' },
        'Foto TRA Dilokasi': { en: 'Site TRA Photo', ar: 'ÿµŸàÿ±ÿ© TRA', hi: 'TRA ‡§´‡•ã‡§ü‡•ã' },
        'Foto saat Pemeriksaan Fit to task dilokasi': { en: 'Fit to Task Photo', ar: 'ÿµŸàÿ±ÿ© ÿßŸÑŸÑŸäÿßŸÇÿ© ŸÑŸÑŸÖŸáŸÖÿ©', hi: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ø‡•ã‡§ó‡•ç‡§Ø‡§§‡§æ ‡§´‡•ã‡§ü‡•ã' },
        'Foto Observation Card / PEKA': { en: 'Observation Card Photo', ar: 'ÿµŸàÿ±ÿ© ÿ®ÿ∑ÿßŸÇÿ© ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿ©', hi: '‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡§æ‡§∞‡•ç‡§° ‡§´‡•ã‡§ü‡•ã' },
        'Lakukan Hazard Hunt Dilokasi': { en: 'Conduct Hazard Hunt', ar: 'ÿµŸäÿØ ÿßŸÑŸÖÿÆÿßÿ∑ÿ±', hi: '‡§ñ‡§§‡§∞‡§æ ‡§∂‡§ø‡§ï‡§æ‡§∞' },
        'Pelaporan Near miss': { en: 'Near Miss Report', ar: 'ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ≠ŸàÿßÿØÿ´ ÿßŸÑŸàÿ¥ŸäŸÉÿ©', hi: '‡§®‡§ø‡§ï‡§ü ‡§ö‡•Ç‡§ï ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü' },
        'Foto Saat Housekeeping': { en: 'Housekeeping Photo', ar: 'ÿµŸàÿ±ÿ© ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ', hi: '‡§π‡§æ‡§â‡§∏‡§ï‡•Ä‡§™‡§ø‡§Ç‡§ó ‡§´‡•ã‡§ü‡•ã' },
        'Foto Manajemen Chemical': { en: 'Chemical Management Photo', ar: 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÉŸäŸÖÿßŸàŸäÿßÿ™', hi: '‡§∞‡§æ‡§∏‡§æ‡§Ø‡§®‡§ø‡§ï ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§´‡•ã‡§ü‡•ã' },
        'Foto PTW & JSA Dilokasi': { en: 'PTW & JSA Photo', ar: 'ÿµŸàÿ±ÿ© PTW Ÿà JSA', hi: 'PTW ‡§î‡§∞ JSA ‡§´‡•ã‡§ü‡•ã' },
        'Foto PJSM (Foto dan Absen)': { en: 'PJSM Photo & Attendance', ar: 'ÿµŸàÿ±ÿ© PJSM ŸàÿßŸÑÿ≠ÿ∂Ÿàÿ±', hi: 'PJSM ‡§´‡•ã‡§ü‡•ã' },
        'Inspeksi Lapangan HSE': { en: 'HSE Field Inspection', ar: 'ŸÅÿ≠ÿµ ŸÖŸäÿØÿßŸÜŸä HSE', hi: 'HSE ‡§´‡•Ä‡§≤‡•ç‡§° ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£' },
        'Foto Inspeksi P3K': { en: 'First Aid Inspection', ar: 'ŸÅÿ≠ÿµ ÿßŸÑÿ•ÿ≥ÿπÿßŸÅÿßÿ™', hi: '‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£' },
        'Foto Inspeksi APAR': { en: 'Fire Extinguisher Inspection', ar: 'ŸÅÿ≠ÿµ ÿ∑ŸÅÿßŸäÿ© ÿßŸÑÿ≠ÿ±ŸäŸÇ', hi: '‡§Ö‡§ó‡•ç‡§®‡§ø‡§∂‡§æ‡§Æ‡§ï ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£' },
        'Foto Inspeksi APD': { en: 'PPE Inspection Photo', ar: 'ŸÅÿ≠ÿµ PPE', hi: 'PPE ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§´‡•ã‡§ü‡•ã' },
        'Inspeksi Lingkungan kerja': { en: 'Work Environment Inspection', ar: 'ŸÅÿ≠ÿµ ÿ®Ÿäÿ¶ÿ© ÿßŸÑÿπŸÖŸÑ', hi: '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£' },
        'SIML Dan HSE Passport': { en: 'SIML and HSE Passport', ar: 'SIML Ÿàÿ¨Ÿàÿßÿ≤ HSE', hi: 'SIML ‡§î‡§∞ HSE ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü' },
        'Upload List Peralatan (COID)': { en: 'Upload Equipment List', ar: 'ÿ™ÿ≠ŸÖŸäŸÑ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿπÿØÿßÿ™', hi: '‡§â‡§™‡§ï‡§∞‡§£ ‡§∏‡•Ç‡§ö‡•Ä ‡§Ö‡§™‡§≤‡•ã‡§°' },
        'Upload Sertifikat Lifting gear': { en: 'Upload Lifting Gear Cert', ar: 'ÿ¥ŸáÿßÿØÿ© ÿßŸÑÿ±ŸÅÿπ', hi: '‡§≤‡§ø‡§´‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞' },
        'Upload Sertifikat Peralatan': { en: 'Upload Equipment Cert', ar: 'ÿ¥ŸáÿßÿØÿ© ÿßŸÑŸÖÿπÿØÿßÿ™', hi: '‡§â‡§™‡§ï‡§∞‡§£ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞' },
        'Foto Inspeksi Lifting Gear': { en: 'Lifting Gear Inspection', ar: 'ŸÅÿ≠ÿµ ŸÖÿπÿØÿßÿ™ ÿßŸÑÿ±ŸÅÿπ', hi: '‡§≤‡§ø‡§´‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§ó‡§ø‡§Ø‡§∞ ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£' },
        'Foto Checklist Inspeksi Peralatan Harian': { en: 'Daily Equipment Checklist', ar: 'ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿπÿØÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©', hi: '‡§¶‡•à‡§®‡§ø‡§ï ‡§â‡§™‡§ï‡§∞‡§£ ‡§ö‡•á‡§ï‡§≤‡§ø‡§∏‡•ç‡§ü' },
        'HSE Drill Dilokasi': { en: 'HSE Drill at Site', ar: 'ÿ™ÿØÿ±Ÿäÿ® HSE', hi: 'HSE ‡§°‡•ç‡§∞‡§ø‡§≤' },
        'MOC Report': { en: 'MOC Report', ar: 'ÿ™ŸÇÿ±Ÿäÿ± MOC', hi: 'MOC ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü' },
        'Pelaporan Incident': { en: 'Incident Report', ar: 'ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ≠ÿßÿØÿ´', hi: '‡§ò‡§ü‡§®‡§æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü' },
        'Safety Stand Down dilokasi': { en: 'Safety Stand Down', ar: 'ÿ™ŸàŸÇŸÅ ÿßŸÑÿ≥ŸÑÿßŸÖÿ©', hi: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡•ç‡§ü‡•à‡§Ç‡§° ‡§°‡§æ‡§â‡§®' }
    };
    function tTask(name) {
        if (currentLanguage === 'id') return name;
        return taskTrans[name] ? (taskTrans[name][currentLanguage] || taskTrans[name]['en'] || name) : name;
    }
    window.tTask = tTask;

    function applyTranslations() {
        // Update drawer navigation
        const navItems = document.querySelectorAll('.drawer-item');
        const navMap = ['home', 'projects', 'tasks', 'statistics', 'schedule', 'csmsPb', 'calendar'];
        navItems.forEach((item, i) => {
            if (navMap[i]) {
                const svg = item.querySelector('svg');
                if (svg) item.innerHTML = svg.outerHTML + ' ' + t(navMap[i]);
            }
        });

        // Update home welcome text
        const welcomeH1 = document.querySelector('#screen-home h1');
        if (welcomeH1) welcomeH1.textContent = t('welcome');
        const welcomeP = document.querySelector('#screen-home .main > section > div > p');
        if (welcomeP) welcomeP.textContent = t('projectManagement');

        // Update comment section
        const commentTitle = document.querySelector('#screen-home h4');
        if (commentTitle && commentTitle.textContent.includes('Share') || commentTitle && commentTitle.textContent.includes('Bagikan')) {
            commentTitle.textContent = 'üí¨ ' + t('shareComment');
        }

        const nameInput = document.getElementById('post-name');
        if (nameInput) nameInput.placeholder = t('yourName');
        const plInput = document.getElementById('post-pl');
        if (plInput) plInput.placeholder = t('productLine');
        const commentInput = document.getElementById('post-input');
        if (commentInput) commentInput.placeholder = t('writeComment');

        // Update status updates heading
        const statusH3 = document.querySelector('#screen-home h3');
        if (statusH3) statusH3.textContent = t('statusUpdates');

        // Update create buttons
        document.querySelectorAll('button').forEach(btn => {
            if (btn.textContent.trim() === 'Post' || btn.textContent.trim() === 'Kirim') btn.textContent = t('post');
            if (btn.textContent.includes('Create Project')) btn.textContent = '+ ' + t('createProject');
            if (btn.textContent.includes('Create Task')) btn.textContent = '+ ' + t('createTask');
        });

        // Re-render comments to apply translations
        if (typeof renderComments === 'function') renderComments();

        // Re-render tasks with translated names
        if (typeof renderAllTasks === 'function') renderAllTasks();
        if (typeof loadData === 'function') loadData();

        console.log('[i18n] Translations applied for: ' + currentLanguage);
        showToast('üåê ' + getLanguageName(currentLanguage), 'success');
    }

    // COMPLETE INSTANT LANGUAGE SWITCH - Updates ALL text at once
    function applyAllTranslations() {
        const L = translations[currentLanguage] || translations['id'];
        console.log('[LANG] Switching to:', currentLanguage);

        // USE DATA-I18N ATTRIBUTES - Instant update for all marked elements
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (L[key]) {
                if (key === 'photo') el.textContent = 'üì∑ ' + L[key];
                else if (key === 'file') el.textContent = 'üìé ' + L[key];
                else el.textContent = L[key];
            }
        });

        // ===== DRAWER NAVIGATION =====
        const drawerItems = document.querySelectorAll('.drawer-nav .drawer-item');
        const navTexts = [L.home, L.projects, L.tasks, L.statistics, L.schedule, L.csmsPb, L.calendar];
        drawerItems.forEach((item, i) => {
            if (navTexts[i]) {
                const svg = item.querySelector('svg');
                if (svg) item.innerHTML = svg.outerHTML + ' ' + navTexts[i];
            }
        });

        // ===== HOME SCREEN =====
        // Welcome text
        document.querySelectorAll('h1').forEach(h => {
            if (h.textContent.match(/Welcome|Selamat|ŸÖÿ±ÿ≠ÿ®ÿßŸã|‡§∏‡•ç‡§µ‡§æ‡§ó‡§§/)) h.textContent = L.welcome;
        });
        // Subtitle
        document.querySelectorAll('p').forEach(p => {
            if (p.textContent.match(/Project Management|Manajemen Proyek|ÿ•ÿØÿßÿ±ÿ©|‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®/)) p.textContent = L.projectManagement;
        });

        // ===== STATS LABELS =====
        document.querySelectorAll('#screen-home div').forEach(div => {
            const txt = div.textContent.trim();
            if (txt === 'InProgress' || txt === 'Dalam Proses' || txt === 'ŸÇŸäÿØ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞' || txt === '‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç') div.textContent = L.inProgress;
            if (txt === 'Upcoming' || txt === 'Akan Datang' || txt === 'ŸÇÿßÿØŸÖ' || txt === '‡§Ü‡§ó‡§æ‡§Æ‡•Ä') div.textContent = L.upcoming;
            if (txt === 'Completed' || txt === 'Selesai' || txt === 'ŸÖŸÉÿ™ŸÖŸÑ' || txt === '‡§™‡•Ç‡§∞‡•ç‡§£') div.textContent = L.completed;
        });

        // ===== COMMENT SECTION =====
        document.querySelectorAll('h4').forEach(h => {
            if (h.textContent.match(/Share|Bagikan|ÿ¥ÿßÿ±ŸÉ|‡§∏‡§æ‡§ù‡§æ/)) h.textContent = 'üí¨ ' + L.shareComment;
        });
        document.querySelectorAll('h3').forEach(h => {
            if (h.textContent.match(/Status|Update|ÿ™ÿ≠ÿØŸäÿ´|‡§∏‡•ç‡§•‡§ø‡§§‡§ø/)) h.textContent = L.statusUpdates;
        });

        // Input placeholders
        const nameIn = document.getElementById('post-name');
        if (nameIn) nameIn.placeholder = L.yourName;
        const plIn = document.getElementById('post-pl');
        if (plIn) plIn.placeholder = L.productLine;
        const commentIn = document.getElementById('post-input');
        if (commentIn) commentIn.placeholder = L.writeComment;

        // Project Form Placeholders
        document.querySelectorAll('.form-input[name="name"]').forEach(el => el.placeholder = L.enterProjectName || 'Enter project name');
        document.querySelectorAll('.form-input[name="title"]').forEach(el => el.placeholder = L.enterTitle || 'Enter title');
        document.querySelectorAll('.form-input[name="well"]').forEach(el => el.placeholder = L.enterWell || 'Enter well');
        document.querySelectorAll('.form-input[name="kontrak_no"]').forEach(el => el.placeholder = L.enterKontrakNumber || 'Enter kontrak number');
        document.querySelectorAll('#doc-well-name').forEach(el => el.placeholder = L.enterWellName || 'Enter well name');
        // PIC and Task Form Placeholders
        document.querySelectorAll('.form-input[name="assigned_to"]').forEach(el => el.placeholder = L.assignedToPlaceholder || 'Assigned to');
        document.querySelectorAll('#project-pic-email').forEach(el => el.placeholder = L.picEmailPlaceholder || 'PIC email for reminders');
        document.querySelectorAll('#project-manager-email').forEach(el => el.placeholder = L.managerEmailPlaceholder || 'Manager email for CC (optional)');
        document.querySelectorAll('#task-well-name').forEach(el => el.placeholder = L.enterWellName || 'Enter well name');
        document.querySelectorAll('.form-input[name="code"]').forEach(el => el.placeholder = L.taskCodePlaceholder || 'e.g. T-001');
        document.querySelectorAll('.form-input[name="title"]').forEach(el => { if (el.tagName === 'TEXTAREA') el.placeholder = L.describeTask || 'Describe the task...'; });
        // Select Project option
        const selectProjectOption = document.querySelector('#task-project-select option[value=""]');
        if (selectProjectOption) selectProjectOption.textContent = L.selectProject || 'Select Project';

        document.querySelectorAll('button, .btn-primary, .btn-secondary').forEach(btn => {
            const txt = btn.textContent.trim();
            if (txt.match(/^Post$|^Kirim$|^‡§®ÿ¥ÿ±$|^‡§™‡•ã‡§∏‡•ç‡§ü/)) btn.textContent = L.post;
            if (txt.includes('Create Project') || txt.includes('Buat Proyek')) btn.innerHTML = '+ ' + L.createProject;
            if (txt.includes('Create Task') || txt.includes('Buat Tugas')) btn.innerHTML = '+ ' + L.createTask;
            if (txt === 'Save' || txt === 'Simpan' || txt === 'ÿ≠ŸÅÿ∏' || txt === '‡§∏‡§π‡•á‡§ú‡•á‡§Ç') btn.textContent = L.save;
            if (txt === 'Cancel' || txt === 'Batal' || txt === 'ÿ•ŸÑÿ∫ÿßÿ°' || txt === '‡§∞‡§¶‡•ç‡§¶') btn.textContent = L.cancel;
        });

        // ===== FORM LABELS =====
        document.querySelectorAll('.form-label').forEach(lbl => {
            const txt = lbl.textContent.replace(/\s*\*\s*/g, '').trim();
            const hasAsterisk = lbl.innerHTML.includes('*');
            const map = {
                'Project Name': L.projectName, 'Nama Proyek': L.projectName,
                'Title': L.title, 'Judul': L.title,
                'Well': L.well, 'Sumur': L.well,
                'Status': L.status,
                'Start Date': L.startDate, 'Tanggal Mulai': L.startDate,
                'End Date': L.endDate, 'Tanggal Selesai': L.endDate,
                'Client': L.client, 'Klien': L.client,
                'Description': L.description, 'Deskripsi': L.description
            };
            if (map[txt]) lbl.innerHTML = map[txt] + (hasAsterisk ? ' <span>*</span>' : '');
        });

        // ===== PHOTO/FILE SPANS =====
        document.querySelectorAll('span').forEach(sp => {
            if (sp.textContent.match(/üì∑\s*(Photo|Foto)/)) sp.textContent = 'üì∑ ' + L.photo;
            if (sp.textContent.match(/üìé\s*File/)) sp.textContent = 'üìé ' + L.file;
            if (sp.textContent.match(/üí¨\s*(Reply|Balas)/)) sp.textContent = 'üí¨ ' + L.reply;
        });

        // ===== SETTINGS MODAL =====
        document.querySelectorAll('#settings-modal h3').forEach(h => {
            if (h.textContent.match(/Language|Bahasa|ÿßŸÑŸÑÿ∫ÿ©|‡§≠‡§æ‡§∑‡§æ/)) h.textContent = 'üåê ' + L.language;
            if (h.textContent.match(/Theme|Tema|ÿßŸÑÿ≥ŸÖÿ©|‡§•‡•Ä‡§Æ/)) h.textContent = 'üé® ' + L.theme;
        });

        // ===== RELOAD DATA TO REFRESH TASK NAMES =====
        if (typeof loadData === 'function') {
            setTimeout(() => loadData(), 100);
        }

        console.log('[LANG] Complete! All text updated to:', getLanguageName(currentLanguage));
        showToast('üåê ' + getLanguageName(currentLanguage), 'success');
    }

    // Apply on page load
    setTimeout(() => applyAllTranslations(), 300);

    // Apply saved settings on load
    applyTheme(currentTheme);

    window.showSettingsModal = showSettingsModal;
    window.closeSettingsModal = closeSettingsModal;
    window.setLanguage = setLanguage;
    window.setTheme = setTheme;
    window.t = t;

    // ===== ADMIN DELETE FUNCTIONS =====

    // Delete Project
    async function deleteProject(projectId, projectName) {
        if (!confirm(`Are you sure you want to delete project "${projectName}"?\n\nThis will also delete all tasks in this project. This action cannot be undone.`)) {
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/projects/${projectId}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('Project deleted successfully', 'success');
                closeProjectDetailModal();
                loadData();
                updateStatistics();
            } else {
                showToast('Error deleting project', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }

    // Delete Task
    async function deleteTask(taskId, taskCode) {
        if (!confirm(`Are you sure you want to delete task "${taskCode}"?\n\nThis action cannot be undone.`)) {
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/tasks/${taskId}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('Task deleted successfully', 'success');
                closeTaskModal();
                loadData();
                updateStatistics();
            } else {
                showToast('Error deleting task', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }

    // Delete Schedule
    async function deleteSchedule(scheduleId) {
        if (!confirm('Are you sure you want to delete this schedule?\n\nThis action cannot be undone.')) {
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/schedules/${scheduleId}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('Schedule deleted successfully', 'success');
                renderSchedules();
            } else {
                showToast('Error deleting schedule', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }

    // Delete PB Record
    async function deletePBRecord(pbId) {
        if (!confirm('Are you sure you want to delete this PB record?\n\nThis action cannot be undone.')) {
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/csms-pb/${pbId}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('PB record deleted successfully', 'success');
                loadCSMSPB();
            } else {
                showToast('Error deleting PB record', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }

    // Make delete functions global
    window.deleteProject = deleteProject;
    window.deleteTask = deleteTask;
    window.deleteSchedule = deleteSchedule;
    window.deletePBRecord = deletePBRecord;

    // ===== COMMENTS SYSTEM =====
    let allComments = [];
    let commentAttachmentData = null;
    let commentAttachmentFilename = null;

    async function loadComments() {
        try {
            const res = await fetch(`${API_BASE}/comments`);
            if (res.ok) {
                allComments = await res.json();
                renderComments();
            }
        } catch (error) {
            console.error('Error loading comments:', error);
        }
    }

    function renderComments() {
        const container = document.getElementById('comments-container');
        if (!container) return;

        if (allComments.length === 0) {
            container.innerHTML = `<p style="color: var(--text-muted); text-align: center; padding: 20px;">${t('noStatusUpdatesYet')}</p>`;
            return;
        }

        container.innerHTML = allComments.map(comment => {
            const timeAgo = getTimeAgo(comment.created_at);
            const repliesHtml = (comment.replies || []).map(reply => {
                const replyTimeAgo = getTimeAgo(reply.created_at);
                return `
                    <div style="background: var(--bg-secondary); border-radius: 8px; padding: 12px; margin-top: 8px; margin-left: 20px; border-left: 2px solid var(--border);">
                        <div style="display: flex; gap: 10px; align-items: start;">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px;">
                                ${reply.author_name.charAt(0).toUpperCase()}
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: 600; font-size: 13px;">${reply.author_name}</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">${replyTimeAgo}</div>
                                </div>
                                <p style="font-size: 13px; margin-top: 4px;">${reply.content}</p>
                                ${reply.attachment_data ? `
                                    <div style="margin-top: 8px;">
                                        <img src="${reply.attachment_data}" alt="Reply photo" 
                                             style="max-width: 100%; border-radius: 6px; max-height: 200px; object-fit: contain;">
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="comment-card" style="background: var(--bg-tertiary); border-radius: 12px; padding: 16px; margin-bottom: 12px;">
                    <div style="display: flex; gap: 12px;">
                        <div style="width: 44px; height: 44px; border-radius: 50%; background: var(--netflix-red); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 18px;">
                            ${comment.author_name.charAt(0).toUpperCase()}
                        </div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <div style="font-weight: 600;">${comment.author_name}</div>
                                    <div style="font-size: 12px; color: var(--text-muted);">${timeAgo}</div>
                                </div>
                                <button class="delete-btn admin-only" onclick="deleteComment('${comment.id}')" style="padding: 4px 8px; font-size: 10px;">üóëÔ∏è</button>
                            </div>
                            <p style="font-size: 14px; line-height: 1.5; margin-top: 8px;">${comment.content}</p>
                            ${comment.attachment_data ? `
                                <div style="margin-top: 12px;">
                                    <img src="${comment.attachment_data}" alt="${comment.attachment_filename || 'Photo'}" 
                                         style="max-width: 100%; border-radius: 8px; max-height: 300px; object-fit: contain;">
                                </div>
                            ` : comment.attachment_filename ? `
                                <div style="margin-top: 8px; font-size: 12px; color: var(--success);">üìé ${comment.attachment_filename}</div>
                            ` : ''}
                            <div style="display: flex; gap: 20px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                                <span onclick="toggleCommentLike('${comment.id}')" style="color: var(--text-secondary); font-size: 13px; cursor: pointer;" id="like-btn-${comment.id}">üëç ${comment.likes || 0} Likes</span>
                                <span onclick="toggleReplyForm('${comment.id}')" style="color: var(--text-secondary); font-size: 13px; cursor: pointer;">üí¨ Reply</span>
                            </div>
                            
                            <!-- Reply Form -->
                            <div id="reply-form-${comment.id}" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                                    <input type="text" id="reply-name-${comment.id}" placeholder="Your Name" 
                                           style="flex: 1; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; padding: 8px; color: var(--text-primary); font-size: 12px;">
                                </div>
                                <div style="display: flex; gap: 8px; align-items: flex-start;">
                                    <textarea id="reply-input-${comment.id}" placeholder="Write a reply..." 
                                              style="flex: 1; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; padding: 8px; color: var(--text-primary); font-size: 12px; min-height: 40px; resize: none;"></textarea>
                                </div>
                                <div id="reply-preview-${comment.id}" style="display: none; margin-top: 8px; font-size: 11px; color: var(--success);"></div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                                    <div style="display: flex; gap: 10px;">
                                        <span onclick="pickReplyPhoto('${comment.id}')" style="cursor: pointer; font-size: 12px; color: var(--text-muted);">üì∑ Photo</span>
                                        <input type="file" id="reply-photo-${comment.id}" accept="image/*" onchange="handleReplyPhotoSelect(event, '${comment.id}')" style="display: none;">
                                    </div>
                                    <button onclick="submitReply('${comment.id}')" 
                                            style="background: var(--netflix-red); color: white; border: none; padding: 6px 16px; border-radius: 16px; font-size: 12px; font-weight: 600; cursor: pointer;">Reply</button>
                                </div>
                            </div>
                            
                            <!-- Replies -->
                            ${repliesHtml}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // Comment photo/file picker functions
    function pickCommentPhoto() {
        document.getElementById('comment-photo-input').click();
    }

    function pickCommentFile() {
        document.getElementById('comment-file-input').click();
    }

    function handleCommentPhotoSelect(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                commentAttachmentData = e.target.result; // Base64 data URL
                commentAttachmentFilename = file.name;
                showCommentAttachmentPreview(file.name);
            };
            reader.readAsDataURL(file);
        }
    }

    function handleCommentFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                commentAttachmentData = e.target.result;
                commentAttachmentFilename = file.name;
                showCommentAttachmentPreview(file.name);
            };
            reader.readAsDataURL(file);
        }
    }

    function showCommentAttachmentPreview(filename) {
        const preview = document.getElementById('post-attachment-preview');
        const nameSpan = document.getElementById('post-attachment-name');
        if (preview && nameSpan) {
            nameSpan.textContent = 'üìé ' + filename;
            preview.style.display = 'block';
        }
        showToast('üìé ' + filename + ' attached', 'success');
    }

    function removePostAttachment() {
        commentAttachmentData = null;
        commentAttachmentFilename = null;
        const preview = document.getElementById('post-attachment-preview');
        if (preview) preview.style.display = 'none';
        document.getElementById('comment-photo-input').value = '';
        document.getElementById('comment-file-input').value = '';
    }

    // Make picker functions global
    window.pickCommentPhoto = pickCommentPhoto;
    window.pickCommentFile = pickCommentFile;
    window.handleCommentPhotoSelect = handleCommentPhotoSelect;
    window.handleCommentFileSelect = handleCommentFileSelect;
    window.removePostAttachment = removePostAttachment;

    // Reply system
    let replyAttachments = {}; // Store reply attachments by comment ID

    function toggleReplyForm(commentId) {
        const form = document.getElementById('reply-form-' + commentId);
        if (form) {
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
    }

    function pickReplyPhoto(commentId) {
        document.getElementById('reply-photo-' + commentId).click();
    }

    function handleReplyPhotoSelect(event, commentId) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                replyAttachments[commentId] = {
                    data: e.target.result,
                    filename: file.name
                };
                const preview = document.getElementById('reply-preview-' + commentId);
                if (preview) {
                    preview.textContent = 'üìé ' + file.name;
                    preview.style.display = 'block';
                }
                showToast('üìé ' + file.name + ' attached', 'success');
            };
            reader.readAsDataURL(file);
        }
    }

    async function submitReply(commentId) {
        const nameInput = document.getElementById('reply-name-' + commentId);
        const textInput = document.getElementById('reply-input-' + commentId);
        const authorName = nameInput ? nameInput.value.trim() : 'User';
        const content = textInput ? textInput.value.trim() : '';
        const attachment = replyAttachments[commentId] || null;

        if (!content && !attachment) {
            showToast('Please enter a reply or add a photo', 'error');
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/comments/${commentId}/replies`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    author_name: authorName || 'User',
                    content: content || 'üì∑',
                    attachment_data: attachment ? attachment.data : null,
                    attachment_filename: attachment ? attachment.filename : null
                })
            });

            if (res.ok) {
                // Clear form
                if (nameInput) nameInput.value = '';
                if (textInput) textInput.value = '';
                delete replyAttachments[commentId];
                const preview = document.getElementById('reply-preview-' + commentId);
                if (preview) preview.style.display = 'none';

                showToast('Reply posted!', 'success');
                loadComments(); // Reload to show new reply
            } else {
                showToast('Error posting reply', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }

    // Make reply functions global
    window.toggleReplyForm = toggleReplyForm;
    window.pickReplyPhoto = pickReplyPhoto;
    window.handleReplyPhotoSelect = handleReplyPhotoSelect;
    window.submitReply = submitReply;

    // Like comment function
    async function toggleCommentLike(commentId) {
        try {
            const res = await fetch(`${API_BASE}/comments/${commentId}/like`, {
                method: 'POST'
            });
            if (res.ok) {
                const data = await res.json();
                // Update the like button text
                const btn = document.getElementById('like-btn-' + commentId);
                if (btn) {
                    btn.textContent = 'üëç ' + data.likes + ' Likes';
                    btn.style.color = 'var(--netflix-red)';
                }
                showToast('Liked!', 'success');
            }
        } catch (error) {
            showToast('Error liking comment', 'error');
        }
    }
    window.toggleCommentLike = toggleCommentLike;

    async function postComment() {
        const input = document.getElementById('post-input');
        const nameInput = document.getElementById('post-name');
        const content = input ? input.value.trim() : '';
        const authorName = nameInput ? nameInput.value.trim() : 'User';

        if (!content && !commentAttachmentData) {
            showToast('Please enter a message or add an attachment', 'error');
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/comments`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    author_name: authorName || 'User',
                    content: content || 'üì∑',
                    attachment_filename: commentAttachmentFilename,
                    attachment_data: commentAttachmentData
                })
            });

            if (res.ok) {
                input.value = '';
                // Clear attachment
                commentAttachmentData = null;
                commentAttachmentFilename = null;
                const preview = document.getElementById('post-attachment-preview');
                if (preview) preview.style.display = 'none';

                showToast('Posted successfully!', 'success');
                loadComments();
            } else {
                showToast('Error posting', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }

    async function deleteComment(commentId) {
        if (!confirm('Are you sure you want to delete this comment?')) {
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/comments/${commentId}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('Comment deleted', 'success');
                loadComments();
            } else {
                showToast('Error deleting comment', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }

    function getTimeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        if (diffMins < 1) return 'Just now';
        if (diffMins < 60) return `${diffMins}m ago`;
        if (diffHours < 24) return `${diffHours}h ago`;
        if (diffDays < 7) return `${diffDays}d ago`;
        return date.toLocaleDateString();
    }

    // Make comment functions global
    window.loadComments = loadComments;
    window.postComment = postComment;
    window.deleteComment = deleteComment;

    // ===== DOUBLE-BACK TO EXIT =====
    // Prevent default back behavior and implement double-tap to exit
    (function initBackHandler() {
        // Push initial state to history
        history.pushState(null, '', location.href);

        // Handle browser back button (popstate event)
        window.addEventListener('popstate', function (event) {
            // Always push state back to prevent actual navigation
            history.pushState(null, '', location.href);
            handleBackPress();
        });

        // Handle React Native WebView back button
        window.addEventListener('message', function (event) {
            try {
                const data = JSON.parse(event.data);
                if (data.type === 'backPressed') {
                    handleBackPress();
                }
            } catch (e) { }
        });

        // Also listen for document message (for React Native)
        document.addEventListener('message', function (event) {
            try {
                const data = JSON.parse(event.data);
                if (data.type === 'backPressed') {
                    handleBackPress();
                }
            } catch (e) { }
        });
    })();

    function handleBackPress() {
        const currentTime = Date.now();
        const timeDiff = currentTime - lastBackPress;

        if (timeDiff < 2000) {
            // Second back press within 2 seconds - show exit popup
            showExitPopup();
        } else {
            // First back press - show toast
            showToast('Press back again to exit', 'info');
        }

        lastBackPress = currentTime;
    }

    // Exit confirmation popup
    function showExitPopup() {
        // Create overlay
        const overlay = document.createElement('div');
        overlay.id = 'exit-popup-overlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        `;

        overlay.innerHTML = `
            <div style="
                background: var(--bg-secondary);
                border-radius: 12px;
                padding: 24px;
                max-width: 300px;
                text-align: center;
                border: 1px solid var(--border);
            ">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">Exit App?</div>
                <div style="color: var(--text-secondary); margin-bottom: 20px;">Do you want to exit the application?</div>
                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button onclick="closeExitPopup()" style="
                        padding: 10px 24px;
                        background: var(--bg-tertiary);
                        border: 1px solid var(--border);
                        border-radius: 8px;
                        color: var(--text-primary);
                        cursor: pointer;
                        font-size: 14px;
                    ">No</button>
                    <button onclick="exitApp()" style="
                        padding: 10px 24px;
                        background: var(--netflix-red);
                        border: none;
                        border-radius: 8px;
                        color: white;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: 600;
                    ">Yes</button>
                </div>
            </div>
        `;

        document.body.appendChild(overlay);
    }

    window.closeExitPopup = function () {
        const overlay = document.getElementById('exit-popup-overlay');
        if (overlay) {
            overlay.remove();
        }
        lastBackPress = 0; // Reset so next single back shows toast again
    };

    window.exitApp = function () {
        // Try to close the app
        if (window.ReactNativeWebView) {
            // Send exit command to React Native
            window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'exit' }));
        } else {
            // For web, try to close the window/tab
            window.close();
            // If window.close doesn't work (not opened by script), navigate away
            setTimeout(() => {
                location.href = 'about:blank';
            }, 100);
        }
    };

    // ===== MODERN TOAST SYSTEM =====
    function showToast(message, type = 'info', duration = 3000) {
        // Remove existing toast
        const existing = document.getElementById('modern-toast');
        if (existing) existing.remove();

        // Create toast element
        const toast = document.createElement('div');
        toast.id = 'modern-toast';
        toast.innerHTML = message;

        // Style based on type
        const bgColor = type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--netflix-red)' : 'var(--bg-tertiary)';
        toast.style.cssText = `
            position: fixed;
            bottom: 100px;
            left: 20px;
            right: 20px;
            background: ${bgColor};
            color: white;
            padding: 14px 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            z-index: 9999;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        `;

        document.body.appendChild(toast);

        // Animate in
        requestAnimationFrame(() => {
            toast.style.transform = 'translateY(0)';
            toast.style.opacity = '1';
        });

        // Auto remove
        setTimeout(() => {
            toast.style.transform = 'translateY(100px)';
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 300);
        }, duration);
    }

    // ===== POST ATTACHMENT FUNCTIONS =====
    function pickPostPhoto() {
        // Try to use native picker if in WebView
        if (window.ReactNativeWebView) {
            window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'pickImage' }));
        } else {
            document.getElementById('post-photo-input').click();
        }
    }

    function pickPostFile() {
        // Try to use native picker if in WebView
        if (window.ReactNativeWebView) {
            window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'pickFile' }));
        } else {
            document.getElementById('post-file-input').click();
        }
    }

    function handlePostPhotoSelect(event) {
        const file = event.target.files[0];
        if (file) {
            postAttachment = { type: 'photo', file: file, name: file.name };
            showAttachmentPreview('üì∑ ' + file.name);
            showToast('Photo attached!', 'success');
        }
    }

    function handlePostFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
            postAttachment = { type: 'file', file: file, name: file.name };
            showAttachmentPreview('üìé ' + file.name);
            showToast('File attached!', 'success');
        }
    }

    function showAttachmentPreview(text) {
        const preview = document.getElementById('post-attachment-preview');
        const nameSpan = document.getElementById('post-attachment-name');
        if (preview && nameSpan) {
            nameSpan.textContent = text;
            preview.style.display = 'block';
        }
    }

    function removePostAttachment() {
        postAttachment = null;
        const preview = document.getElementById('post-attachment-preview');
        if (preview) preview.style.display = 'none';
        document.getElementById('post-photo-input').value = '';
        document.getElementById('post-file-input').value = '';
        showToast('Attachment removed', 'info');
    }

    // Listen for messages from React Native WebView
    window.addEventListener('message', function (event) {
        try {
            const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
            if (data.type === 'imageSelected' || data.type === 'photoTaken') {
                postAttachment = { type: 'photo', uri: data.uri, name: 'Photo' };
                showAttachmentPreview('üì∑ Photo attached');
                showToast('Photo attached!', 'success');
            } else if (data.type === 'fileSelected') {
                postAttachment = { type: 'file', uri: data.uri, name: data.name };
                showAttachmentPreview('üìé ' + data.name);
                showToast('File attached!', 'success');
            }
        } catch (e) { }
    });

    // ===== CREATE POST FUNCTION =====
    function createPost() {
        console.log('[CSMS] createPost called - version 2.0');

        const nameInput = document.getElementById('post-name');
        const plInput = document.getElementById('post-pl');
        const contentInput = document.getElementById('post-input');

        const name = nameInput.value.trim();
        const pl = plInput.value.trim();
        const content = contentInput.value.trim();

        if (!name) {
            showToast('Please enter your name', 'error');
            nameInput.focus();
            return;
        }

        if (!content) {
            showToast('Please enter a comment', 'error');
            contentInput.focus();
            return;
        }

        // Create post HTML
        const postsContainer = document.getElementById('posts-container');
        const timeAgo = 'Just now';
        const hasAttachment = postAttachment !== null;

        console.log('[CSMS] postAttachment:', postAttachment);
        console.log('[CSMS] hasAttachment:', hasAttachment);

        // Generate attachment HTML
        let attachmentHTML = '';
        if (hasAttachment) {
            const isImage = postAttachment.type === 'photo' ||
                (postAttachment.name && /\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(postAttachment.name));

            if (isImage && postAttachment.file) {
                // Create object URL for image preview
                const imageUrl = URL.createObjectURL(postAttachment.file);
                attachmentHTML = `
                    <div style="margin-bottom: 12px; border-radius: 8px; overflow: hidden;">
                        <img src="${imageUrl}" alt="Attached image" style="width: 100%; height: auto; display: block; border-radius: 8px;">
                    </div>
                `;
            } else {
                // File attachment - clickable download link
                let downloadUrl = '#';
                if (postAttachment.file) {
                    downloadUrl = URL.createObjectURL(postAttachment.file);
                }
                attachmentHTML = `
                    <div style="padding: 12px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 12px;">
                        <a href="${downloadUrl}" download="${postAttachment.name}" style="color: var(--info); text-decoration: none; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                            üìé <span style="text-decoration: underline;">${postAttachment.name}</span>
                        </a>
                    </div>
                `;
            }
        }

        const postHTML = `
            <div class="post-card" style="background: var(--bg-secondary); border-radius: 12px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border);">
                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                    <div style="width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #C41E3A, #9A1830); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px;">
                        ${name.charAt(0).toUpperCase()}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${name}</div>
                        <div style="font-size: 12px; color: var(--text-muted);">${pl ? 'PL: ' + pl + ' ‚Ä¢ ' : ''}${timeAgo}</div>
                    </div>
                </div>
                <p style="font-size: 14px; line-height: 1.5; margin-bottom: 12px;">${content}</p>
                ${attachmentHTML}
                <div style="display: flex; gap: 24px; padding-top: 12px; border-top: 1px solid var(--border);">
                    <span onclick="toggleLike(this)" data-liked="false" style="color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.2s;">üëç Like</span>
                    <span onclick="toggleReplyForm(this.parentElement.parentElement)" style="color: var(--text-secondary); font-size: 13px; cursor: pointer;">üí¨ Comment</span>
                </div>
                <!-- Reply Form (hidden by default) -->
                <div class="reply-form" style="display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
                    <div style="display: flex; gap: 10px; align-items: flex-start;">
                        <input type="text" class="reply-input" placeholder="Write a reply..."
                            style="flex: 1; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 20px; padding: 10px 16px; color: var(--text-primary); font-size: 13px;">
                        <span onclick="pickReplyPhoto(this.parentElement)" style="cursor: pointer; font-size: 18px; padding: 8px;">üì∑</span>
                        <button onclick="submitReply(this.parentElement.parentElement)" style="background: var(--netflix-red); color: white; border: none; padding: 10px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer;">Reply</button>
                    </div>
                    <div class="reply-photo-preview" style="display: none; margin-top: 8px; font-size: 12px; color: var(--success);"></div>
                    <div class="replies-container" style="margin-top: 12px;"></div>
                </div>
            </div>
        `;

        // Insert at top
        postsContainer.insertAdjacentHTML('afterbegin', postHTML);

        // Clear form
        nameInput.value = '';
        plInput.value = '';
        contentInput.value = '';
        removePostAttachment();

        showToast('Post created successfully!', 'success');
    }

    // ===== CHECK REMINDERS FUNCTION =====
    async function checkReminders() {
        showToast('Checking projects with upcoming rig down...', 'info');

        try {
            const response = await fetch(`${API_BASE}/api/send-reminders`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            if (response.ok) {
                const data = await response.json();
                if (data.count > 0) {
                    // Show project details
                    let message = `üìß ${data.count} reminder(s) sent!`;
                    if (data.projects && data.projects.length > 0) {
                        message += '\n‚Ä¢ ' + data.projects.join('\n‚Ä¢ ');
                    }
                    showToast(message, 'success', 5000);
                    showToast(`${data.count} reminder email(s) sent!`, 'success');
                } else {
                    showToast('No projects need reminders (all on track or no upcoming rig down)', 'info');
                }
            } else {
                const errorData = await response.json();
                showToast(errorData.message || 'Failed to send reminders', 'error');
            }
        } catch (error) {
            console.error('Reminder error:', error);
            showToast('Error: Could not send reminders', 'error');
        }
    }

    // ===== INIT =====
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
    });

    // ===== NAVIGATION =====
    function navigateTo(screen) {
        // Update screens
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(`screen-${screen}`).classList.add('active');

        // Update nav
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelectorAll('.drawer-item').forEach(n => n.classList.remove('active'));

        document.querySelectorAll('.nav-item')[['home', 'hse-programs', 'tasks', 'statistics', 'schedule'].indexOf(screen)]?.classList.add('active');

        // Close drawer
        document.querySelector('.drawer').classList.remove('active');
        document.querySelector('.drawer-overlay').classList.remove('active');

        // Load specific screen data
        if (screen === 'statistics') updateStatistics();
        if (screen === 'hse-kpi') renderKPIDashboard();
        if (screen === 'll-indicator') { loadLLData(); renderLLIndicator(); }
        if (screen === 'otp') { loadOTPData(); }
        if (screen === 'matrix') { loadMatrixData(); }
        if (screen === 'calendar') {
            renderMeetingCalendar();
            renderProjectCalendar();
        }
        if (screen === 'schedule') {
            populateProjectDropdown();
            loadSchedules();
        }
        if (screen === 'related-docs') {
            populateDocProjectDropdown();
            loadRelatedDocs();
        }
    }

    function toggleDrawer() {
        document.querySelector('.drawer').classList.toggle('active');
        document.querySelector('.drawer-overlay').classList.toggle('active');
    }

    // Navigate to HSE Programs screen with specific filter
    function navigateToProgramsFiltered(filter) {
        navigateTo('hse-programs');
        filterProjects(filter);
    }

    // ===== DATA LOADING =====
    async function loadData() {
        try {
            const timestamp = Date.now();
            console.log('[loadData] Fetching data with timestamp:', timestamp);

            const [projectsRes, tasksRes] = await Promise.all([
                fetch(`${API_BASE}/projects?t=${timestamp}`, {
                    cache: 'no-store',
                    headers: { 'Cache-Control': 'no-cache' }
                }),
                fetch(`${API_BASE}/tasks?t=${timestamp}`, {
                    cache: 'no-store',
                    headers: { 'Cache-Control': 'no-cache' }
                })
            ]);

            if (projectsRes.ok && tasksRes.ok) {
                allProjects = await projectsRes.json();
                allTasks = await tasksRes.json();
                console.log('[loadData] Loaded', allProjects.length, 'projects and', allTasks.length, 'tasks');
                updateHomeStats();
                updateCounts(); // Update filter counts
                renderProjects();
                renderTasks();
                loadSchedules(); // Load schedules for calendar
                renderCalendar(); // Render home calendar
                loadComments(); // Load status updates/comments
            } else {
                console.error('[loadData] Failed to fetch:', projectsRes.status, tasksRes.status);
            }
        } catch (error) {
            console.error('[loadData] Error:', error);
        }
    }

    function updateCounts() {
        // Project Counts
        document.getElementById('count-all').textContent = `(${allProjects.length})`;
        ['Upcoming', 'InProgress', 'Completed', 'OnHold', 'Canceled'].forEach(status => {
            const count = allProjects.filter(p => p.status === status).length;
            const el = document.getElementById(`count-${status.toLowerCase()}`);
            if (el) el.textContent = `(${count})`;
        });

        // Task Counts
        document.getElementById('task-count-all').textContent = `(${allTasks.length})`;
        ['Upcoming', 'In Progress', 'Completed'].forEach(status => {
            const count = allTasks.filter(t => t.status === status).length;
            const el = document.getElementById(`task-count-${status.toLowerCase().replace(' ', '')}`);
            if (el) el.textContent = `(${count})`;
        });
    }

    function updateHomeStats() {
        document.getElementById('home-total-projects').textContent = allProjects.length;
        document.getElementById('home-ongoing').textContent = allProjects.filter(p => p.status === 'InProgress' || p.status === 'Ongoing').length;
        document.getElementById('home-upcoming').textContent = allProjects.filter(p => p.status === 'Upcoming').length;
        document.getElementById('home-completed').textContent = allProjects.filter(p => p.status === 'Completed').length;

        // Update completion rate on home screen
        const completedTasks = allTasks.filter(t => t.status === 'Completed').length;
        const totalTasks = allTasks.length;
        const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

        const rateEl = document.getElementById('home-completion-rate');
        const barEl = document.getElementById('home-progress-bar');
        if (rateEl) rateEl.textContent = completionRate + '%';
        if (barEl) barEl.style.width = completionRate + '%';
    }

    // Note: createPost function is defined earlier with full attachment support

    // ===== PROJECTS =====
    function filterProjects(status) {
        currentProjectFilter = status;
        document.querySelectorAll('#project-status-filters .status-dot').forEach(d => {
            d.classList.toggle('active', d.dataset.filter === status);
        });
        renderProjects();
    }

    function renderProjects() {
        const filtered = currentProjectFilter === 'all'
            ? allProjects
            : allProjects.filter(p => p.status === currentProjectFilter);

        const container = document.getElementById('projects-container');

        if (filtered.length === 0) {
            const statusKey = currentProjectFilter === 'all' ? 'allProjects' : currentProjectFilter.toLowerCase();
            container.innerHTML = `
                    <div class="status-section">
                        <div class="status-section-title">${t(statusKey)}</div>
                        <div class="empty-message">${t('noProjectsIn')} ${t(statusKey)}</div>
                    </div>
                `;
            return;
        }

        container.innerHTML = `
                <div class="status-section">
                    ${filtered.map(p => {
            // Calculate progress
            const pTasks = allTasks.filter(t => t.project_id === p.id);
            const completed = pTasks.filter(t => t.status === 'Completed').length;
            const progress = pTasks.length > 0 ? Math.round((completed / pTasks.length) * 100) : 0;

            return `
                    <div class="project-card" onclick="showProjectDetail('${p.id}')">
                        <div class="project-card-header">
                            <span class="project-card-title">${p.name}</span>
                            <span class="project-card-badge badge-${p.status.toLowerCase()}">${t(p.status.toLowerCase()) || p.status}</span>
                        </div>
                        <div class="project-card-meta">${p.well_name || p.well || ''} ${p.kontrak_no ? '‚Ä¢ ' + p.kontrak_no : ''}</div>
                        <div style="margin-top: 12px;">
                            <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; color: var(--text-secondary);">
                                <span>${t('progress')}</span>
                                <span>${progress}%</span>
                            </div>
                            <div style="height: 6px; background: var(--border); border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; width: ${progress}%; background: var(--success); transition: width 0.3s;"></div>
                            </div>
                        </div>
                    </div>
                `}).join('')}
                </div>
            `;
    }

    // ===== TASKS =====
    function filterTasks(status) {
        currentTaskFilter = status;
        document.querySelectorAll('#task-status-filters .status-dot').forEach(d => {
            d.classList.toggle('active', d.dataset.filter === status);
        });
        renderTasks();
    }

    // Helper to get project info for a task
    function getProjectForTask(task) {
        return allProjects.find(p => p.id === task.project_id) || {};
    }

    function renderTasks() {
        let filtered = currentTaskFilter === 'all'
            ? allTasks
            : allTasks.filter(t => t.status === currentTaskFilter);

        // Sort by code numerically (e.g., 1.1, 1.2, 1.10, 2.1)
        filtered = filtered.sort((a, b) => {
            const codeA = a.code || '';
            const codeB = b.code || '';
            // Split by dot and compare each part numerically
            const partsA = codeA.split('.').map(p => parseFloat(p) || 0);
            const partsB = codeB.split('.').map(p => parseFloat(p) || 0);
            for (let i = 0; i < Math.max(partsA.length, partsB.length); i++) {
                const numA = partsA[i] || 0;
                const numB = partsB[i] || 0;
                if (numA !== numB) return numA - numB;
            }
            return 0;
        });

        const container = document.getElementById('tasks-container');

        if (filtered.length === 0) {
            const statusKey = currentTaskFilter === 'all' ? 'allTasks' : currentTaskFilter.toLowerCase().replace(' ', '');
            container.innerHTML = `
                <div class="status-section">
                    <div class="status-section-title">${t(statusKey)}</div>
                    <div class="empty-message">${t('noTasksIn')} ${t(statusKey)}</div>
                </div>
            `;
            return;
        }

        // Lightweight rendering - only show essential info
        container.innerHTML = filtered.map(task => {
            const project = getProjectForTask(task);
            const hasAttachments = task.attachments && task.attachments.length > 0;
            const attachmentCount = task.attachments ? task.attachments.length : 0;
            const latestAttachment = hasAttachments ? task.attachments[task.attachments.length - 1].filename : null;
            const statusKey = (task.status || 'upcoming').toLowerCase().replace(' ', '');

            return `
                    <div class="project-card" onclick="showTaskDetail('${task.id}')" style="position: relative;">
                        <div class="project-card-header">
                            <span>
                                <span style="color: var(--weatherford-red); font-weight: 600; font-size: 12px;">${task.code || ''}</span>
                                <span class="project-card-title" style="margin-left: 8px;">${tTask(task.title)}</span>
                            </span>
                            <span class="project-card-badge badge-${statusKey}">${t(statusKey)}</span>
                        </div>
                        <div class="project-card-meta" style="margin-bottom: 4px; display: flex; flex-direction: column; gap: 2px;">
                            <strong style="color: var(--text-primary); font-size: 13px;">${project.name || 'Unknown Project'}</strong>
                            ${(project.well_name || project.well) ? `<span style="color: var(--weatherford-red); font-size: 12px;">Well: ${project.well_name || project.well}</span>` : ''}
                        </div>
                        <div class="project-card-meta" style="font-size: 11px;">${task.category || ''}</div>
                        ${hasAttachments ? `
                            <div style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                <span style="color: var(--success); font-size: 12px;">üìé ${attachmentCount} file${attachmentCount > 1 ? 's' : ''}</span>
                                <span style="color: var(--text-muted); font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px;">${latestAttachment}</span>
                            </div>
                        ` : ''}
                    </div>
                `;
        }).join('');
    }

    // ===== MODALS =====
    function showCreateModal() {
        document.getElementById('create-modal').classList.add('active');
    }

    function closeCreateModal() {
        document.getElementById('create-modal').classList.remove('active');
        document.getElementById('project-form').reset();
    }

    function selectStatus(el) {
        document.querySelectorAll('.status-chips .status-chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        selectedStatus = el.dataset.status;
    }

    // ===== TASK MODAL =====
    function showTaskModal() {
        const modal = document.getElementById('create-task-modal');
        const select = document.getElementById('task-project-select');

        // Populate projects
        select.innerHTML = `<option value="">${t('selectProject')}</option>` +
            allProjects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        modal.classList.add('active');
        applyAllTranslations();
    }

    function closeCreateTaskModal() {
        document.getElementById('create-task-modal').classList.remove('active');
        document.getElementById('create-task-form').reset();
    }

    function onTaskProjectChange(projectId) {
        // Program selected - can add program-specific logic here if needed
        console.log('[onTaskProjectChange] Selected program:', projectId);
    }

    // Update frequency hint to show recurrence pattern
    function updateFrequencyHint() {
        const form = document.getElementById('create-task-form');
        const dateInput = form.implementation_date;
        const frequencySelect = form.frequency;
        const hintEl = document.getElementById('frequency-hint');

        if (!dateInput.value || frequencySelect.value === 'once') {
            hintEl.style.display = 'none';
            updateReminderHint('once');
            return;
        }

        const date = new Date(dateInput.value);
        const day = date.getDate();
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'];
        const month = monthNames[date.getMonth()];

        let hint = '';
        switch (frequencySelect.value) {
            case 'monthly':
                hint = `üîÑ Recurring: Every ${day}${getOrdinalSuffix(day)} of each month`;
                break;
            case 'quarterly':
                hint = `üîÑ Recurring: Every ${day}${getOrdinalSuffix(day)} (Jan, Apr, Jul, Oct pattern)`;
                break;
            case 'semi-annual':
                hint = `üîÑ Recurring: Every ${day}${getOrdinalSuffix(day)} (every 6 months)`;
                break;
            case 'annual':
                hint = `üîÑ Recurring: Every ${month} ${day}${getOrdinalSuffix(day)} (yearly)`;
                break;
        }

        hintEl.textContent = hint;
        hintEl.style.display = hint ? 'block' : 'none';
        updateReminderHint(frequencySelect.value);
    }

    // Update reminder text based on frequency (monthly = 2 weeks, others = 1 month + 2 weeks)
    function updateReminderHint(frequency) {
        const reminderEl = document.getElementById('reminder-hint');
        if (!reminderEl) return;

        if (frequency === 'monthly') {
            reminderEl.textContent = 'üìß Email reminders sent 2 weeks before each implementation date';
        } else {
            reminderEl.textContent = 'üìß Email reminders sent 1 month and 2 weeks before implementation date';
        }
    }

    function getOrdinalSuffix(day) {
        if (day > 3 && day < 21) return 'th';
        switch (day % 10) {
            case 1: return 'st';
            case 2: return 'nd';
            case 3: return 'rd';
            default: return 'th';
        }
    }

    // Make selectTaskStatus globally accessible (needed for onclick in dynamic HTML)
    window.selectTaskStatus = function (el) {
        console.log('[selectTaskStatus] Called with:', el);
        console.log('[selectTaskStatus] data-status:', el.dataset.status);
        // Handle both new task form and task detail modal
        el.parentElement.querySelectorAll('.status-chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        console.log('[selectTaskStatus] Active class added to:', el.dataset.status);
        // Only update hidden input if it exists (new task form)
        const hiddenInput = document.getElementById('new-task-status');
        if (hiddenInput) {
            hiddenInput.value = el.dataset.status;
        }
    };

    async function createNewTask() {
        const form = document.getElementById('create-task-form');
        const projectId = form.project_id.value;
        if (!projectId) { showToast('Please select an HSE Program', 'error'); return; }

        if (!form.code.value.trim()) { showToast('Please enter Task ID/Code', 'error'); return; }
        if (!form.title.value.trim()) { showToast('Please enter Task Description', 'error'); return; }
        if (!form.implementation_date.value) { showToast('Please select Implementation Plan Date', 'error'); return; }
        if (!form.pic_name.value.trim()) { showToast('Please enter PIC Name', 'error'); return; }
        if (!form.pic_email.value.trim()) { showToast('Please enter PIC Email', 'error'); return; }

        // Task data with new HSE Program fields
        const taskData = {
            project_id: projectId,
            code: form.code.value.trim(),
            title: form.title.value.trim(),
            implementation_date: form.implementation_date.value,
            frequency: form.frequency.value || 'once',
            pic_name: form.pic_name.value.trim(),
            pic_email: form.pic_email.value.trim(),
            status: form.status.value || 'Upcoming'
        };

        console.log('[createNewTask] Sending task data:', taskData);

        try {
            const res = await fetch(`${API_BASE}/tasks`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(taskData)
            });

            if (res.ok) {
                const newTask = await res.json();
                console.log('[createNewTask] Task created:', newTask);
                showToast('Task created successfully!', 'success');
                closeCreateTaskModal();
                form.reset();
                // Reset status chips
                document.querySelectorAll('#create-task-form .status-chip').forEach(c => c.classList.remove('active'));
                document.querySelector('#create-task-form .status-chip[data-status="Upcoming"]')?.classList.add('active');
                await loadData(); // Wait for data to fully refresh before any navigation
                updateStatistics(); // Refresh statistics dashboard
            } else {
                const errorData = await res.json().catch(() => ({}));
                console.error('[createNewTask] Error response:', errorData);
                showToast(errorData.detail || 'Error creating task', 'error');
            }
        } catch (error) {
            console.error('[createNewTask] Error:', error);
            showToast('Error connecting to server', 'error');
        }
    }


    async function saveProject() {
        const form = document.getElementById('project-form');

        // Get optional fields safely  
        const picManagerInput = document.getElementById('project-manager-email');
        const picManagerEmail = picManagerInput ? picManagerInput.value.trim() : '';

        // Get category (new HSE field)
        const categorySelect = form.querySelector('[name="category"]');
        const category = categorySelect ? categorySelect.value : 'other';

        console.log('[DEBUG] Saving HSE Program with category:', category);

        const data = {
            name: form.name?.value || '',
            title: form.title?.value || '',  // Description field
            category: category,
            well_name: '',  // Not used in HSE Programs
            kontrak_no: '', // Not used in HSE Programs  
            status: selectedStatus || 'Upcoming',
            start_date: form.start_date?.value || null,
            end_date: form.end_date?.value || null,
            rig_down: form.rig_down?.value || null,  // Target Implementation Date
            assigned_to: form.assigned_to?.value || '',
            pic_email: form.pic_email?.value || '',
            pic_manager_email: picManagerEmail || null
        };

        // Validate required fields
        if (!data.name.trim()) {
            showToast('Program name is required', 'error');
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/projects`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                const newProgram = await res.json();
                showToast('HSE Program created successfully!', 'success');
                closeCreateModal();
                await loadData(); // Wait for data to reload
                updateStatistics(); // Refresh statistics dashboard
                renderProjectCalendar(); // Refresh Calendar

                // Open the newly created program's detail view
                if (newProgram && newProgram.id) {
                    showProgramDetail(newProgram.id);
                }
            } else {
                const errorText = await res.text();
                console.error('[ERROR] Server response:', errorText);
                showToast('Error creating program: ' + (res.statusText || 'Server error'), 'error');
            }
        } catch (error) {
            console.error('[ERROR] Connection error:', error);
            showToast('Error connecting to server. Make sure the backend is running.', 'error');
        }
    }

    async function showProjectDetail(projectId) {
        try {
            const res = await fetch(`${API_BASE}/projects/${projectId}?t=${Date.now()}`);
            if (res.ok) {
                const data = await res.json();
                const project = data.project;
                const tasks = data.tasks;

                document.getElementById('project-detail-title').textContent = project.name;
                document.getElementById('project-detail-content').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <span class="project-card-badge badge-${project.status?.toLowerCase() || 'upcoming'}">${t(project.status?.toLowerCase()) || project.status}</span>
                        </div>
                        ${(project.description || project.title) ? `<p style="color: var(--text-secondary); margin-bottom: 20px;">${project.description || project.title}</p>` : ''}
                        <p style="margin-bottom: 8px;"><strong>${t('well')}:</strong> ${project.well_name || project.well || 'N/A'}</p>
                        <p style="margin-bottom: 8px;"><strong>${t('kontrakNo')}:</strong> ${project.kontrak_no || 'N/A'}</p>
                        <p style="margin-bottom: 8px;"><strong>${t('startDate')}:</strong> ${project.start_date || 'N/A'}</p>
                        <p style="margin-bottom: 20px;"><strong>${t('endDate')}:</strong> ${project.end_date || 'N/A'}</p>
                        
                        <!-- Admin Delete Button -->
                        <div class="admin-only" style="margin-bottom: 20px;">
                            <button class="delete-btn" onclick="deleteProject('${project.id}', '${project.name.replace(/'/g, "\\'")}')">
                                üóëÔ∏è ${t('deleteProject')}
                            </button>
                        </div>
                        
                        <h3 style="margin-bottom: 16px;">${t('tasks')} (${tasks.length})</h3>
                        ${tasks.map(t => {
                    const hasAttachments = t.attachments && t.attachments.length > 0;
                    const attachmentInfo = hasAttachments
                        ? t.attachments.map(a => a.filename).join(', ')
                        : '';
                    return `
                            <div class="project-card" onclick="showTaskDetail('${t.id}'); closeProjectDetailModal();">
                                <div class="project-card-header">
                                    <span style="color: var(--netflix-red); font-weight: 600;">${t.code}</span>
                                    <span class="project-card-badge badge-${t.status?.toLowerCase().replace(' ', '') || 'upcoming'}" style="font-size: 10px;">${t.status}</span>
                                </div>
                                <div class="project-card-title">${tTask(t.title)}</div>
                                ${hasAttachments ? `
                                    <div style="margin-top: 8px; font-size: 11px; color: var(--success);">
                                        üìé ${attachmentInfo}
                                    </div>
                                ` : ''}
                            </div>
                        `}).join('')}
                    `;
                document.getElementById('project-detail-modal').classList.add('active');
            }
        } catch (error) {
            console.error('[showProjectDetail] Error:', error);
        }
    }

    function closeProjectDetailModal() {
        document.getElementById('project-detail-modal').classList.remove('active');
    }

    // Show program detail using local data (works without dedicated backend endpoint)
    function showProgramDetail(programId) {
        // Find program in local data
        const program = allProjects.find(p => p.id == programId);
        if (!program) {
            console.error('[showProgramDetail] Program not found:', programId);
            showToast('Program not found', 'error');
            return;
        }

        // Find tasks associated with this program
        const programTasks = allTasks.filter(t => t.project_id == programId);

        document.getElementById('project-detail-title').textContent = program.name;
        document.getElementById('project-detail-content').innerHTML = `
            <div style="margin-bottom: 20px;">
                <span class="project-card-badge badge-${(program.status || 'upcoming').toLowerCase()}">${t((program.status || 'Upcoming').toLowerCase()) || program.status}</span>
                ${program.category ? '<span style="margin-left: 8px; padding: 4px 8px; background: var(--bg-tertiary); border-radius: 4px; font-size: 11px;">' + program.category + '</span>' : ''}
            </div>
            ${program.title ? '<p style="color: var(--text-secondary); margin-bottom: 20px;">' + program.title + '</p>' : ''}
            <p style="margin-bottom: 8px;"><strong>Start Date:</strong> ${program.start_date || 'N/A'}</p>
            <p style="margin-bottom: 8px;"><strong>Target Date:</strong> ${program.rig_down || 'N/A'}</p>
            ${program.assigned_to ? '<p style="margin-bottom: 20px;"><strong>PIC:</strong> ' + program.assigned_to + '</p>' : ''}
            
            <div class="admin-only" style="margin-bottom: 20px;">
                <button class="delete-btn" onclick="deleteProject('${program.id}', '${(program.name || '').replace(/'/g, "\\'")}')">üóëÔ∏è Delete Program</button>
            </div>
            
            <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="margin: 0;">Tasks (${programTasks.length})</h3>
                    <button class="admin-only" onclick="openTaskFormForProgram('${program.id}')" 
                        style="background: var(--weatherford-red); color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer;">+ Add Task</button>
                </div>
                ${programTasks.length === 0 ? `
                <div style="text-align: center; padding: 30px; color: var(--text-muted);">
                        <p style="font-size: 32px; margin-bottom: 8px;">üìã</p>
                        <p>No tasks yet for this program.</p>
                        <p style="font-size: 12px; margin-top: 8px;">Click "+ Add Task" to create the first task.</p>
                    </div>
            ` : programTasks.map(task => {
            const hasAttachments = task.attachments && task.attachments.length > 0;
            const attachmentInfo = hasAttachments ? task.attachments.map(a => a.filename).join(', ') : '';
            const statusKey = (task.status || 'upcoming').toLowerCase().replace(' ', '');
            return `
                            <div class="project-card" onclick="showTaskDetail('${task.id}'); closeProjectDetailModal();">
                                <div class="project-card-header">
                                    <span style="color: var(--netflix-red); font-weight: 600;">${task.code || ''}</span>
                                    <span class="project-card-badge badge-${statusKey}" style="font-size: 10px;">${task.status || 'Upcoming'}</span>
                                </div>
                                <div class="project-card-title">${tTask(task.title)}</div>
                                ${hasAttachments ? `<div style="margin-top: 8px; font-size: 11px; color: var(--success);">üìé ${attachmentInfo}</div>` : ''}
                            </div>
                        `;
        }).join('')}
            </div>
        `;
        document.getElementById('project-detail-modal').classList.add('active');
    }

    // Helper function to open task form with program pre-selected
    function openTaskFormForProgram(programId) {
        closeProjectDetailModal();
        showTaskModal();
        setTimeout(function () {
            const select = document.getElementById('task-project-select');
            if (select) {
                select.value = programId;
                onTaskProjectChange(programId);
            }
        }, 100);
    }

    function showTaskDetail(taskId) {
        const task = allTasks.find(t => t.id === taskId);
        if (!task) return;

        currentTaskId = taskId;
        const project = getProjectForTask(task);

        document.getElementById('task-detail-content').innerHTML = `
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">HSE Program</div>
                    <div style="font-weight: 600; font-size: 16px;">${project.name || 'Unknown Program'}</div>
                </div>
                
                <div class="task-code">${task.code || ''}</div>
                <div class="task-title-detail">${tTask(task.title)}</div>
                
                ${task.implementation_date ? '<div style="margin: 8px 0; font-size: 13px; color: var(--text-secondary);">üìÖ Implementation: ' + task.implementation_date + '</div>' : ''}
                ${task.frequency ? '<div style="margin: 8px 0; font-size: 13px; color: var(--text-secondary);">üîÑ Frequency: ' + task.frequency + '</div>' : ''}
                ${task.pic_name ? '<div style="margin: 8px 0; font-size: 13px; color: var(--text-secondary);">üë§ PIC: ' + task.pic_name + '</div>' : ''}
                
                <div class="form-group" style="margin-top: 16px;">
                    <label class="form-label">WPTS ID</label>
                    <input type="text" class="form-input" id="task-wpts-id" value="${task.wpts_id || ''}" placeholder="Enter WPTS ID">
                </div>
                
                <div class="form-group">
                    <label class="form-label">${t('status')}</label>
                    <div class="status-chips" id="task-status-chips">
                        <div class="status-chip ${task.status === 'Upcoming' ? 'active' : ''}" data-status="Upcoming" onclick="selectTaskStatus(this)">Planned</div>
                        <div class="status-chip ${task.status === 'In Progress' ? 'active' : ''}" data-status="In Progress" onclick="selectTaskStatus(this)">In Progress</div>
                        <div class="status-chip ${task.status === 'Completed' ? 'active' : ''}" data-status="Completed" onclick="selectTaskStatus(this)">Implemented</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">${t('uploadAttachment')}</label>
                    <div class="upload-area" onclick="document.getElementById('file-input').click()" id="upload-area">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                        <p>${t('clickToUpload')}</p>
                        <p style="font-size: 11px; color: var(--text-muted);">${t('filesStoredInDrive')}</p>
                    </div>
                    <input type="file" id="file-input" onchange="uploadFile()" multiple>
                </div>
                
                ${task.attachments && task.attachments.length > 0 ? `
                    <div class="form-group">
                        <label class="form-label">${t('uploadedFiles')} (${task.attachments.length})</label>
                        <div style="max-height: 200px; overflow-y: auto;">
                            ${task.attachments.map((a, i) => `
                                <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--bg-tertiary); border-radius: 6px; margin-bottom: 6px;">
                                    <span style="color: var(--success);">üìé</span>
                                    <span style="flex: 1; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${a.filename}</span>
                                    <span style="font-size: 10px; color: var(--text-muted);">${formatDate(a.uploaded_at)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div class="admin-only" style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border);">
                    <button class="delete-btn" onclick="deleteTask('${task.id}', '${(task.code || '').replace(/'/g, "\\'")}')">üóëÔ∏è Delete Task</button>
                </div>
        `;

        document.getElementById('task-modal').classList.add('active');
    }

    function closeTaskModal() {
        document.getElementById('task-modal').classList.remove('active');
        currentTaskId = null;
    }


    async function saveTaskChanges() {
        if (!currentTaskId) return;

        const activeChip = document.querySelector('#task-status-chips .status-chip.active');
        const status = activeChip ? activeChip.dataset.status : 'Upcoming';
        const wptsIdInput = document.getElementById('task-wpts-id');
        const wpts_id = wptsIdInput ? wptsIdInput.value : '';

        console.log('[SAVE] Task ID:', currentTaskId);
        console.log('[SAVE] Status:', status, 'WPTS ID:', wpts_id);

        try {
            const res = await fetch(`${API_BASE}/tasks/${currentTaskId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status, wpts_id })
            });

            console.log('[SAVE] Response status:', res.status);

            if (res.ok) {
                const data = await res.json();
                console.log('[SAVE] Response data:', data);
                showToast('Task saved successfully!', 'success');
                closeTaskModal();
                await loadData();
            } else {
                console.error('[SAVE] Error response:', res.status);
                showToast('Error saving task', 'error');
            }
        } catch (error) {
            console.error(error);
        }
    }

    async function uploadFile() {
        if (!currentTaskId) return;

        const fileInput = document.getElementById('file-input');
        if (!fileInput.files || fileInput.files.length === 0) return;

        const uploadArea = document.getElementById('upload-area');
        const files = Array.from(fileInput.files);
        let successCount = 0;
        let failCount = 0;

        // Show uploading indicator
        if (uploadArea) {
            uploadArea.innerHTML = `
        < div style = "color: var(--netflix-red);" >
                        <p>Uploading ${files.length} file(s)...</p>
                        <p style="font-size: 11px;">Please wait</p>
                    </div >
        `;
        }

        // Upload each file
        for (const file of files) {
            const formData = new FormData();
            formData.append('file', file);

            try {
                const res = await fetch(`${API_BASE} /tasks/${currentTaskId}/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (res.ok) {
                    successCount++;
                } else {
                    failCount++;
                }
            } catch (error) {
                failCount++;
            }
        }

        // Reset file input
        fileInput.value = '';

        // Show result and refresh
        if (successCount > 0) {
            showToast(`${successCount} file(s) uploaded successfully!${failCount > 0 ? ` (${failCount} failed)` : ''}`, 'success');
        } else {
            showToast('Error uploading files', 'error');
        }

        // Save the currently selected status before refreshing
        const activeChip = document.querySelector('#task-status-chips .status-chip.active');
        const selectedStatus = activeChip ? activeChip.dataset.status : null;
        console.log('[uploadFile] Preserving selected status:', selectedStatus);

        // Refresh data and reopen task detail
        await loadData();
        showTaskDetail(currentTaskId);

        // Restore the selected status after modal re-renders
        if (selectedStatus) {
            setTimeout(() => {
                const chips = document.querySelectorAll('#task-status-chips .status-chip');
                chips.forEach(c => {
                    c.classList.remove('active');
                    if (c.dataset.status === selectedStatus) {
                        c.classList.add('active');
                        console.log('[uploadFile] Restored status selection:', selectedStatus);
                    }
                });
            }, 100);
        }
    }

    // ===== MODERN DASHBOARD =====
    async function loadDashboardStats() {
        try {
            const res = await fetch(`${API_BASE}/statistics`);
            if (!res.ok) return;

            const stats = await res.json();

            // Update KPI cards
            document.getElementById('stat-total-projects').textContent = stats.projects.total;
            document.getElementById('stat-total-tasks').textContent = stats.tasks.total;
            document.getElementById('stat-completion-rate').textContent = `${stats.tasks.completion_rate.toFixed(0)}%`;
            document.getElementById('stat-upcoming-mwt').textContent = stats.schedules.upcoming_mwt;

            // Update schedule stats
            document.getElementById('stat-total-schedules').textContent = stats.schedules.total;
            document.getElementById('stat-this-month').textContent = stats.schedules.this_month;

            // Render Project Donut Chart
            const projectColors = { 'Upcoming': '#F5A623', 'InProgress': '#46D369', 'Completed': '#4A90D9', 'OnHold': '#9B59B6' };
            createDonutChart('project-donut-chart', 'project-legend-new', stats.projects.by_status, projectColors, stats.projects.total);

            // Render Task Donut Chart
            const taskColors = { 'Upcoming': '#F5A623', 'In Progress': '#46D369', 'Completed': '#4A90D9' };
            createDonutChart('task-donut-chart', 'task-legend-new', stats.tasks.by_status, taskColors, stats.tasks.total);

            // Render Project Completion Bars
            const barsContainer = document.getElementById('project-completion-bars');
            if (barsContainer) {
                if (stats.project_completion.length === 0) {
                    barsContainer.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No projects yet</p>';
                } else {
                    barsContainer.innerHTML = stats.project_completion.map(p => `
                            <div style="margin-bottom: 12px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span style="font-size: 13px;">${p.name}</span>
                                    <span style="font-size: 12px; color: ${p.percentage >= 95 ? 'var(--success)' : p.percentage >= 50 ? 'var(--warning)' : '#E50914'};">
                                        ${p.completed}/${p.total} (${p.percentage.toFixed(0)}%)
                                    </span>
                                </div>
                                <div style="background: var(--bg-tertiary); border-radius: 4px; height: 8px; overflow: hidden;">
                                    <div style="background: ${p.percentage >= 95 ? '#46D369' : p.percentage >= 50 ? '#F5A623' : '#E50914'}; 
                                         height: 100%; width: ${p.percentage}%; transition: width 0.5s ease;"></div>
                                </div>
                            </div>
                        `).join('');
                }
            }

            // Always load fresh schedule data for accurate stats
            try {
                const schedRes = await fetch(`${API_BASE}/schedules?t=${Date.now()}`);
                if (schedRes.ok) allSchedules = await schedRes.json();
            } catch (e) { console.error('Error loading schedules:', e); }

            // Update schedule type counts
            updateScheduleTypeCounts();

            // Render analytics charts
            renderScheduleBarChart();
            renderProgressAreaChart();
            renderMonthlyTrendChart();
            renderTaskProgressChart();

            // Render monthly charts gallery
            renderMonthlyChartsGallery();

            // Render project charts gallery
            renderProjectChartsGallery();

            // Load PB statistics
            loadPBStats();

        } catch (error) {
            console.error('Error loading dashboard stats:', error);
        }
    }

    function updateScheduleTypeCounts() {
        const typeCounts = {
            mwt: 0, hse: 0, csms: 0, hseplan: 0, spr: 0, hazid: 0
        };
        const today = new Date();

        allSchedules.forEach(s => {
            const type = s.schedule_type || 'mwt';
            const dateField = {
                mwt: 'mwt_plan_date', hse: 'hse_meeting_date', csms: 'csms_pb_date',
                hseplan: 'hseplan_date', spr: 'spr_date', hazid: 'hazid_date'
            }[type];

            const date = new Date(s[dateField] || s.mwt_plan_date);
            if (date >= today) {
                typeCounts[type]++;
            }
        });

        // Update UI
        const updateEl = (id, val) => {
            const el = document.getElementById(id);
            if (el) el.textContent = val;
        };
        updateEl('stat-upcoming-mwt-count', typeCounts.mwt);
        updateEl('stat-upcoming-hse-count', typeCounts.hse);
        updateEl('stat-upcoming-csms-count', typeCounts.csms);
        updateEl('stat-upcoming-hseplan-count', typeCounts.hseplan);
        updateEl('stat-upcoming-spr-count', typeCounts.spr);
        updateEl('stat-upcoming-hazid-count', typeCounts.hazid);
    }

    async function loadPBStats() {
        try {
            const res = await fetch(`${API_BASE}/csms-pb`);
            if (!res.ok) return;
            const pbRecords = await res.json();

            const total = pbRecords.length;
            const scores = pbRecords.map(p => parseFloat(p.score) || 0).filter(s => s > 0);
            const lowest = scores.length > 0 ? Math.min(...scores) : 0;
            const highest = scores.length > 0 ? Math.max(...scores) : 0;
            const average = scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length) : 0;

            document.getElementById('stat-pb-total').textContent = total;
            document.getElementById('stat-pb-lowest').textContent = lowest.toFixed(0);
            document.getElementById('stat-pb-highest').textContent = highest.toFixed(0);
            document.getElementById('stat-pb-average').textContent = average.toFixed(1);

            // Render PB score chart by well name
            const wellScores = {};
            pbRecords.forEach(p => {
                const well = p.well_name || p.project_name || 'Unknown';
                const score = parseFloat(p.score) || 0;
                if (!wellScores[well] || score > wellScores[well]) {
                    wellScores[well] = score;
                }
            });

            const scoreContainer = document.getElementById('pb-score-chart');
            const analyticsContainer = document.getElementById('pb-analytics-chart');

            if (Object.keys(wellScores).length > 0) {
                const maxScore = Math.max(...Object.values(wellScores), 100);
                const chartHTML = Object.entries(wellScores).slice(0, 8).map(([well, score]) => {
                    const color = score >= 80 ? '#27ae60' : score >= 60 ? '#f1c40f' : '#e74c3c';
                    return `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                        <div style="font-size: 10px; font-weight: 600; color: ${color}; margin-bottom: 2px;">${score.toFixed(0)}</div>
                        <div style="background: linear-gradient(180deg, ${color}, ${color}88); width: 100%; max-width: 30px; border-radius: 4px 4px 0 0; 
                             height: ${(score / maxScore) * 100}px; min-height: 8px; transition: height 0.5s;"></div>
                        <div style="font-size: 8px; color: var(--text-muted); margin-top: 4px; text-align: center; max-width: 40px; 
                             overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${well}">${well.substring(0, 6)}</div>
                    </div>
                `;
                }).join('');

                if (scoreContainer) scoreContainer.innerHTML = chartHTML;
                if (analyticsContainer) analyticsContainer.innerHTML = chartHTML;
            }

            // Render PB Records List with delete buttons
            const recordsListContainer = document.getElementById('pb-records-list');
            if (recordsListContainer) {
                if (pbRecords.length === 0) {
                    recordsListContainer.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No PB records yet</p>';
                } else {
                    recordsListContainer.innerHTML = pbRecords.slice(0, 10).map(pb => {
                        const score = parseFloat(pb.score) || 0;
                        const color = score >= 80 ? '#27ae60' : score >= 60 ? '#f1c40f' : '#e74c3c';
                        const dateStr = pb.pb_date ? new Date(pb.pb_date).toLocaleDateString() : 'N/A';
                        return `
                            <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid ${color};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; font-size: 14px;">${pb.project_name || 'Unknown Project'}</div>
                                        <div style="font-size: 12px; color: var(--text-muted);">${pb.well_name || ''} ‚Ä¢ ${dateStr}</div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="background: ${color}; color: white; padding: 4px 10px; border-radius: 8px; font-weight: 600; font-size: 14px;">
                                            ${score.toFixed(0)}%
                                        </div>
                                        <button class="delete-btn admin-only" onclick="event.stopPropagation(); deletePBRecord('${pb.id}')" style="padding: 4px 8px; font-size: 10px;">üóëÔ∏è</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }
        } catch (error) {
            console.error('Error loading PB stats:', error);
        }
    }

    async function renderMonthlyChartsGallery() {
        const currentYear = new Date().getFullYear();
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

        // Helper to count items by month
        const countByMonth = (items, dateField) => {
            const counts = Array(12).fill(0);
            items.forEach(item => {
                const dateVal = item[dateField];
                if (dateVal) {
                    const d = new Date(dateVal);
                    if (d.getFullYear() === currentYear) {
                        counts[d.getMonth()]++;
                    }
                }
            });
            return counts;
        };

        // Helper to render bar chart
        const renderBarChart = (containerId, counts, color) => {
            const container = document.getElementById(containerId);
            if (!container) return;
            const max = Math.max(...counts, 1);
            container.innerHTML = counts.map((c, i) => `
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                    <div style="font-size: 8px; font-weight: 600; color: ${color}; margin-bottom: 2px;">${c > 0 ? c : ''}</div>
                    <div style="width: 100%; background: ${c > 0 ? `linear-gradient(180deg, ${color}, ${color}66)` : 'var(--bg-tertiary)'}; 
                         border-radius: 2px 2px 0 0; height: ${c > 0 ? (c / max) * 60 : 4}px; min-height: 4px; transition: height 0.5s;"></div>
                </div>
            `).join('');
        };

        // Schedule type charts
        const scheduleTypes = [
            { type: 'mwt', field: 'mwt_plan_date', chartId: 'monthly-mwt-chart', color: '#3498db' },
            { type: 'hse', field: 'hse_meeting_date', chartId: 'monthly-hse-chart', color: '#9b59b6' },
            { type: 'hseplan', field: 'hseplan_date', chartId: 'monthly-hseplan-chart', color: '#e67e22' },
            { type: 'spr', field: 'spr_date', chartId: 'monthly-spr-chart', color: '#1abc9c' },
            { type: 'hazid', field: 'hazid_date', chartId: 'monthly-hazid-chart', color: '#e74c3c' },
            { type: 'csms', field: 'csms_pb_date', chartId: 'monthly-csms-chart', color: '#27ae60' }
        ];

        scheduleTypes.forEach(st => {
            const filtered = allSchedules.filter(s => s.schedule_type === st.type);
            const counts = countByMonth(filtered, st.field);
            renderBarChart(st.chartId, counts, st.color);
        });

        // Projects by month (using created_at)
        const projectCounts = countByMonth(allProjects, 'created_at');
        renderBarChart('monthly-projects-chart', projectCounts, '#E50914');

        // Tasks completed by month
        const completedTasks = allTasks.filter(t => t.status === 'Completed');
        const taskCounts = countByMonth(completedTasks, 'created_at');
        renderBarChart('monthly-tasks-chart', taskCounts, '#46D369');

        // PB Scores scatter plot
        try {
            const res = await fetch(`${API_BASE}/csms-pb`);
            if (res.ok) {
                const pbRecords = await res.json();
                const container = document.getElementById('monthly-pb-scores-chart');
                if (container && pbRecords.length > 0) {
                    // Generate unique colors for projects
                    const projectColors = {};
                    const colors = ['#e74c3c', '#3498db', '#27ae60', '#f1c40f', '#9b59b6', '#1abc9c', '#e67e22', '#34495e'];
                    let colorIndex = 0;

                    const dots = pbRecords.map(pb => {
                        const dateVal = pb.created_at || pb.audit_date;
                        if (!dateVal) return '';
                        const d = new Date(dateVal);
                        if (d.getFullYear() !== currentYear) return '';

                        const month = d.getMonth();
                        const score = parseFloat(pb.score) || 0;
                        const projectName = pb.project_name || pb.well_name || 'Unknown';

                        if (!projectColors[projectName]) {
                            projectColors[projectName] = colors[colorIndex % colors.length];
                            colorIndex++;
                        }

                        const left = (month / 11) * 100;
                        const bottom = (score / 100) * 100;

                        return `<div style="position: absolute; left: ${left}%; bottom: ${bottom}%; transform: translate(-50%, 50%);
                                    width: 10px; height: 10px; border-radius: 50%; background: ${projectColors[projectName]}; 
                                    border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); cursor: pointer;"
                                    title="${projectName}: ${score}"></div>`;
                    }).join('');

                    // Add Y-axis labels
                    const yLabels = `
                        <div style="position: absolute; left: -20px; top: 0; font-size: 8px; color: var(--text-muted);">100</div>
                        <div style="position: absolute; left: -20px; top: 50%; font-size: 8px; color: var(--text-muted);">50</div>
                        <div style="position: absolute; left: -20px; bottom: 0; font-size: 8px; color: var(--text-muted);">0</div>
                    `;

                    container.innerHTML = yLabels + dots;

                    // Add legend if we have projects
                    const legendHTML = Object.entries(projectColors).slice(0, 5).map(([name, color]) =>
                        `<span style="display: inline-flex; align-items: center; gap: 4px; margin-right: 8px;">
                            <span style="width: 8px; height: 8px; border-radius: 50%; background: ${color};"></span>
                            <span style="font-size: 8px; color: var(--text-muted);">${name.substring(0, 10)}</span>
                        </span>`
                    ).join('');

                    if (legendHTML) {
                        container.insertAdjacentHTML('afterend',
                            `<div style="display: flex; flex-wrap: wrap; gap: 4px; margin-top: 8px;">${legendHTML}</div>`);
                    }
                }
            }
        } catch (error) {
            console.error('Error loading PB scores for monthly chart:', error);
        }
    }

    async function renderProjectChartsGallery() {
        // Helper to render project bar chart
        const renderProjectBarChart = (containerId, data, color, isPercentage = false) => {
            const container = document.getElementById(containerId);
            if (!container || data.length === 0) {
                if (container) container.innerHTML = '<div style="color: var(--text-muted); font-size: 10px; text-align: center; width: 100%;">No data</div>';
                return;
            }
            const max = Math.max(...data.map(d => d.value), isPercentage ? 100 : 1);
            container.innerHTML = data.slice(0, 10).map(d => {
                const barColor = isPercentage ? (d.value >= 80 ? '#27ae60' : d.value >= 50 ? '#f1c40f' : '#e74c3c') : color;
                return `
                <div style="flex: 1; min-width: 40px; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                    <div style="font-size: 9px; font-weight: 600; color: ${barColor}; margin-bottom: 2px;">${isPercentage ? d.value.toFixed(0) + '%' : d.value}</div>
                    <div style="width: 100%; background: linear-gradient(180deg, ${barColor}, ${barColor}66); 
                         border-radius: 3px 3px 0 0; height: ${(d.value / max) * 70}px; min-height: 8px; transition: height 0.5s;"></div>
                    <div style="font-size: 7px; color: var(--text-muted); margin-top: 4px; text-align: center; max-width: 40px;
                         overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${d.name}">${d.name.substring(0, 6)}</div>
                </div>
            `;
            }).join('');
        };

        // Tasks per project
        const tasksByProject = allProjects.map(p => ({
            name: p.name || p.well || 'Unknown',
            value: allTasks.filter(t => t.project_id === p.id).length
        })).filter(d => d.value > 0);
        renderProjectBarChart('project-tasks-chart', tasksByProject, '#F5A623');

        // Schedules per project
        const schedulesByProject = allProjects.map(p => ({
            name: p.name || p.well || 'Unknown',
            value: allSchedules.filter(s => s.project_id === p.id).length
        })).filter(d => d.value > 0);
        renderProjectBarChart('project-schedules-chart', schedulesByProject, '#3498db');

        // PB Records per project
        try {
            const res = await fetch(`${API_BASE}/csms-pb?t=${Date.now()}`);
            if (res.ok) {
                const pbRecords = await res.json();

                // Count by project
                const pbByProject = {};
                const scoreByProject = {};
                const scoreCountByProject = {};

                pbRecords.forEach(pb => {
                    const name = pb.project_name || pb.well_name || 'Unknown';
                    pbByProject[name] = (pbByProject[name] || 0) + 1;

                    const score = parseFloat(pb.score) || 0;
                    if (score > 0) {
                        scoreByProject[name] = (scoreByProject[name] || 0) + score;
                        scoreCountByProject[name] = (scoreCountByProject[name] || 0) + 1;
                    }
                });

                const pbData = Object.entries(pbByProject).map(([name, value]) => ({ name, value }));
                renderProjectBarChart('project-pb-chart', pbData, '#27ae60');

                // Average PB Score per project
                const avgScoreData = Object.entries(scoreByProject).map(([name, total]) => ({
                    name,
                    value: total / scoreCountByProject[name]
                }));
                renderProjectBarChart('project-pb-score-chart', avgScoreData, '#9b59b6', true);
            }
        } catch (error) {
            console.error('Error loading PB data for project charts:', error);
        }

        // Task completion rate per project
        const completionByProject = allProjects.map(p => {
            const projectTasks = allTasks.filter(t => t.project_id === p.id);
            const completed = projectTasks.filter(t => t.status === 'Completed').length;
            const total = projectTasks.length;
            return {
                name: p.name || p.well || 'Unknown',
                value: total > 0 ? (completed / total) * 100 : 0
            };
        }).filter(d => d.value > 0);
        renderProjectBarChart('project-completion-chart', completionByProject, '#46D369', true);
    }

    function renderTaskProgressChart() {
        const container = document.getElementById('task-progress-chart');
        if (!container) return;

        const statuses = [
            { key: 'Upcoming', color: '#F5A623', labelKey: 'upcoming' },
            { key: 'In Progress', color: '#46D369', labelKey: 'inprogress' },
            { key: 'Completed', color: '#4A90D9', labelKey: 'completed' }
        ];

        const counts = statuses.map(s => ({
            ...s,
            count: allTasks.filter(t => t.status === s.key).length
        }));

        const total = allTasks.length || 1;

        container.innerHTML = counts.map(s => {
            const percentage = ((s.count / total) * 100).toFixed(0);
            return `
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                <div style="font-size: 20px; font-weight: 700; color: ${s.color};">${s.count}</div>
                <div style="width: 100%; height: 8px; background: var(--bg-tertiary); border-radius: 4px; margin: 8px 0; overflow: hidden;">
                    <div style="height: 100%; width: ${percentage}%; background: ${s.color}; transition: width 0.5s;"></div>
                </div>
                <div style="font-size: 10px; color: var(--text-muted);">${t(s.labelKey)}</div>
                <div style="font-size: 11px; font-weight: 600; color: ${s.color};">${percentage}%</div>
            </div>
        `;
        }).join('');
    }

    function renderScheduleBarChart() {
        const container = document.getElementById('schedule-bar-chart');
        if (!container) return;

        const types = [
            { key: 'mwt', labelKey: 'mwtShort', color: '#3498db' },
            { key: 'hse', labelKey: 'hseShort', color: '#9b59b6' },
            { key: 'csms', labelKey: 'csmsShort', color: '#27ae60' },
            { key: 'hseplan', labelKey: 'hsePlanShort', color: '#e67e22' },
            { key: 'spr', labelKey: 'sprShort', color: '#1abc9c' },
            { key: 'hazid', labelKey: 'hazidShort', color: '#e74c3c' }
        ];

        const counts = types.map(t => ({
            ...t,
            count: allSchedules.filter(s => s.schedule_type === t.key).length
        }));

        const maxCount = Math.max(...counts.map(c => c.count), 1);

        container.innerHTML = counts.map(item => `
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                <div style="font-size: 11px; font-weight: 600; color: ${item.color}; margin-bottom: 4px;">${item.count}</div>
                <div style="width: 100%; max-width: 40px; background: linear-gradient(180deg, ${item.color}, ${item.color}88); 
                     border-radius: 4px 4px 0 0; height: ${(item.count / maxCount) * 140}px; min-height: 8px; 
                     transition: height 0.5s; box-shadow: 0 2px 8px ${item.color}44;"></div>
                <div style="font-size: 9px; color: var(--text-muted); margin-top: 6px; text-align: center;">${t(item.labelKey)}</div>
            </div>
        `).join('');
    }

    function renderProgressAreaChart() {
        const container = document.getElementById('progress-area-chart');
        if (!container) return;

        const upcoming = allProjects.filter(p => p.status === 'Upcoming').length;
        const inProgress = allProjects.filter(p => p.status === 'InProgress').length;
        const completed = allProjects.filter(p => p.status === 'Completed').length;
        const total = allProjects.length || 1;

        const upcomingPct = (upcoming / total) * 100;
        const inProgressPct = (inProgress / total) * 100;
        const completedPct = (completed / total) * 100;

        container.innerHTML = `
            <div style="position: absolute; bottom: 0; left: 0; right: 0; display: flex; height: 100%;">
                <div style="flex: ${upcomingPct || 1}; background: linear-gradient(180deg, #F5A623 0%, rgba(245,166,35,0.2) 100%);
                     display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 8px;">
                    <div style="font-size: 18px; font-weight: 700; color: #F5A623;">${upcoming}</div>
                    <div style="font-size: 10px; color: var(--text-muted);">${t('upcoming')}</div>
                </div>
                <div style="flex: ${inProgressPct || 1}; background: linear-gradient(180deg, #46D369 0%, rgba(70,211,105,0.2) 100%);
                     display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 8px;">
                    <div style="font-size: 18px; font-weight: 700; color: #46D369;">${inProgress}</div>
                    <div style="font-size: 10px; color: var(--text-muted);">${t('inprogress')}</div>
                </div>
                <div style="flex: ${completedPct || 1}; background: linear-gradient(180deg, #4A90D9 0%, rgba(74,144,217,0.2) 100%);
                     display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 8px;">
                    <div style="font-size: 18px; font-weight: 700; color: #4A90D9;">${completed}</div>
                    <div style="font-size: 10px; color: var(--text-muted);">${t('completed')}</div>
                </div>
            </div>
        `;
    }

    function renderMonthlyTrendChart() {
        const container = document.getElementById('monthly-trend-chart');
        if (!container) return;

        // Get last 6 months with translation keys
        const monthKeys = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];
        const months = [];
        const today = new Date();
        for (let i = 5; i >= 0; i--) {
            const d = new Date(today.getFullYear(), today.getMonth() - i, 1);
            months.push({
                key: `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`,
                labelKey: monthKeys[d.getMonth()],
                count: 0
            });
        }

        // Count schedules per month
        allSchedules.forEach(s => {
            const dateFields = ['mwt_plan_date', 'hse_meeting_date', 'csms_pb_date', 'hseplan_date', 'spr_date', 'hazid_date'];
            for (const field of dateFields) {
                if (s[field]) {
                    const d = new Date(s[field]);
                    const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
                    const month = months.find(m => m.key === key);
                    if (month) month.count++;
                    break;
                }
            }
        });

        const maxCount = Math.max(...months.map(m => m.count), 1);

        container.innerHTML = months.map((m, i) => `
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;">
                <div style="width: 100%; height: ${(m.count / maxCount) * 70}px; min-height: 4px;
                     background: linear-gradient(180deg, var(--netflix-red), var(--netflix-red-dark));
                     border-radius: 3px; transition: height 0.5s;"></div>
                <div style="font-size: 8px; color: var(--text-muted); margin-top: 4px;">${t(m.labelKey)}</div>
                <div style="font-size: 10px; font-weight: 600; color: var(--netflix-red);">${m.count}</div>
            </div>
        `).join('');
    }

    function createDonutChart(chartId, legendId, data, colors, total) {
        const chartEl = document.getElementById(chartId);
        const legendEl = document.getElementById(legendId);

        if (!chartEl || !legendEl) return;

        // Create SVG donut chart
        let offset = 0;
        const segments = [];
        const radius = 45;
        const circumference = 2 * Math.PI * radius;

        Object.entries(data).forEach(([key, value]) => {
            if (value > 0) {
                const percentage = (value / Math.max(total, 1)) * 100;
                const dashLength = (percentage / 100) * circumference;
                segments.push({
                    key,
                    value,
                    percentage,
                    dashLength,
                    dashOffset: offset,
                    color: colors[key] || '#666'
                });
                offset += dashLength;
            }
        });

        const svgSegments = segments.map(s => `
                <circle cx="60" cy="60" r="${radius}" fill="none" stroke="${s.color}" 
                        stroke-width="15" stroke-dasharray="${s.dashLength} ${circumference}" 
                        stroke-dashoffset="-${s.dashOffset}" 
                        style="transition: stroke-dasharray 0.5s, stroke-dashoffset 0.5s;"/>
            `).join('');

        chartEl.innerHTML = `
                <svg viewBox="0 0 120 120" style="width: 100%; height: 100%;">
                    <circle cx="60" cy="60" r="${radius}" fill="none" stroke="var(--bg-tertiary)" stroke-width="15"/>
                    ${svgSegments}
                    <text x="60" y="60" text-anchor="middle" dominant-baseline="middle" 
                          fill="var(--text-primary)" font-size="16" font-weight="bold">${total}</text>
                    <text x="60" y="75" text-anchor="middle" dominant-baseline="middle" 
                          fill="var(--text-muted)" font-size="8">TOTAL</text>
                </svg>
            `;

        legendEl.innerHTML = segments.map(s => `
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <div style="width: 12px; height: 12px; border-radius: 3px; background: ${s.color};"></div>
                    <span style="font-size: 13px; flex: 1;">${t(s.key.toLowerCase().replace(' ', '')) || s.key}</span>
                    <span style="font-size: 13px; font-weight: 600;">${s.value}</span>
                </div>
            `).join('');
    }

    async function checkReminders() {
        try {
            const res = await fetch(`${API_BASE}/check-reminders`);
            if (res.ok) {
                const result = await res.json();
                if (result.reminders_sent > 0) {
                    showToast(`${result.reminders_sent} reminder(s) sent!`, 'success');
                } else {
                    showToast('All projects on track - no reminders needed.', 'success');
                }
            }
        } catch (error) {
            showToast('Error checking reminders', 'error');
        }
    }

    // Keep old function for compatibility
    function updateStatistics() {
        loadDashboardStats();
    }

    // ===== DOWNLOAD REPORT =====
    function downloadReport() {
        showDownloadModal();
    }

    function showDownloadModal() {
        document.getElementById('download-modal').classList.add('active');
        document.getElementById('download-search').value = '';
        document.getElementById('download-loading').style.display = 'none';
        document.getElementById('download-project-list').style.display = 'block';
        renderDownloadProjects();
    }

    function closeDownloadModal() {
        document.getElementById('download-modal').classList.remove('active');
    }

    function renderDownloadProjects(filter = '') {
        const container = document.getElementById('download-project-list');
        const filtered = filter
            ? allProjects.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()) ||
                (p.well && p.well.toLowerCase().includes(filter.toLowerCase())))
            : allProjects;

        if (filtered.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No projects found</p>';
            return;
        }

        container.innerHTML = filtered.map(p => {
            const projectTasks = allTasks.filter(t => t.project_id === p.id);
            const tasksWithAttachments = projectTasks.filter(t => t.attachments && t.attachments.length > 0);
            const totalAttachments = projectTasks.reduce((sum, t) => sum + (t.attachments ? t.attachments.length : 0), 0);

            return `
                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; margin-bottom: 12px; 
                                border-left: 3px solid ${p.status === 'Completed' ? 'var(--success)' : 'var(--netflix-red)'};">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px;">${p.name}</div>
                                ${p.well ? `<div style="font-size: 13px; color: var(--text-secondary);">Well: ${p.well}</div>` : ''}
                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                                    üìé ${totalAttachments} attachment${totalAttachments !== 1 ? 's' : ''} 
                                    ‚Ä¢ ${tasksWithAttachments.length}/${projectTasks.length} tasks with files
                                </div>
                            </div>
                            <div>
                                <span class="project-card-badge badge-${p.status?.toLowerCase() || 'upcoming'}" style="font-size: 10px;">
                                    ${p.status || 'Upcoming'}
                                </span>
                            </div>
                        </div>
                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px; margin-top: 12px;">
                            <button onclick="previewProjectReport('${p.id}')" 
                                    style="flex: 1; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); 
                                           border-radius: 6px; color: var(--text-primary); cursor: pointer; font-size: 13px;
                                           transition: all 0.2s;"
                                    onmouseover="this.style.borderColor='var(--netflix-red)'"
                                    onmouseout="this.style.borderColor='var(--border)'">
                                üëÅÔ∏è Preview
                            </button>
                            <button onclick="downloadProjectReport('${p.id}')" 
                                    style="flex: 1; padding: 10px; background: var(--netflix-red); border: none; 
                                           border-radius: 6px; color: white; cursor: pointer; font-size: 13px;
                                           transition: all 0.2s;"
                                    onmouseover="this.style.background='var(--netflix-red-dark)'"
                                    onmouseout="this.style.background='var(--netflix-red)'">
                                üì• Download
                            </button>
                        </div>
                    </div>
                `;
        }).join('');
    }

    function filterDownloadProjects() {
        const search = document.getElementById('download-search').value;
        renderDownloadProjects(search);
    }

    async function downloadProjectReport(projectId) {
        const project = allProjects.find(p => p.id === projectId);
        if (!project) return;

        const projectTasks = allTasks.filter(t => t.project_id === projectId);
        const totalAttachments = projectTasks.reduce((sum, t) => sum + (t.attachments ? t.attachments.length : 0), 0);

        if (totalAttachments === 0) {
            showToast('This project has no attachments to compile into a report.', 'error');
            return;
        }

        // Show loading
        document.getElementById('download-project-list').style.display = 'none';
        document.getElementById('download-loading').style.display = 'block';

        try {
            const res = await fetch(`${API_BASE}/projects/${projectId}/report?mode=download`, {
                method: 'GET'
            });

            if (res.ok) {
                const wellName = (project.well_name || project.well || '').replace(/[^a-zA-Z0-9]/g, '_');
                const projectName = project.name.replace(/[^a-zA-Z0-9]/g, '_');
                const filename = `CSMSREPORT_${projectName}_${wellName}.pdf`;

                // Check if running in mobile WebView or Android browser
                const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

                if (window.ReactNativeWebView) {
                    // Running in React Native WebView - send to native handler
                    const blob = await res.blob();
                    const reader = new FileReader();
                    reader.onloadend = function () {
                        window.ReactNativeWebView.postMessage(JSON.stringify({
                            type: 'downloadPDF',
                            data: reader.result,
                            filename: filename
                        }));
                    };
                    reader.readAsDataURL(blob);
                    closeDownloadModal();
                    showToast('Report sent to download!', 'success');
                } else if (isMobile) {
                    // Mobile browser - use direct download link
                    // Create an iframe to trigger download without navigating away
                    closeDownloadModal();

                    const downloadUrl = `${API_BASE}/projects/${projectId}/report?mode=download`;

                    // Method 1: Use hidden iframe for download
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = downloadUrl;
                    document.body.appendChild(iframe);

                    // Show confirmation
                    setTimeout(() => {
                        showToast('Download started! Check your Downloads folder.', 'success');
                        // Clean up iframe after delay
                        setTimeout(() => document.body.removeChild(iframe), 5000);
                    }, 1000);
                } else {
                    // Desktop browser - use standard blob download
                    const blob = await res.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    closeDownloadModal();
                    showToast('Report downloaded successfully!', 'success');
                }
            } else {
                const error = await res.json();
                showToast(error.detail || 'Failed to generate report', 'error');
                document.getElementById('download-project-list').style.display = 'block';
                document.getElementById('download-loading').style.display = 'none';
            }
        } catch (error) {
            console.error('Download error:', error);
            showToast('Error generating report. Please try again.', 'error');
            document.getElementById('download-project-list').style.display = 'block';
            document.getElementById('download-loading').style.display = 'none';
        }
    }

    async function previewProjectReport(projectId) {
        const project = allProjects.find(p => p.id === projectId);
        if (!project) return;

        // Show loading
        document.getElementById('download-project-list').style.display = 'none';
        document.getElementById('download-loading').style.display = 'block';
        document.getElementById('download-loading').innerHTML = `
                <div style="font-size: 24px; margin-bottom: 10px;">üëÅÔ∏è</div>
                <p style="color: var(--netflix-red);">Generating Preview...</p>
                <p style="font-size: 12px; color: var(--text-muted);">Embedding attachments, please wait</p>
            `;

        try {
            const res = await fetch(`${API_BASE}/projects/${projectId}/report?mode=preview`, {
                method: 'GET'
            });

            if (res.ok) {
                // Open PDF in new tab
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                window.open(url, '_blank');

                // Reset modal
                document.getElementById('download-project-list').style.display = 'block';
                document.getElementById('download-loading').style.display = 'none';
                document.getElementById('download-loading').innerHTML = `
                        <div style="font-size: 24px; margin-bottom: 10px;">üìÑ</div>
                        <p style="color: var(--netflix-red);">Generating PDF Report...</p>
                        <p style="font-size: 12px; color: var(--text-muted);">This may take a moment</p>
                    `;
            } else {
                const error = await res.json();
                showToast(error.detail || 'Failed to generate preview', 'error');
                document.getElementById('download-project-list').style.display = 'block';
                document.getElementById('download-loading').style.display = 'none';
            }
        } catch (error) {
            console.error('Preview error:', error);
            showToast('Error generating preview. Please try again.', 'error');
            document.getElementById('download-project-list').style.display = 'block';
            document.getElementById('download-loading').style.display = 'none';
        }
    }

    // ===== SCHEDULES =====
    let allSchedules = [];

    async function loadSchedules() {
        try {
            const res = await fetch(`${API_BASE}/schedules`);
            if (res.ok) {
                allSchedules = await res.json();
                renderScheduleCalendars();
                renderUpcomingSchedules(); // Render all schedules list
                renderCalendar(); // Update home calendar
            }
        } catch (error) {
            console.error('Error loading schedules:', error);
        }
    }

    function renderUpcomingSchedules() {
        const container = document.getElementById('upcoming-schedules-list');
        if (!container) return;

        const typeConfig = {
            mwt: { label: 'üìÖ MWT Plan', field: 'mwt_plan_date', color: '#3498db' },
            hse: { label: 'üè¢ HSE Committee', field: 'hse_meeting_date', color: '#9b59b6' },
            csms: { label: '‚úÖ CSMS PB Audit', field: 'csms_pb_date', color: '#27ae60' },
            hseplan: { label: 'üìã HSE Plan Meeting', field: 'hseplan_date', color: '#e67e22' },
            spr: { label: 'üìä SPR Meeting', field: 'spr_date', color: '#1abc9c' },
            hazid: { label: '‚ö†Ô∏è HAZID/HAZOP', field: 'hazid_date', color: '#e74c3c' }
        };

        if (allSchedules.length === 0) {
            container.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No schedules created yet</p>';
            return;
        }

        // Group schedules by type
        const grouped = {};
        allSchedules.forEach(s => {
            const type = s.schedule_type || 'mwt';
            if (!grouped[type]) grouped[type] = [];
            grouped[type].push(s);
        });

        let html = '';
        Object.keys(typeConfig).forEach(type => {
            const config = typeConfig[type];
            const schedules = grouped[type] || [];
            if (schedules.length > 0) {
                html += `<div style="margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="background: ${config.color}; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px;">${config.label}</span>
                        <span style="color: var(--text-muted); font-size: 12px;">(${schedules.length})</span>
                    </div>`;
                schedules.forEach(s => {
                    const date = s[config.field] || s.mwt_plan_date || s.hse_meeting_date || s.csms_pb_date;
                    const formattedDate = date ? new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'No date';
                    html += `<div style="background: var(--bg-tertiary); padding: 10px 12px; border-radius: 8px; margin-bottom: 6px; border-left: 3px solid ${config.color};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: var(--text-primary); font-size: 13px;">${s.project_name || 'Unknown Project'}</strong>
                                <div style="color: var(--text-muted); font-size: 11px;">${s.well_name || ''}</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="text-align: right;">
                                    <div style="color: ${config.color}; font-size: 12px; font-weight: 600;">${formattedDate}</div>
                                    <div style="color: var(--text-muted); font-size: 10px;">${s.pic_name || ''}</div>
                                </div>
                                <button class="delete-btn admin-only" onclick="event.stopPropagation(); deleteSchedule('${s.id}')" style="padding: 4px 8px; font-size: 10px;">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>`;
                });
                html += '</div>';
            }
        });

        container.innerHTML = html || '<p style="color: var(--text-muted); text-align: center;">No schedules created yet</p>';
    }

    function populateProjectDropdown() {
        const select = document.getElementById('schedule-project-select');
        if (!select) return;

        // Clear existing options except first
        select.innerHTML = '<option value="">Select a project</option>';

        // Add projects
        allProjects.forEach(p => {
            const option = document.createElement('option');
            option.value = p.id;
            option.textContent = p.name;
            option.dataset.projectName = p.name;
            select.appendChild(option);
        });
    }

    async function createSchedule() {
        const form = document.getElementById('schedule-form');
        const selectEl = document.getElementById('schedule-project-select');
        const selectedOption = selectEl.options[selectEl.selectedIndex];
        const scheduleType = document.getElementById('schedule-type-input').value;

        // Validate required fields
        if (!form.project_id.value) {
            showToast('Please select a project', 'error');
            return;
        }
        if (!form.well_name.value) {
            showToast('Please enter well name', 'error');
            return;
        }
        if (!form.pic_name.value) {
            showToast('Please enter PIC name', 'error');
            return;
        }
        if (!form.assigned_to_email.value) {
            showToast('Please enter email', 'error');
            return;
        }

        // Date field mapping
        const dateFieldMap = {
            mwt: { field: 'mwt_plan_date', label: 'MWT Plan Date' },
            hse: { field: 'hse_meeting_date', label: 'HSE Committee Meeting Date' },
            csms: { field: 'csms_pb_date', label: 'CSMS PB Audit Date' },
            hseplan: { field: 'hseplan_date', label: 'HSE Plan Meeting Date' },
            spr: { field: 'spr_date', label: 'SPR Meeting Date' },
            hazid: { field: 'hazid_date', label: 'HAZID/HAZOP Meeting Date' }
        };

        // Validate the selected date field
        const dateConfig = dateFieldMap[scheduleType];
        if (dateConfig && !form[dateConfig.field]?.value) {
            showToast(`Please select ${dateConfig.label}`, 'error');
            return;
        }

        const data = {
            project_id: form.project_id.value,
            project_name: selectedOption.dataset.projectName || selectedOption.text,
            well_name: form.well_name.value,
            schedule_type: scheduleType,
            mwt_plan_date: form.mwt_plan_date?.value || null,
            hse_meeting_date: form.hse_meeting_date?.value || null,
            csms_pb_date: form.csms_pb_date?.value || null,
            hseplan_date: form.hseplan_date?.value || null,
            spr_date: form.spr_date?.value || null,
            hazid_date: form.hazid_date?.value || null,
            pic_name: form.pic_name.value,
            assigned_to_email: form.assigned_to_email.value
        };

        // Get the schedule type label for the success message
        const typeLabels = {
            mwt: 'MWT Plan',
            hse: 'HSE Committee Meeting',
            csms: 'CSMS PB Audit',
            hseplan: 'HSE Plan Meeting',
            spr: 'SPR Meeting',
            hazid: 'HAZID/HAZOP Meeting'
        };
        const typeLabel = typeLabels[scheduleType] || scheduleType;

        try {
            const res = await fetch(`${API_BASE}/schedules`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                showToast(`${typeLabel} schedule created successfully!`, 'success');
                form.reset();
                form.pic_name.value = 'ADE';
                // Reset to MWT type
                selectScheduleType('mwt');
                await loadSchedules(); // Wait for schedules to reload
                renderUpcomingSchedules(); // Update upcoming schedules list
                updateStatistics(); // Refresh statistics dashboard
                renderMeetingCalendar(); // Refresh Meeting Calendar
            } else {
                showToast('Error creating schedule', 'error');
            }
        } catch (error) {
            showToast('Error connecting to server', 'error');
        }
    }
    let mwtMonthFilter = 'all';
    let hseMonthFilter = 'all';

    function getUpcoming3Months() {
        const months = [];
        const today = new Date();
        for (let i = 0; i < 3; i++) {
            const date = new Date(today.getFullYear(), today.getMonth() + i, 1);
            months.push({
                key: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`,
                label: date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })
            });
        }
        return months;
    }

    function filterByMonth(schedules, dateField, monthKey) {
        const today = new Date();
        const threeMonthsLater = new Date(today.getFullYear(), today.getMonth() + 3, 0);

        // First filter to upcoming 3 months only
        let filtered = schedules.filter(s => {
            const date = new Date(s[dateField]);
            return date >= today && date <= threeMonthsLater;
        });

        // Then filter by specific month if not 'all'
        if (monthKey !== 'all') {
            filtered = filtered.filter(s => {
                const date = new Date(s[dateField]);
                const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                return key === monthKey;
            });
        }

        return filtered.sort((a, b) => new Date(a[dateField]) - new Date(b[dateField]));
    }

    function renderMonthFilters() {
        const months = getUpcoming3Months();
        const mwtFilterContainer = document.getElementById('mwt-month-filter');
        const hseFilterContainer = document.getElementById('hse-month-filter');

        if (!mwtFilterContainer || !hseFilterContainer) return;

        const createFilterButtons = (container, type, currentFilter) => {
            container.innerHTML = `
                    <div class="status-dot ${currentFilter === 'all' ? 'active' : ''}" 
                         onclick="${type}MonthFilter = 'all'; renderScheduleCalendars();" 
                         style="cursor: pointer;">All</div>
                    ${months.map(m => `
                        <div class="status-dot ${currentFilter === m.key ? 'active' : ''}" 
                             onclick="${type}MonthFilter = '${m.key}'; renderScheduleCalendars();"
                             style="cursor: pointer;">${m.label}</div>
                    `).join('')}
                `;
        };

        createFilterButtons(mwtFilterContainer, 'mwt', mwtMonthFilter);
        createFilterButtons(hseFilterContainer, 'hse', hseMonthFilter);
    }

    function renderScheduleCalendars() {
        const mwtContainer = document.getElementById('mwt-calendar');
        const hseContainer = document.getElementById('hse-calendar');

        if (!mwtContainer || !hseContainer) return;

        // Render month filters
        renderMonthFilters();

        // Filter MWT schedules (3 months + month filter)
        const mwtFiltered = filterByMonth(allSchedules, 'mwt_plan_date', mwtMonthFilter);

        // MWT Calendar
        if (mwtFiltered.length === 0) {
            mwtContainer.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No schedules in selected period</p>';
        } else {
            mwtContainer.innerHTML = mwtFiltered.map(s => `
                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 3px solid var(--netflix-red);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">${s.project_name}</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">${s.well_name}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: var(--netflix-red); padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${formatDate(s.mwt_plan_date)}
                                </div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">PIC: ${s.pic_name}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
        }

        // Filter HSE schedules (3 months + month filter)
        const hseFiltered = filterByMonth(allSchedules, 'hse_meeting_date', hseMonthFilter);

        // HSE Calendar
        if (hseFiltered.length === 0) {
            hseContainer.innerHTML = '<p style="color: var(--text-muted); text-align: center;">No schedules in selected period</p>';
        } else {
            hseContainer.innerHTML = hseFiltered.map(s => `
                    <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 3px solid var(--success);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600;">${s.project_name}</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">${s.well_name}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: var(--success); padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                    ${formatDate(s.hse_meeting_date)}
                                </div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">PIC: ${s.pic_name}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
        }
    }

    function formatDate(dateStr) {
        if (!dateStr) return 'N/A';
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    // ===== Related Docs Functions =====
    function populateDocProjectDropdown() {
        const select = document.getElementById('doc-project-select');
        select.innerHTML = '<option value="">Select Project</option>' +
            allProjects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    }

    function onDocProjectChange(projectId) {
        const project = allProjects.find(p => p.id === projectId);
        document.getElementById('doc-well-name').value = project ? (project.well_name || project.well || '') : '';
    }

    async function submitRelatedDoc() {
        const form = document.getElementById('related-doc-form');
        const projectId = form.project_id.value;
        const docName = form.doc_name.value;
        const fileInput = document.getElementById('doc-file');

        if (!projectId || !docName || fileInput.files.length === 0) {
            showToast('Please fill all required fields and select a file', 'error');
            return;
        }

        try {
            const formData = new FormData();
            formData.append('project_id', projectId);
            formData.append('well_name', form.well_name.value || '');
            formData.append('doc_name', docName);
            formData.append('file', fileInput.files[0]);

            const res = await fetch(`${API_BASE}/related-docs`, {
                method: 'POST',
                body: formData
            });

            if (res.ok) {
                showToast('Document uploaded successfully!', 'success');
                form.reset();
                document.getElementById('doc-file-name').textContent = 'No file selected';
                loadRelatedDocs();
            } else {
                showToast('Failed to upload document', 'error');
            }
        } catch (error) {
            console.error('Error uploading document:', error);
            showToast('Error uploading document', 'error');
        }
    }

    async function loadRelatedDocs() {
        try {
            const res = await fetch(`${API_BASE}/related-docs`);
            if (res.ok) {
                const docs = await res.json();
                renderRelatedDocs(docs);
            }
        } catch (error) {
            console.error('Error loading related docs:', error);
        }
    }

    function renderRelatedDocs(docs) {
        const container = document.getElementById('related-docs-list');
        if (docs.length === 0) {
            container.innerHTML = '<div style="text-align: center; color: var(--text-muted); padding: 20px;">No documents uploaded yet</div>';
            return;
        }

        container.innerHTML = docs.map(d => {
            const project = allProjects.find(p => p.id === d.project_id) || {};
            const downloadUrl = `${API_BASE}/download/${d.drive_file_id}`;
            return `
                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">üìÑ ${d.doc_name}</div>
                        <div style="font-size: 12px; color: var(--text-muted);">
                            ${project.name || 'Unknown'} ‚Ä¢ ${d.filename}
                        </div>
                    </div>
                    <button onclick="triggerFileDownload('${downloadUrl}', '${d.doc_name}')" 
                       style="background: var(--netflix-red); color: white; padding: 6px 12px; border-radius: 6px; border: none; font-size: 12px; cursor: pointer;">
                        Download
                    </button>
                </div>
            `;
        }).join('');
    }

    // Update file name display when file is selected
    function updateDocFileName(input) {
        const fileNameSpan = document.getElementById('doc-file-name');
        if (input.files && input.files.length > 0) {
            fileNameSpan.textContent = input.files[0].name;
            fileNameSpan.style.color = 'var(--success)';
        } else {
            fileNameSpan.textContent = 'No file selected';
            fileNameSpan.style.color = 'var(--text-muted)';
        }
    }

    // Trigger file download - works on both web and mobile
    function triggerFileDownload(url, filename) {
        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

        // Check if running in mobile app WebView (React Native)
        if (window.ReactNativeWebView) {
            // Send message to React Native to handle download
            window.ReactNativeWebView.postMessage(JSON.stringify({
                type: 'download',
                url: url,
                filename: filename
            }));
            showToast('Preparing download...', 'info');
        } else if (isMobile) {
            // Mobile browser - use iframe for download
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = url;
            document.body.appendChild(iframe);

            showToast('Download started! Check your Downloads folder.', 'success');

            // Clean up iframe after delay
            setTimeout(() => document.body.removeChild(iframe), 10000);
        } else {
            // Desktop browser - open in new tab or trigger download
            const link = document.createElement('a');
            link.href = url;
            link.target = '_blank';
            link.download = filename || 'download';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('Download started', 'success');
        }
    }

    // Schedule type selection
    function selectScheduleType(type) {
        // Update hidden input
        document.getElementById('schedule-type-input').value = type;

        // Update chip styles
        document.querySelectorAll('.schedule-type-chip').forEach(chip => {
            chip.classList.remove('active');
            if (chip.dataset.type === type) {
                chip.classList.add('active');
            }
        });

        // Show/hide date fields - hide all first
        const dateGroups = ['mwt', 'hse', 'csms', 'hseplan', 'spr', 'hazid'];
        dateGroups.forEach(t => {
            const el = document.getElementById(`${t}-date-group`);
            if (el) el.style.display = t === type ? 'block' : 'none';
        });
    }

    // ===== CALENDAR =====
    let calendarDate = new Date();

    function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        const titleEl = document.getElementById('calendar-month-title');
        if (!grid || !titleEl) return;

        const year = calendarDate.getFullYear();
        const month = calendarDate.getMonth();

        // Set title
        titleEl.textContent = calendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

        // Get first day and days in month
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date();

        // Build events map for this month
        const eventsMap = {};

        // Add projects (rig_down date)
        allProjects.forEach(p => {
            if (p.rig_down) {
                const d = new Date(p.rig_down);
                if (d.getMonth() === month && d.getFullYear() === year) {
                    const key = d.getDate();
                    if (!eventsMap[key]) eventsMap[key] = [];
                    eventsMap[key].push({ type: 'project', id: p.id, name: p.name, color: 'var(--netflix-red)' });
                }
            }
        });

        // Add schedules
        allSchedules.forEach(s => {
            // MWT
            if (s.mwt_plan_date) {
                const d = new Date(s.mwt_plan_date);
                if (d.getMonth() === month && d.getFullYear() === year) {
                    const key = d.getDate();
                    if (!eventsMap[key]) eventsMap[key] = [];
                    eventsMap[key].push({ type: 'mwt', id: s.id, name: s.project_name + ' (MWT)', color: '#4A90D9' });
                }
            }
            // HSE
            if (s.hse_meeting_date) {
                const d = new Date(s.hse_meeting_date);
                if (d.getMonth() === month && d.getFullYear() === year) {
                    const key = d.getDate();
                    if (!eventsMap[key]) eventsMap[key] = [];
                    eventsMap[key].push({ type: 'hse', id: s.id, name: s.project_name + ' (HSE)', color: '#46D369' });
                }
            }
            // CSMS PB
            if (s.csms_pb_date) {
                const d = new Date(s.csms_pb_date);
                if (d.getMonth() === month && d.getFullYear() === year) {
                    const key = d.getDate();
                    if (!eventsMap[key]) eventsMap[key] = [];
                    eventsMap[key].push({ type: 'csms', id: s.id, name: s.project_name + ' (CSMS PB)', color: '#F5A623' });
                }
            }
        });

        // Render grid
        let html = '';

        // Empty cells for days before first of month
        for (let i = 0; i < firstDay; i++) {
            html += '<div style="padding: 8px; text-align: center;"></div>';
        }

        // Days
        for (let day = 1; day <= daysInMonth; day++) {
            const events = eventsMap[day] || [];
            const isToday = today.getDate() === day && today.getMonth() === month && today.getFullYear() === year;
            const hasEvents = events.length > 0;

            let dayStyle = `
                padding: 6px 2px;
                text-align: center;
                border-radius: 8px;
                font-size: 13px;
                cursor: ${hasEvents ? 'pointer' : 'default'};
                position: relative;
                background: ${isToday ? 'var(--netflix-red)' : hasEvents ? 'var(--bg-tertiary)' : 'transparent'};
                color: ${isToday ? 'white' : 'var(--text-primary)'};
                transition: all 0.2s;
            `;

            // Event dots
            let dotsHtml = '';
            if (events.length > 0) {
                dotsHtml = '<div style="display: flex; justify-content: center; gap: 2px; margin-top: 2px;">';
                events.slice(0, 4).forEach(e => {
                    dotsHtml += `<span style="width: 5px; height: 5px; background: ${e.color}; border-radius: 50%;"></span>`;
                });
                dotsHtml += '</div>';
            }

            const eventsJson = JSON.stringify(events).replace(/"/g, '&quot;');
            html += `
                <div style="${dayStyle}" 
                     ${hasEvents ? `onclick="showCalendarEvents(${day}, '${eventsJson}')"` : ''}
                     ${hasEvents ? `onmouseover="this.style.transform='scale(1.1)'"` : ''}
                     ${hasEvents ? `onmouseout="this.style.transform='scale(1)'"` : ''}>
                    ${day}
                    ${dotsHtml}
                </div>
            `;
        }

        grid.innerHTML = html;
    }

    function changeCalendarMonth(delta) {
        calendarDate.setMonth(calendarDate.getMonth() + delta);
        renderCalendar();
    }

    // ===== MEETING CALENDAR =====
    let meetingCalendarDate = new Date();
    let meetingCalendarView = 'weekly'; // 'weekly' or 'monthly'

    function setMeetingCalendarView(view) {
        meetingCalendarView = view;
        // Update button styles
        const weeklyBtn = document.getElementById('meeting-weekly-btn');
        const monthlyBtn = document.getElementById('meeting-monthly-btn');
        if (weeklyBtn && monthlyBtn) {
            if (view === 'weekly') {
                weeklyBtn.style.background = 'var(--netflix-red)';
                weeklyBtn.style.color = 'white';
                weeklyBtn.style.border = 'none';
                monthlyBtn.style.background = 'var(--bg-tertiary)';
                monthlyBtn.style.color = 'var(--text-primary)';
                monthlyBtn.style.border = '1px solid var(--border)';
            } else {
                monthlyBtn.style.background = 'var(--netflix-red)';
                monthlyBtn.style.color = 'white';
                monthlyBtn.style.border = 'none';
                weeklyBtn.style.background = 'var(--bg-tertiary)';
                weeklyBtn.style.color = 'var(--text-primary)';
                weeklyBtn.style.border = '1px solid var(--border)';
            }
        }
        renderMeetingCalendar();
    }

    function renderMeetingCalendar() {
        const grid = document.getElementById('meeting-calendar-grid');
        const titleEl = document.getElementById('meeting-calendar-month-title');
        if (!grid || !titleEl) return;

        // Schedule type config
        const typeColors = {
            mwt: '#3498db', hse: '#9b59b6', csms: '#27ae60',
            hseplan: '#e67e22', spr: '#1abc9c', hazid: '#e74c3c'
        };
        const typeLabels = {
            mwt: 'MWT', hse: 'HSE', csms: 'CSMS PB',
            hseplan: 'HSE Plan', spr: 'SPR', hazid: 'HAZID'
        };
        const typeFields = {
            mwt: 'mwt_plan_date', hse: 'hse_meeting_date', csms: 'csms_pb_date',
            hseplan: 'hseplan_date', spr: 'spr_date', hazid: 'hazid_date'
        };

        const renderMeetingCard = (s, dateStr) => {
            const type = s.schedule_type || 'mwt';
            const field = typeFields[type];
            if (s[field] === dateStr) {
                const name = s.well || s.project_name || typeLabels[type];
                const pic = s.pic_name || 'N/A';
                return `<div onclick="navigateTo('schedule')" 
                     style="background: ${typeColors[type]}22; border-left: 3px solid ${typeColors[type]}; 
                            padding: 4px 6px; margin: 2px 0; border-radius: 4px; cursor: pointer; font-size: 9px;">
                    <div style="font-weight: 600; color: ${typeColors[type]}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${name}</div>
                    <div style="color: var(--text-muted); font-size: 8px;">${typeLabels[type]} ‚Ä¢ ${pic}</div>
                </div>`;
            }
            return '';
        };

        // Render task card for tasks with implementation_date
        const renderTaskCard = (task, dateStr) => {
            if (task.implementation_date === dateStr) {
                const statusColor = task.status === 'Completed' ? '#27ae60' : (task.status === 'In Progress' ? '#f39c12' : '#3498db');
                const name = task.title || task.code || 'Task';
                const pic = task.pic_name || 'N/A';
                return `<div onclick="showTaskDetail('${task.id}')" 
                     style="background: ${statusColor}22; border-left: 3px solid ${statusColor}; 
                            padding: 4px 6px; margin: 2px 0; border-radius: 4px; cursor: pointer; font-size: 9px;">
                    <div style="font-weight: 600; color: ${statusColor}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${name.substring(0, 20)}</div>
                    <div style="color: var(--text-muted); font-size: 8px;">üìã ${task.code || ''} ‚Ä¢ ${pic}</div>
                </div>`;
            }
            return '';
        };

        let html = '';

        if (meetingCalendarView === 'weekly') {
            // WEEKLY VIEW
            const weekStart = new Date(meetingCalendarDate);
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            titleEl.textContent = `${weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${weekEnd.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;

            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(weekStart);
                currentDay.setDate(currentDay.getDate() + i);
                const dateStr = `${currentDay.getFullYear()}-${String(currentDay.getMonth() + 1).padStart(2, '0')}-${String(currentDay.getDate()).padStart(2, '0')}`;
                const isToday = new Date().toDateString() === currentDay.toDateString();
                const dayName = currentDay.toLocaleDateString('en-US', { weekday: 'short' });

                let meetings = '';
                allSchedules.forEach(s => { meetings += renderMeetingCard(s, dateStr); });
                allTasks.forEach(t => { meetings += renderTaskCard(t, dateStr); });

                html += `
                    <div style="background: ${isToday ? 'rgba(229, 9, 20, 0.15)' : 'var(--bg-tertiary)'}; 
                         border-radius: 8px; padding: 6px; min-height: 80px; ${isToday ? 'border: 2px solid var(--netflix-red);' : 'border: 1px solid var(--border);'}">
                        <div style="text-align: center; margin-bottom: 4px;">
                            <div style="font-size: 10px; color: var(--text-muted);">${dayName}</div>
                            <div style="font-size: 14px; font-weight: ${isToday ? '700' : '600'}; color: ${isToday ? 'var(--netflix-red)' : 'var(--text-primary)'};">${currentDay.getDate()}</div>
                        </div>
                        <div style="max-height: 120px; overflow-y: auto;">${meetings || '<div style="font-size: 9px; color: var(--text-muted); text-align: center;">-</div>'}</div>
                    </div>
                `;
            }
        } else {
            // MONTHLY VIEW
            const year = meetingCalendarDate.getFullYear();
            const month = meetingCalendarDate.getMonth();
            titleEl.textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startingDay = firstDay.getDay();

            for (let i = 0; i < startingDay; i++) {
                html += '<div style="padding: 4px; min-height: 60px;"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();

                let meetings = '';
                allSchedules.forEach(s => { meetings += renderMeetingCard(s, dateStr); });
                allTasks.forEach(t => { meetings += renderTaskCard(t, dateStr); });

                html += `
                    <div style="background: ${isToday ? 'rgba(229, 9, 20, 0.15)' : 'var(--bg-tertiary)'}; 
                         border-radius: 6px; padding: 4px; min-height: 60px; ${isToday ? 'border: 2px solid var(--netflix-red);' : ''}">
                        <div style="font-size: 11px; font-weight: ${isToday ? '700' : '500'}; color: ${isToday ? 'var(--netflix-red)' : 'var(--text-primary)'}; text-align: center; margin-bottom: 2px;">${day}</div>
                        <div style="max-height: 80px; overflow-y: auto;">${meetings}</div>
                    </div>
                `;
            }
        }
        grid.innerHTML = html;
    }

    function changeMeetingCalendarMonth(delta) {
        if (meetingCalendarView === 'weekly') {
            meetingCalendarDate.setDate(meetingCalendarDate.getDate() + (delta * 7));
        } else {
            meetingCalendarDate.setMonth(meetingCalendarDate.getMonth() + delta);
        }
        renderMeetingCalendar();
    }

    // ===== PROJECT CALENDAR =====
    let projectCalendarDate = new Date();
    let projectCalendarView = 'weekly'; // 'weekly' or 'monthly'
    const projectColors = ['#e74c3c', '#3498db', '#27ae60', '#f1c40f', '#9b59b6', '#1abc9c', '#e67e22', '#34495e', '#16a085', '#c0392b'];

    function setProjectCalendarView(view) {
        projectCalendarView = view;
        const weeklyBtn = document.getElementById('project-weekly-btn');
        const monthlyBtn = document.getElementById('project-monthly-btn');
        if (weeklyBtn && monthlyBtn) {
            if (view === 'weekly') {
                weeklyBtn.style.background = 'var(--netflix-red)';
                weeklyBtn.style.color = 'white';
                weeklyBtn.style.border = 'none';
                monthlyBtn.style.background = 'var(--bg-tertiary)';
                monthlyBtn.style.color = 'var(--text-primary)';
                monthlyBtn.style.border = '1px solid var(--border)';
            } else {
                monthlyBtn.style.background = 'var(--netflix-red)';
                monthlyBtn.style.color = 'white';
                monthlyBtn.style.border = 'none';
                weeklyBtn.style.background = 'var(--bg-tertiary)';
                weeklyBtn.style.color = 'var(--text-primary)';
                weeklyBtn.style.border = '1px solid var(--border)';
            }
        }
        renderProjectCalendar();
    }

    function renderProjectCalendar() {
        const grid = document.getElementById('project-calendar-grid');
        const titleEl = document.getElementById('project-calendar-month-title');
        const legendEl = document.getElementById('project-calendar-legend');
        if (!grid || !titleEl) return;

        // Assign colors to projects
        const projectColorMap = {};
        allProjects.forEach((p, i) => {
            projectColorMap[p.id] = projectColors[i % projectColors.length];
        });

        let html = '';

        if (projectCalendarView === 'weekly') {
            // WEEKLY VIEW - Similar to Meeting Calendar but with spanning bars
            // Helper to format date as YYYY-MM-DD string
            const toDateStr = (d) => {
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const weekStart = new Date(projectCalendarDate);
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);

            // Generate array of date strings for this week
            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date(weekStart);
                d.setDate(d.getDate() + i);
                weekDates.push(toDateStr(d));
            }

            titleEl.textContent = `${weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${weekEnd.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;

            // Build day cells - output directly without wrapper (parent already has grid)
            html = '';

            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(weekStart);
                currentDay.setDate(currentDay.getDate() + i);
                const isToday = toDateStr(new Date()) === weekDates[i];

                // Build project cards for THIS day (stacked vertically in the cell)
                let dayCards = '';
                allProjects.forEach(p => {
                    const projStart = p.start_date ? String(p.start_date).split('T')[0] : null;
                    const projEnd = (p.rig_down_date || p.rig_down) ? String(p.rig_down_date || p.rig_down).split('T')[0] : null;

                    if (!projStart || !projEnd) return;

                    // Check if this day is within project range
                    if (weekDates[i] >= projStart && weekDates[i] <= projEnd) {
                        const color = projectColorMap[p.id];
                        const name = p.name || p.well || 'Project';
                        const well = p.well_name || p.well || p.name || '';

                        dayCards += `
                            <div onclick="navigateTo('projects')" 
                                 style="background: ${color}22; border-left: 3px solid ${color}; 
                                        padding: 4px 6px; margin: 2px 0; border-radius: 4px; cursor: pointer; font-size: 9px;">
                                <div style="font-weight: 600; color: ${color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${name}</div>
                                <div style="color: var(--text-muted); font-size: 8px;">${well}</div>
                            </div>`;
                    }
                });

                html += `
                    <div style="background: ${isToday ? 'rgba(229, 9, 20, 0.15)' : 'var(--bg-tertiary)'}; 
                         border-radius: 8px; padding: 6px; min-height: 80px; ${isToday ? 'border: 2px solid var(--netflix-red);' : 'border: 1px solid var(--border);'}">
                        <div style="text-align: center; margin-bottom: 4px;">
                            <div style="font-size: 16px; font-weight: ${isToday ? '700' : '600'}; color: ${isToday ? 'var(--netflix-red)' : 'var(--text-primary)'};">${currentDay.getDate()}</div>
                        </div>
                        <div style="max-height: 120px; overflow-y: auto;">${dayCards || '<div style="font-size: 9px; color: var(--text-muted); text-align: center;">-</div>'}</div>
                </div>
                `;
            }

            // Show project count
            const projectCount = allProjects.filter(p => {
                const s = p.start_date ? String(p.start_date).split('T')[0] : null;
                const e = (p.rig_down_date || p.rig_down) ? String(p.rig_down_date || p.rig_down).split('T')[0] : null;
                return s && e && !(e < weekDates[0] || s > weekDates[6]);
            }).length;

            if (projectCount === 0) {
                html += '<div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 12px;">No projects scheduled for this week</div>';
            }

        } else {
            // MONTHLY VIEW - output cells directly (parent already has grid)
            const year = projectCalendarDate.getFullYear();
            const month = projectCalendarDate.getMonth();
            titleEl.textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const startingDay = firstDay.getDay();

            // Output cells directly without wrapper
            html = '';

            for (let i = 0; i < startingDay; i++) {
                html += '<div style="padding: 4px; min-height: 60px;"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const currentDay = new Date(year, month, day);
                const isToday = new Date().toDateString() === currentDay.toDateString();

                let projectCards = '';
                allProjects.forEach(p => {
                    const startDate = p.start_date ? new Date(p.start_date) : null;
                    const endDate = (p.rig_down_date || p.rig_down) ? new Date(p.rig_down_date || p.rig_down) : null;
                    if (startDate && endDate && currentDay >= startDate && currentDay <= endDate) {
                        const color = projectColorMap[p.id];
                        const name = p.name || p.well || 'Project';
                        projectCards += `<div onclick="navigateTo('projects')" 
                             style="background: ${color}22; border-left: 3px solid ${color}; 
                                    padding: 2px 4px; margin: 1px 0; border-radius: 3px; cursor: pointer; font-size: 8px;">
                            <div style="font-weight: 600; color: ${color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${name}</div>
                        </div>`;
                    }
                });

                html += `
                    <div style="background: ${isToday ? 'rgba(229, 9, 20, 0.15)' : 'var(--bg-tertiary)'}; 
                         border-radius: 6px; padding: 4px; min-height: 60px; ${isToday ? 'border: 2px solid var(--netflix-red);' : ''}">
                        <div style="font-size: 11px; font-weight: ${isToday ? '700' : '500'}; color: ${isToday ? 'var(--netflix-red)' : 'var(--text-primary)'}; text-align: center; margin-bottom: 2px;">${day}</div>
                        <div style="max-height: 80px; overflow-y: auto;">${projectCards}</div>
                    </div>
                `;
            }
        }
        grid.innerHTML = html;

        // Render legend
        if (legendEl) {
            legendEl.innerHTML = allProjects.slice(0, 8).map(p => `
                <div onclick="navigateTo('projects')" style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <span style="width: 12px; height: 4px; background: ${projectColorMap[p.id]}; border-radius: 2px;"></span>
                    <span style="max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${p.name || p.well}">${(p.name || p.well || 'Project').substring(0, 12)}</span>
                </div>
            `).join('');
        }
    }

    function changeProjectCalendarMonth(delta) {
        if (projectCalendarView === 'weekly') {
            projectCalendarDate.setDate(projectCalendarDate.getDate() + (delta * 7));
        } else {
            projectCalendarDate.setMonth(projectCalendarDate.getMonth() + delta);
        }
        renderProjectCalendar();
    }

    function showCalendarEvents(day, eventsJson) {
        const events = JSON.parse(eventsJson.replace(/&quot;/g, '"'));

        if (events.length === 1) {
            // Navigate directly
            navigateToCalendarEvent(events[0]);
        } else {
            // Show selection
            const eventsList = events.map((e, i) => `${i + 1}. ${e.name}`).join('\n');
            const choice = prompt(`Events on day ${day}:\n\n${eventsList}\n\nEnter number to navigate:`);

            if (choice && events[parseInt(choice) - 1]) {
                navigateToCalendarEvent(events[parseInt(choice) - 1]);
            }
        }
    }

    function navigateToCalendarEvent(event) {
        if (event.type === 'project') {
            navigateTo('hse-programs');
            setTimeout(() => showProjectDetail(event.id), 300);
        } else if (event.type === 'mwt' || event.type === 'hse' || event.type === 'csms') {
            navigateTo('schedule');
        }
    }


    // ===== HSE KPI DASHBOARD =====
    let selectedKPIYear = 2025;

    const kpiData = {
        2021: { fatality: { kpi: 0, result: 0 }, trir: { kpi: 0, result: 0 }, pvir: { kpi: 0, result: 0 }, environment: { kpi: 0, result: 0 }, fire: { kpi: 0, result: 0 }, firstaid: { kpi: 0, result: 0 }, occupational: { kpi: 0, result: 0 } },
        2022: { fatality: { kpi: 0, result: 0 }, trir: { kpi: 0, result: 3.53 }, pvir: { kpi: 0, result: 0 }, environment: { kpi: 0, result: 0 }, fire: { kpi: 0, result: 0 }, firstaid: { kpi: 0, result: 0 }, occupational: { kpi: 0, result: 0 } },
        2023: { fatality: { kpi: 0, result: 0 }, trir: { kpi: 0, result: 1.77 }, pvir: { kpi: 0, result: 0 }, environment: { kpi: 0, result: 0 }, fire: { kpi: 0, result: 0 }, firstaid: { kpi: 0, result: 0 }, occupational: { kpi: 0, result: 0 } },
        2024: { fatality: { kpi: 0, result: 0 }, trir: { kpi: 0, result: 0.89 }, pvir: { kpi: 0, result: 0 }, environment: { kpi: 0, result: 0 }, fire: { kpi: 0, result: 0 }, firstaid: { kpi: 0, result: 0 }, occupational: { kpi: 0, result: 0 } },
        2025: { fatality: { kpi: 0, result: 0 }, trir: { kpi: 0.44, result: 0 }, pvir: { kpi: 0, result: 0 }, environment: { kpi: 0, result: 0 }, fire: { kpi: 0, result: 0 }, firstaid: { kpi: 0, result: 0 }, occupational: { kpi: 0, result: 0 } }
    };

    const kpiLabels = {
        fatality: 'Fatality',
        trir: 'Total Recordable Injury Rate (TRIR)',
        pvir: 'Preventive Vehicle Incident Rate (PVIR)',
        environment: 'Environment Incidents / Oil Spill',
        fire: 'Fire Case',
        firstaid: 'First Aid Case',
        occupational: 'Occupational Health Incident'
    };

    function selectKPIYear(year) {
        selectedKPIYear = year;
        document.querySelectorAll('.kpi-year-tab').forEach(btn => {
            const isActive = parseInt(btn.dataset.year) === year;
            btn.style.background = isActive ? 'var(--netflix-red)' : 'var(--bg-tertiary)';
            btn.style.color = isActive ? 'white' : 'var(--text-primary)';
            btn.style.border = isActive ? '2px solid var(--netflix-red)' : '1px solid var(--border)';
            btn.style.fontWeight = isActive ? '600' : '500';
        });
        renderKPIDashboard();
    }


    // Load KPI data from backend API
    async function loadKPIFromAPI() {
        try {
            const res = await fetch(`${API_BASE}/kpi`);
            if (res.ok) {
                const data = await res.json();
                // Update kpiData with backend data
                if (data.kpi) {
                    Object.keys(data.kpi).forEach(year => {
                        kpiData[year] = {};
                        Object.keys(data.kpi[year]).forEach(metric => {
                            kpiData[year][metric] = {
                                kpi: data.kpi[year][metric].target || 0,
                                result: data.kpi[year][metric].result || 0
                            };
                        });
                    });
                }
                if (data.man_hours) kpiManHours = data.man_hours;
                renderKPIDashboard();
            }
        } catch (e) { console.error('[KPI] Load error:', e); }
    }

    let kpiManHours = { 2021: 0, 2022: 283286, 2023: 0, 2024: 0, 2025: 0 };

    // Save KPI update to backend (admin only)
    async function saveKPIUpdate(year, metric, field, value) {
        if (!isAdmin) return;
        const updateData = {};
        updateData[`${metric}_${field}`] = parseFloat(value) || 0;
        try {
            const res = await fetch(`${API_BASE}/kpi/${year}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updateData)
            });
            if (res.ok) {
                showToast('KPI saved!', 'success');
                loadKPIFromAPI();
            }
        } catch (e) { console.error('[KPI] Save error:', e); }
    }

    // Save Man-Hours update
    async function saveManHours(year, value) {
        if (!isAdmin) return;
        try {
            const res = await fetch(`${API_BASE}/kpi/${year}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ man_hours: parseFloat(value) || 0 })
            });
            if (res.ok) {
                showToast('Man-Hours saved!', 'success');
                loadKPIFromAPI();
            }
        } catch (e) { console.error('[KPI] MH Save error:', e); }
    }


    function getKPITrendStatus(metric, currentYear) {
        const currentData = kpiData[currentYear];
        const prevYear = currentYear - 1;
        const prevData = kpiData[prevYear];

        if (!currentData || !currentData[metric]) return { icon: '‚àí', color: '#888', bg: 'rgba(128,128,128,0.1)' };

        const currentResult = currentData[metric].result || 0;
        const prevResult = prevData && prevData[metric] ? prevData[metric].result || 0 : 0;

        if (currentResult === 0) {
            return { icon: '‚úì', color: '#27ae60', bg: 'linear-gradient(135deg, rgba(39,174,96,0.2), rgba(46,204,113,0.1))' };
        } else if (currentResult > prevResult) {
            return { icon: '‚Üë', color: '#e74c3c', bg: 'linear-gradient(135deg, rgba(231,76,60,0.2), rgba(192,57,43,0.1))' };
        } else if (currentResult < prevResult) {
            return { icon: '‚Üì', color: '#27ae60', bg: 'linear-gradient(135deg, rgba(39,174,96,0.2), rgba(46,204,113,0.1))' };
        } else {
            return { icon: '‚àí', color: '#888', bg: 'rgba(128,128,128,0.1)' };
        }
    }

    let kpiEditMode = false;

    function toggleKPIEditMode() {
        kpiEditMode = !kpiEditMode;
        renderKPIDashboard();
    }

    function renderKPIDashboard() {
        const yearData = kpiData[selectedKPIYear] || kpiData[2025];
        const prevYear = selectedKPIYear - 1;
        const prevYearData = kpiData[prevYear] || {};
        const metrics6 = ['fatality', 'trir', 'pvir', 'environment', 'fire', 'firstaid'];
        const metricIcons = { fatality: 'üíÄ', trir: 'ü©π', pvir: 'üöó', environment: 'üåø', fire: 'üî•', firstaid: 'ü©∫', occupational: '‚öïÔ∏è' };
        const metricLabels6 = { fatality: 'Fatality', trir: 'TRIR', pvir: 'PVIR', environment: 'Environment', fire: 'Fire Case', firstaid: 'First Aid' };
        const cardGradients = [
            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
            'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
        ];

        // 6 Modern Summary cards with gradients
        let cardsHtml = '';
        metrics6.forEach((key, i) => {
            const val = yearData[key] || { kpi: 0, result: 0 };
            const isZero = val.result === 0;
            cardsHtml += `
                <div style="background: ${cardGradients[i]}; border-radius: 16px; padding: 16px; text-align: center; 
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;"
                    onmouseover="this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'"
                    onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                    <div style="font-size: 20px; margin-bottom: 4px;">${metricIcons[key]}</div>
                    <div style="font-size: 26px; font-weight: 700; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">${typeof val.result === 'number' ? val.result.toFixed(2) : val.result}</div>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.9); font-weight: 500;">${metricLabels6[key]}</div>
                </div>
            `;
        });
        document.getElementById('kpi-summary-cards').innerHTML = cardsHtml;

        // Dynamic Table Header with Previous Year column
        const theadHtml = `
            <tr style="background: var(--bg-tertiary);">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">KPI Metric</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); color: #888; font-size: 11px;">${prevYear} Result</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); color: #3498db; font-weight: 700;">Target</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); font-weight: 700;">${selectedKPIYear} Result</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border);">Trend</th>
            </tr>
        `;
        document.getElementById('kpi-table-head').innerHTML = theadHtml;

        // Table body with Previous Year comparison
        let tableHtml = '';
        const allMetrics = Object.keys(kpiLabels);
        allMetrics.forEach((key, i) => {
            const values = yearData[key] || { kpi: 0, result: 0 };
            const prevValues = prevYearData[key] || { kpi: 0, result: 0 };
            const status = getKPITrendStatus(key, selectedKPIYear);

            if (kpiEditMode && isAdmin) {
                tableHtml += `
                    <tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(229,9,20,0.05)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 14px; border-bottom: 1px solid var(--border);">
                            <span style="font-size: 18px; margin-right: 8px;">${metricIcons[key] || 'ÔøΩÔøΩ'}</span>
                            <span style="font-weight: 600;">${kpiLabels[key]}</span>
                        </td>
                        <td style="padding: 14px; border-bottom: 1px solid var(--border); text-align: center; color: #888;">
                            ${prevValues.result.toFixed(2)}
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                            <input type="number" step="0.01" value="${values.kpi.toFixed(2)}" 
                                style="width: 70px; padding: 8px; border: 2px solid var(--netflix-red); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); text-align: center; font-weight: 600;" 
                                onchange="saveKPIUpdate(${selectedKPIYear}, '${key}', 'target', this.value)">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                            <input type="number" step="0.01" value="${values.result.toFixed(2)}" 
                                style="width: 70px; padding: 8px; border: 2px solid #3498db; border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); text-align: center; font-weight: 600;" 
                                onchange="saveKPIUpdate(${selectedKPIYear}, '${key}', 'result', this.value)">
                        </td>
                        <td style="padding: 14px; border-bottom: 1px solid var(--border); text-align: center;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: ${status.bg}; display: inline-flex; align-items: center; justify-content: center;">
                                <span style="color: ${status.color}; font-weight: 700; font-size: 18px;">${status.icon}</span>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                tableHtml += `
                    <tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.03)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 16px; border-bottom: 1px solid var(--border);">
                            <span style="font-size: 18px; margin-right: 10px;">${metricIcons[key] || 'üìä'}</span>
                            <span style="font-weight: 600;">${kpiLabels[key]}</span>
                        </td>
                        <td style="padding: 16px; border-bottom: 1px solid var(--border); text-align: center; color: #888;">
                            ${prevValues.result.toFixed(2)}
                        </td>
                        <td style="padding: 16px; border-bottom: 1px solid var(--border); text-align: center;">
                            <span style="background: rgba(52,152,219,0.15); color: #3498db; padding: 6px 12px; border-radius: 20px; font-weight: 700;">${values.kpi.toFixed(2)}</span>
                        </td>
                        <td style="padding: 16px; border-bottom: 1px solid var(--border); text-align: center;">
                            <span style="font-size: 18px; font-weight: 700;">${values.result.toFixed(2)}</span>
                        </td>
                        <td style="padding: 16px; border-bottom: 1px solid var(--border); text-align: center;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: ${status.bg}; display: inline-flex; align-items: center; justify-content: center;">
                                <span style="color: ${status.color}; font-weight: 700; font-size: 18px;">${status.icon}</span>
                            </div>
                        </td>
                    </tr>
                `;
            }
        });
        document.getElementById('kpi-table-body').innerHTML = tableHtml;

        // Update edit button
        const editBtn = document.getElementById('kpi-edit-btn');
        if (editBtn) editBtn.innerHTML = kpiEditMode ? '‚úì Done' : '‚úèÔ∏è Edit';
    }

    function showAddKPIYearModal() {
        const newYear = prompt('Enter new year (e.g., 2026):');
        if (newYear && !isNaN(newYear) && parseInt(newYear) > 2020) {
            addNewKPIYear(parseInt(newYear));
        }
    }

    async function addNewKPIYear(year) {
        kpiData[year] = {
            fatality: { kpi: 0, result: 0 }, trir: { kpi: 0, result: 0 }, pvir: { kpi: 0, result: 0 },
            environment: { kpi: 0, result: 0 }, fire: { kpi: 0, result: 0 }, firstaid: { kpi: 0, result: 0 },
            occupational: { kpi: 0, result: 0 }
        };
        try {
            await fetch(`${API_BASE}/kpi/${year}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ man_hours: 0, fatality_target: 0, fatality_result: 0 })
            });
            showToast(`Year ${year} added successfully!`, 'success');
            location.reload(); // Reload to show new year tab
        } catch (e) { console.error('[KPI] Add year error:', e); showToast('Error adding year', 'error'); }
    }

    // Excel Download Feature
    function downloadKPIExcel(year) {
        const data = year === 'all' ? kpiData : { [year]: kpiData[year] };
        let csvContent = 'HSE KPI Report\n';
        csvContent += 'Year,Metric,Target,Result,Status\n';

        Object.keys(data).forEach(yr => {
            const yearData = data[yr];
            if (yearData) {
                Object.keys(kpiLabels).forEach(key => {
                    const val = yearData[key] || { kpi: 0, result: 0 };
                    const status = getKPITrendStatus(key, parseInt(yr));
                    csvContent += `${yr},${kpiLabels[key]},${val.kpi.toFixed(2)},${val.result.toFixed(2)},${status.icon}\n`;
                });
            }
        });

        // Create download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = year === 'all' ? 'HSE_KPI_All_Years.csv' : `HSE_KPI_${year}.csv`;
        link.click();
        showToast(`KPI data downloaded!`, 'success');
    }

    // Expose KPI functions to window for onclick handlers
    window.toggleKPIEditMode = toggleKPIEditMode;
    window.selectKPIYear = selectKPIYear;
    window.showAddKPIYearModal = showAddKPIYearModal;
    window.downloadKPIExcel = downloadKPIExcel;
    window.renderKPIDashboard = renderKPIDashboard;
    window.saveKPIUpdate = saveKPIUpdate;
    window.saveManHours = saveManHours;


    // ===== LL INDICATOR FUNCTIONS =====
    let llData = { year: 2025, lagging: [], leading: [] };
    let llEditMode = false;
    let llSectionStates = { lagging: true, leading: true };

    async function loadLLData() {
        try {
            const res = await fetch(`${API_BASE}/ll-indicator`);
            if (res.ok) {
                llData = await res.json();
                renderLLIndicator();
            }
        } catch (e) { console.error('[LL] Load error:', e); }
    }

    function toggleLLSection(section) {
        llSectionStates[section] = !llSectionStates[section];
        const content = document.getElementById(`ll-${section}-content`);
        const arrow = document.getElementById(`ll-${section}-arrow`);
        if (content) content.style.display = llSectionStates[section] ? 'block' : 'none';
        if (arrow) arrow.textContent = llSectionStates[section] ? '‚ñº' : '‚ñ∂';
    }

    function toggleLLEditMode() {
        llEditMode = !llEditMode;
        renderLLIndicator();
    }

    function getLLStatus(target, actual) {
        const t = parseFloat(target) || 0;
        const a = parseFloat(actual) || 0;
        if (target.includes('%')) {
            const tPct = parseFloat(target);
            const aPct = parseFloat(actual);
            if (aPct >= tPct) return { icon: '‚úì', color: '#27ae60', bg: 'rgba(39,174,96,0.2)' };
            if (aPct >= tPct * 0.5) return { icon: '‚ö†', color: '#f39c12', bg: 'rgba(243,156,18,0.2)' };
            return { icon: '‚úó', color: '#e74c3c', bg: 'rgba(231,76,60,0.2)' };
        }
        if (a <= t) return { icon: '‚úì', color: '#27ae60', bg: 'rgba(39,174,96,0.2)' };
        return { icon: '‚úó', color: '#e74c3c', bg: 'rgba(231,76,60,0.2)' };
    }

    function renderLLIndicator() {
        document.getElementById('ll-year-title').textContent = `${llData.year} LL Indicator`;

        // Render Lagging Indicators
        let laggingHtml = '';
        (llData.lagging || []).forEach((ind, i) => {
            const status = getLLStatus(ind.target, ind.actual);
            if (llEditMode && isAdmin) {
                laggingHtml += `
                    <tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(231,76,60,0.05)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">${ind.id}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border);">${ind.icon} ${ind.name}</td>
                        <td style="padding: 6px; border-bottom: 1px solid var(--border); text-align: center;">
                            <input type="text" value="${ind.target}" style="width: 60px; padding: 6px; border: 1px solid var(--netflix-red); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); text-align: center; font-size: 11px;" onchange="saveLLUpdate('lagging', ${ind.id}, 'target', this.value)">
                        </td>
                        <td style="padding: 6px; border-bottom: 1px solid var(--border); text-align: center;">
                            <input type="text" value="${ind.actual}" style="width: 60px; padding: 6px; border: 1px solid #3498db; border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); text-align: center; font-size: 11px;" onchange="saveLLUpdate('lagging', ${ind.id}, 'actual', this.value)">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                            <span style="display: inline-flex; width: 28px; height: 28px; border-radius: 50%; align-items: center; justify-content: center; background: ${status.bg}; color: ${status.color}; font-weight: 700;">${status.icon}</span>
                        </td>
                    </tr>
                `;
            } else {
                laggingHtml += `
                    <tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(231,76,60,0.03)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; color: var(--text-muted);">${ind.id}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); font-weight: 500;">${ind.icon} ${ind.name}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; color: #e74c3c; font-weight: 600;">${ind.target}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; font-weight: 600;">${ind.actual}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                            <span style="display: inline-flex; width: 28px; height: 28px; border-radius: 50%; align-items: center; justify-content: center; background: ${status.bg}; color: ${status.color}; font-weight: 700;">${status.icon}</span>
                        </td>
                    </tr>
                `;
            }
        });
        document.getElementById('ll-lagging-body').innerHTML = laggingHtml;

        // Render Leading Indicators
        let leadingHtml = '';
        (llData.leading || []).forEach((ind, i) => {
            const status = getLLStatus(ind.target, ind.actual);
            if (llEditMode && isAdmin) {
                leadingHtml += `
                    <tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(39,174,96,0.05)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">${ind.id}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border);">${ind.icon} ${ind.name}</td>
                        <td style="padding: 6px; border-bottom: 1px solid var(--border); text-align: center;">
                            <input type="text" value="${ind.target}" style="width: 80px; padding: 6px; border: 1px solid var(--netflix-red); border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); text-align: center; font-size: 11px;" onchange="saveLLUpdate('leading', ${ind.id}, 'target', this.value)">
                        </td>
                        <td style="padding: 6px; border-bottom: 1px solid var(--border); text-align: center;">
                            <input type="text" value="${ind.actual}" style="width: 60px; padding: 6px; border: 1px solid #3498db; border-radius: 4px; background: var(--bg-primary); color: var(--text-primary); text-align: center; font-size: 11px;" onchange="saveLLUpdate('leading', ${ind.id}, 'actual', this.value)">
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                            <span style="display: inline-flex; width: 28px; height: 28px; border-radius: 50%; align-items: center; justify-content: center; background: ${status.bg}; color: ${status.color}; font-weight: 700;">${status.icon}</span>
                        </td>
                    </tr>
                `;
            } else {
                leadingHtml += `
                    <tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(39,174,96,0.03)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; color: var(--text-muted);">${ind.id}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); font-weight: 500;">${ind.icon} ${ind.name}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; color: #27ae60; font-weight: 600;">${ind.target}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; font-weight: 600;">${ind.actual}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                            <span style="display: inline-flex; width: 28px; height: 28px; border-radius: 50%; align-items: center; justify-content: center; background: ${status.bg}; color: ${status.color}; font-weight: 700;">${status.icon}</span>
                        </td>
                    </tr>
                `;
            }
        });
        document.getElementById('ll-leading-body').innerHTML = leadingHtml;

        // Update edit button
        const editBtn = document.getElementById('ll-edit-btn');
        if (editBtn) editBtn.innerHTML = llEditMode ? '‚úì Done' : '‚úèÔ∏è Edit';

    }

    async function saveLLUpdate(type, id, field, value) {
        if (!isAdmin) return;
        // Update local data
        const indicators = llData[type] || [];
        const ind = indicators.find(i => i.id === id);
        if (ind) ind[field] = value;

        try {
            const res = await fetch(`${API_BASE}/ll-indicator`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ indicator_type: type, indicator_id: id, [field]: value })
            });
            if (res.ok) showToast('LL Indicator saved!', 'success');
        } catch (e) { console.error('[LL] Save error:', e); }
    }

    function downloadLLIndicator() {
        let csv = `${llData.year} Lagging & Leading Indicators\n\n`;
        csv += 'LAGGING INDICATORS\nNo,Indicator,Target,Actual,Status\n';
        (llData.lagging || []).forEach(ind => {
            const status = getLLStatus(ind.target, ind.actual);
            csv += `${ind.id},"${ind.name}",${ind.target},${ind.actual},${status.icon}\n`;
        });
        csv += '\nLEADING INDICATORS\nNo,Indicator,Target,Actual,Status\n';
        (llData.leading || []).forEach(ind => {
            const status = getLLStatus(ind.target, ind.actual);
            csv += `${ind.id},"${ind.name}","${ind.target}",${ind.actual},${status.icon}\n`;
        });

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `LL_Indicator_${llData.year}.csv`;
        link.click();
        showToast('LL Indicator downloaded!', 'success');
    }

    // Expose LL functions to window
    window.toggleLLSection = toggleLLSection;
    window.toggleLLEditMode = toggleLLEditMode;
    window.renderLLIndicator = renderLLIndicator;
    window.saveLLUpdate = saveLLUpdate;
    window.downloadLLIndicator = downloadLLIndicator;
    window.loadLLData = loadLLData;


    // ===== HSE OTP FUNCTIONS =====
    let otpData = { year: 2026, programs: [] };
    let filteredOTPPrograms = [];
    let currentOTPRegion = 'indonesia'; // 'indonesia' or 'asia'
    const MONTHS = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];
    const MONTH_LABELS = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];

    async function loadOTPData() {
        try {
            const endpoint = currentOTPRegion === 'asia' ? '/otp-asia' : '/otp';
            const res = await fetch(`${API_BASE}${endpoint}`);
            if (res.ok) {
                otpData = await res.json();
                filteredOTPPrograms = otpData.programs || [];
                renderOTPTable();
                updateOTPSummary();
            }
        } catch (e) { console.error('[OTP] Load error:', e); }
    }

    function changeOTPRegion(region) {
        currentOTPRegion = region;
        document.getElementById('otp-region-select').value = region;
        loadOTPData();
    }

    let currentOTPBase = 'all';
    function changeOTPBase(base) {
        currentOTPBase = base;
        document.getElementById('otp-base-select').value = base;
        updateOTPSummary();
    }

    function updateOTPSummary() {
        const programs = otpData.programs || [];
        const total = programs.length;
        const completed = programs.filter(p => p.progress === 100).length;
        const inProgress = programs.filter(p => p.progress > 0 && p.progress < 100).length;
        const avgProgress = total > 0 ? Math.round(programs.reduce((sum, p) => sum + (p.progress || 0), 0) / total) : 0;

        document.getElementById('otp-total-programs').textContent = total;
        document.getElementById('otp-completed').textContent = completed;
        document.getElementById('otp-in-progress').textContent = inProgress;
        document.getElementById('otp-avg-progress').textContent = avgProgress + '%';
        const regionLabel = currentOTPRegion === 'asia' ? 'ASIA' : 'Indonesia';
        document.getElementById('otp-year-title').textContent = `${otpData.year} HSE OTP ${regionLabel}`;
        document.getElementById('otp-year-select').value = otpData.year;
        document.getElementById('otp-region-select').value = currentOTPRegion;
    }

    function getCellColor(plan, actual) {
        if (plan === 0 && actual === 0) return { bg: 'transparent', color: 'var(--text-muted)' };
        if (actual >= plan) return { bg: 'rgba(39, 174, 96, 0.2)', color: '#27ae60' };
        if (actual > 0) return { bg: 'rgba(243, 156, 18, 0.2)', color: '#f39c12' };
        return { bg: 'rgba(231, 76, 60, 0.2)', color: '#e74c3c' };
    }

    function renderOTPTable() {
        const tbody = document.getElementById('otp-table-body');
        if (!tbody) return;

        const showActual = document.getElementById('otp-show-actual')?.checked ?? true;

        let html = '';
        filteredOTPPrograms.forEach((prog, idx) => {
            const progress = prog.progress || 0;
            const progressColor = progress === 100 ? '#27ae60' : progress >= 50 ? '#f39c12' : '#e74c3c';

            html += `<tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(155,89,182,0.05)'" onmouseout="this.style.background='transparent'">`;

            // Row number
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); position: sticky; left: 0; background: var(--bg-secondary); z-index: 1; text-align: center; font-weight: 600;">${idx + 1}</td>`;

            // Program name
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); position: sticky; left: 50px; background: var(--bg-secondary); z-index: 1;">
                <div style="font-weight: 500; max-width: 230px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${prog.name}">${prog.name}</div>
            </td>`;

            // Plan type
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; font-size: 10px; color: var(--text-muted);">${prog.plan_type || '-'}</td>`;

            // Monthly cells
            MONTHS.forEach(month => {
                const monthData = prog.months?.[month] || { plan: 0, actual: 0, wpts_id: '' };
                const cellStyle = getCellColor(monthData.plan, monthData.actual);
                const displayValue = showActual
                    ? `${monthData.plan}/${monthData.actual}`
                    : monthData.plan;
                const isEmpty = monthData.plan === 0 && monthData.actual === 0;
                const wptsDisplay = monthData.wpts_id ? `<div style="font-size: 9px; color: #27ae60; margin-top: 2px; font-weight: 500;">${monthData.wpts_id}</div>` : '';
                const planDateDisplay = monthData.plan_date ? `<div style="font-size: 8px; color: #3498db; margin-top: 1px;">üìÖ${monthData.plan_date.slice(5)}</div>` : '';
                const implDateDisplay = monthData.impl_date ? `<div style="font-size: 8px; color: #9b59b6; margin-top: 1px;">‚úÖ${monthData.impl_date.slice(5)}</div>` : '';

                html += `<td onclick="openOTPEditModal(${prog.id}, '${month}')" 
                    style="padding: 6px 4px; border-bottom: 1px solid var(--border); text-align: center; background: ${cellStyle.bg}; cursor: pointer; transition: all 0.2s; font-size: 11px; font-weight: 600; color: ${isEmpty ? 'var(--text-muted)' : cellStyle.color};"
                    onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"
                    title="Plan: ${monthData.plan} | Actual: ${monthData.actual}${monthData.wpts_id ? ' | WPTS: ' + monthData.wpts_id : ''}${monthData.plan_date ? ' | Plan Date: ' + monthData.plan_date : ''}${monthData.impl_date ? ' | Impl Date: ' + monthData.impl_date : ''}">
                    <div>${isEmpty ? '-' : displayValue}</div>
                    ${wptsDisplay}
                    ${planDateDisplay}
                    ${implDateDisplay}
                </td>`;
            });

            // Progress bar
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="flex: 1; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="width: ${progress}%; height: 100%; background: ${progressColor}; transition: width 0.3s;"></div>
                    </div>
                    <span style="font-size: 11px; font-weight: 600; color: ${progressColor}; min-width: 35px;">${progress}%</span>
                </div>
            </td>`;

            // Action (admin only)
            html += `<td class="admin-only" style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                <button onclick="deleteOTPProgram(${prog.id})" style="padding: 4px 8px; border: none; border-radius: 4px; background: rgba(231, 76, 60, 0.2); color: #e74c3c; cursor: pointer; font-size: 10px;" title="Delete">üóëÔ∏è</button>
            </td>`;

            html += '</tr>';
        });

        tbody.innerHTML = html || '<tr><td colspan="17" style="padding: 40px; text-align: center; color: var(--text-muted);">No OTP programs found</td></tr>';

        // Apply admin visibility
        if (typeof updateAdminElements === 'function') updateAdminElements();
    }

    function filterOTPPrograms() {
        const searchTerm = (document.getElementById('otp-search')?.value || '').toLowerCase();
        const statusFilter = document.getElementById('otp-filter-status')?.value || 'all';

        filteredOTPPrograms = (otpData.programs || []).filter(prog => {
            // Search filter
            const matchesSearch = prog.name.toLowerCase().includes(searchTerm) ||
                (prog.plan_type || '').toLowerCase().includes(searchTerm);

            // Status filter
            let matchesStatus = true;
            if (statusFilter === 'completed') matchesStatus = prog.progress === 100;
            else if (statusFilter === 'progress') matchesStatus = prog.progress > 0 && prog.progress < 100;
            else if (statusFilter === 'notstarted') matchesStatus = prog.progress === 0;

            return matchesSearch && matchesStatus;
        });

        renderOTPTable();
    }

    function toggleOTPView() {
        renderOTPTable();
    }

    function changeOTPYear(year) {
        // For now just update the display - in production this would fetch data for that year
        otpData.year = parseInt(year);
        document.getElementById('otp-year-title').textContent = `${year} HSE OTP`;
    }

    // Modal functions
    function openOTPEditModal(programId, month) {
        const prog = (otpData.programs || []).find(p => p.id === programId);
        if (!prog) return;

        const monthData = prog.months?.[month] || { plan: 0, actual: 0, wpts_id: '' };
        document.getElementById('otp-edit-program-id').value = programId;
        document.getElementById('otp-edit-month').value = month;
        document.getElementById('otp-edit-plan').value = monthData.plan;
        document.getElementById('otp-edit-actual').value = monthData.actual;
        document.getElementById('otp-edit-wpts').value = monthData.wpts_id || '';
        document.getElementById('otp-edit-plan-date').value = monthData.plan_date || '';
        document.getElementById('otp-edit-impl-date').value = monthData.impl_date || '';
        document.getElementById('otp-edit-title').textContent = `Edit ${month.toUpperCase()} - ${prog.name.substring(0, 30)}...`;

        document.getElementById('otp-edit-modal').style.display = 'flex';
    }

    function closeOTPEditModal() {
        document.getElementById('otp-edit-modal').style.display = 'none';
    }

    async function submitOTPEdit(e) {
        e.preventDefault();
        const programId = parseInt(document.getElementById('otp-edit-program-id').value);
        const month = document.getElementById('otp-edit-month').value;
        const plan = parseInt(document.getElementById('otp-edit-plan').value) || 0;
        const actual = parseInt(document.getElementById('otp-edit-actual').value) || 0;
        const wpts_id = document.getElementById('otp-edit-wpts').value.trim();
        const plan_date = document.getElementById('otp-edit-plan-date').value;
        const impl_date = document.getElementById('otp-edit-impl-date').value;

        try {
            const endpoint = currentOTPRegion === 'asia' ? '/otp-asia' : '/otp';
            const res = await fetch(`${API_BASE}${endpoint}/${programId}/month/${month}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ plan, actual, wpts_id, plan_date, impl_date })
            });

            if (res.ok) {
                showToast('OTP data updated!', 'success');
                closeOTPEditModal();
                loadOTPData();
            } else {
                showToast('Error updating OTP data', 'error');
            }
        } catch (e) {
            showToast('Error connecting to server', 'error');
        }
    }

    function openCreateOTPModal() {
        document.getElementById('otp-create-form').reset();
        document.getElementById('otp-create-modal').style.display = 'flex';
    }

    function closeOTPCreateModal() {
        document.getElementById('otp-create-modal').style.display = 'none';
    }

    async function submitNewOTP(e) {
        e.preventDefault();
        const name = document.getElementById('otp-new-name').value.trim();
        const plan_type = document.getElementById('otp-new-plan-type').value;
        const due_date = document.getElementById('otp-new-due-date').value || null;

        if (!name) {
            showToast('Please enter a program name', 'error');
            return;
        }

        try {
            const endpoint = currentOTPRegion === 'asia' ? '/otp-asia' : '/otp';
            const res = await fetch(`${API_BASE}${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, plan_type, due_date })
            });

            if (res.ok) {
                showToast('OTP program created!', 'success');
                closeOTPCreateModal();
                loadOTPData();
            } else {
                showToast('Error creating OTP program', 'error');
            }
        } catch (e) {
            showToast('Error connecting to server', 'error');
        }
    }

    async function deleteOTPProgram(programId) {
        if (!confirm('Are you sure you want to delete this OTP program?')) return;

        try {
            const endpoint = currentOTPRegion === 'asia' ? '/otp-asia' : '/otp';
            const res = await fetch(`${API_BASE}${endpoint}/${programId}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('OTP program deleted', 'success');
                loadOTPData();
            } else {
                showToast('Error deleting OTP program', 'error');
            }
        } catch (e) {
            showToast('Error connecting to server', 'error');
        }
    }

    function downloadOTPReport() {
        // Create CSV with WPTS ID columns
        let csv = 'No,Program Name,Plan Type,';
        csv += MONTH_LABELS.map(m => `${m}_Plan,${m}_Actual,${m}_WPTS`).join(',');
        csv += ',Progress\n';

        (otpData.programs || []).forEach((prog, idx) => {
            csv += `${idx + 1},"${prog.name.replace(/"/g, '""')}","${prog.plan_type || ''}",`;
            MONTHS.forEach(month => {
                const m = prog.months?.[month] || { plan: 0, actual: 0, wpts_id: '' };
                csv += `${m.plan},${m.actual},"${(m.wpts_id || '').replace(/"/g, '""')}",`;
            });
            csv += `${prog.progress || 0}%\n`;
        });

        const regionLabel = currentOTPRegion === 'asia' ? 'ASIA' : 'Indonesia';
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `HSE_OTP_${regionLabel}_${otpData.year}.csv`;
        link.click();
        showToast('OTP report downloaded!', 'success');
    }

    // ===== OTP ASIA Functions =====
    let otpAsiaData = { year: 2026, programs: [] };
    let filteredOTPAsiaPrograms = [];

    async function loadOTPAsiaData() {
        try {
            const res = await fetch(`${API_BASE}/otp-asia`);
            if (res.ok) {
                otpAsiaData = await res.json();
                filteredOTPAsiaPrograms = otpAsiaData.programs || [];
                renderOTPAsiaTable();
                updateOTPAsiaSummary();
            }
        } catch (e) { console.error('[OTP ASIA] Load error:', e); }
    }

    function updateOTPAsiaSummary() {
        const programs = otpAsiaData.programs || [];
        const total = programs.length;
        const completed = programs.filter(p => p.progress === 100).length;
        const inProgress = programs.filter(p => p.progress > 0 && p.progress < 100).length;
        const avgProgress = total > 0 ? Math.round(programs.reduce((sum, p) => sum + (p.progress || 0), 0) / total) : 0;

        document.getElementById('otp-asia-total-programs').textContent = total;
        document.getElementById('otp-asia-completed').textContent = completed;
        document.getElementById('otp-asia-in-progress').textContent = inProgress;
        document.getElementById('otp-asia-avg-progress').textContent = avgProgress + '%';
        document.getElementById('otp-asia-year-title').textContent = `${otpAsiaData.year} HSE OTP ASIA`;
        document.getElementById('otp-asia-year-select').value = otpAsiaData.year;
    }

    function renderOTPAsiaTable() {
        const tbody = document.getElementById('otp-asia-table-body');
        if (!tbody) return;

        const showActual = document.getElementById('otp-asia-show-actual')?.checked ?? true;

        let html = '';
        filteredOTPAsiaPrograms.forEach((prog, idx) => {
            const progress = prog.progress || 0;
            const progressColor = progress === 100 ? '#27ae60' : progress >= 50 ? '#f39c12' : '#e74c3c';

            html += `<tr style="transition: background 0.2s;" onmouseover="this.style.background='rgba(230,126,34,0.05)'" onmouseout="this.style.background='transparent'">`;

            // Row number
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); position: sticky; left: 0; background: var(--bg-secondary); z-index: 1; text-align: center; font-weight: 600;">${idx + 1}</td>`;

            // Program name
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); position: sticky; left: 50px; background: var(--bg-secondary); z-index: 1;">
                <div style="font-weight: 500; max-width: 230px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${prog.name}">${prog.name}</div>
            </td>`;

            // Plan type
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center; font-size: 10px; color: var(--text-muted);">${prog.plan_type || '-'}</td>`;

            // Monthly cells
            MONTHS.forEach(month => {
                const monthData = prog.months?.[month] || { plan: 0, actual: 0, wpts_id: '' };
                const cellStyle = getCellColor(monthData.plan, monthData.actual);
                const displayValue = showActual
                    ? `${monthData.plan}/${monthData.actual}`
                    : monthData.plan;
                const isEmpty = monthData.plan === 0 && monthData.actual === 0;
                const wptsDisplay = monthData.wpts_id ? `<div style="font-size: 9px; color: #27ae60; margin-top: 2px; font-weight: 500;">${monthData.wpts_id}</div>` : '';

                html += `<td onclick="openOTPAsiaEditModal(${prog.id}, '${month}')" 
                    style="padding: 6px 4px; border-bottom: 1px solid var(--border); text-align: center; background: ${cellStyle.bg}; cursor: pointer; transition: all 0.2s; font-size: 11px; font-weight: 600; color: ${isEmpty ? 'var(--text-muted)' : cellStyle.color};"
                    onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"
                    title="Plan: ${monthData.plan} | Actual: ${monthData.actual}${monthData.wpts_id ? ' | WPTS: ' + monthData.wpts_id : ''}">
                    <div>${isEmpty ? '-' : displayValue}</div>
                    ${wptsDisplay}
                </td>`;
            });

            // Progress bar
            html += `<td style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="flex: 1; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="width: ${progress}%; height: 100%; background: ${progressColor}; transition: width 0.3s;"></div>
                    </div>
                    <span style="font-size: 11px; font-weight: 600; color: ${progressColor}; min-width: 35px;">${progress}%</span>
                </div>
            </td>`;

            // Action (admin only)
            html += `<td class="admin-only" style="padding: 10px; border-bottom: 1px solid var(--border); text-align: center;">
                <button onclick="deleteOTPAsiaProgram(${prog.id})" style="padding: 4px 8px; border: none; border-radius: 4px; background: rgba(231, 76, 60, 0.2); color: #e74c3c; cursor: pointer; font-size: 10px;" title="Delete">üóëÔ∏è</button>
            </td>`;

            html += '</tr>';
        });

        tbody.innerHTML = html || '<tr><td colspan="17" style="padding: 40px; text-align: center; color: var(--text-muted);">No OTP ASIA programs found</td></tr>';

        // Apply admin visibility
        if (typeof updateAdminElements === 'function') updateAdminElements();
    }

    function filterOTPAsiaPrograms() {
        const searchTerm = (document.getElementById('otp-asia-search')?.value || '').toLowerCase();
        const statusFilter = document.getElementById('otp-asia-filter-status')?.value || 'all';

        filteredOTPAsiaPrograms = (otpAsiaData.programs || []).filter(prog => {
            const matchesSearch = prog.name.toLowerCase().includes(searchTerm) ||
                (prog.plan_type || '').toLowerCase().includes(searchTerm);

            let matchesStatus = true;
            if (statusFilter === 'completed') matchesStatus = prog.progress === 100;
            else if (statusFilter === 'progress') matchesStatus = prog.progress > 0 && prog.progress < 100;
            else if (statusFilter === 'notstarted') matchesStatus = prog.progress === 0;

            return matchesSearch && matchesStatus;
        });

        renderOTPAsiaTable();
    }

    function toggleOTPAsiaView() {
        renderOTPAsiaTable();
    }

    function changeOTPAsiaYear(year) {
        otpAsiaData.year = parseInt(year);
        document.getElementById('otp-asia-year-title').textContent = `${year} HSE OTP ASIA`;
    }

    function openOTPAsiaEditModal(programId, month) {
        const prog = (otpAsiaData.programs || []).find(p => p.id === programId);
        if (!prog) return;

        const monthData = prog.months?.[month] || { plan: 0, actual: 0, wpts_id: '' };
        document.getElementById('otp-asia-edit-program-id').value = programId;
        document.getElementById('otp-asia-edit-month').value = month;
        document.getElementById('otp-asia-edit-plan').value = monthData.plan;
        document.getElementById('otp-asia-edit-actual').value = monthData.actual;
        document.getElementById('otp-asia-edit-wpts').value = monthData.wpts_id || '';
        document.getElementById('otp-asia-edit-title').textContent = `Edit ${month.toUpperCase()} - ${prog.name.substring(0, 30)}...`;

        document.getElementById('otp-asia-edit-modal').style.display = 'flex';
    }

    function closeOTPAsiaEditModal() {
        document.getElementById('otp-asia-edit-modal').style.display = 'none';
    }

    async function submitOTPAsiaEdit(e) {
        e.preventDefault();
        const programId = parseInt(document.getElementById('otp-asia-edit-program-id').value);
        const month = document.getElementById('otp-asia-edit-month').value;
        const plan = parseInt(document.getElementById('otp-asia-edit-plan').value) || 0;
        const actual = parseInt(document.getElementById('otp-asia-edit-actual').value) || 0;
        const wpts_id = document.getElementById('otp-asia-edit-wpts').value.trim();

        try {
            const res = await fetch(`${API_BASE}/otp-asia/${programId}/month/${month}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ plan, actual, wpts_id })
            });

            if (res.ok) {
                showToast('OTP ASIA data updated!', 'success');
                closeOTPAsiaEditModal();
                loadOTPAsiaData();
            } else {
                showToast('Error updating OTP ASIA data', 'error');
            }
        } catch (e) {
            showToast('Error connecting to server', 'error');
        }
    }

    function openCreateOTPAsiaModal() {
        document.getElementById('otp-asia-create-form').reset();
        document.getElementById('otp-asia-create-modal').style.display = 'flex';
    }

    function closeOTPAsiaCreateModal() {
        document.getElementById('otp-asia-create-modal').style.display = 'none';
    }

    async function submitNewOTPAsia(e) {
        e.preventDefault();
        const name = document.getElementById('otp-asia-new-name').value.trim();
        const plan_type = document.getElementById('otp-asia-new-plan-type').value;
        const due_date = document.getElementById('otp-asia-new-due-date').value || null;

        if (!name) {
            showToast('Please enter a program name', 'error');
            return;
        }

        try {
            const res = await fetch(`${API_BASE}/otp-asia`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, plan_type, due_date })
            });

            if (res.ok) {
                showToast('OTP ASIA program created!', 'success');
                closeOTPAsiaCreateModal();
                loadOTPAsiaData();
            } else {
                showToast('Error creating OTP ASIA program', 'error');
            }
        } catch (e) {
            showToast('Error connecting to server', 'error');
        }
    }

    async function deleteOTPAsiaProgram(programId) {
        if (!confirm('Are you sure you want to delete this OTP ASIA program?')) return;

        try {
            const res = await fetch(`${API_BASE}/otp-asia/${programId}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('OTP ASIA program deleted', 'success');
                loadOTPAsiaData();
            } else {
                showToast('Error deleting OTP ASIA program', 'error');
            }
        } catch (e) {
            showToast('Error connecting to server', 'error');
        }
    }

    function downloadOTPAsiaReport() {
        let csv = 'No,Program Name,Plan Type,';
        csv += MONTH_LABELS.map(m => `${m}_Plan,${m}_Actual`).join(',');
        csv += ',Progress\n';

        (otpAsiaData.programs || []).forEach((prog, idx) => {
            csv += `${idx + 1},"${prog.name.replace(/"/g, '""')}","${prog.plan_type || ''}",`;
            MONTHS.forEach(month => {
                const m = prog.months?.[month] || { plan: 0, actual: 0 };
                csv += `${m.plan},${m.actual},`;
            });
            csv += `${prog.progress || 0}%\n`;
        });

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `HSE_OTP_ASIA_${otpAsiaData.year}.csv`;
        link.click();
        showToast('OTP ASIA report downloaded!', 'success');
    }

    // Expose OTP functions to window
    window.loadOTPData = loadOTPData;
    window.filterOTPPrograms = filterOTPPrograms;
    window.toggleOTPView = toggleOTPView;
    window.changeOTPYear = changeOTPYear;
    window.changeOTPRegion = changeOTPRegion;
    window.changeOTPBase = changeOTPBase;
    window.openOTPEditModal = openOTPEditModal;
    window.closeOTPEditModal = closeOTPEditModal;
    window.submitOTPEdit = submitOTPEdit;
    window.openCreateOTPModal = openCreateOTPModal;
    window.closeOTPCreateModal = closeOTPCreateModal;
    window.submitNewOTP = submitNewOTP;
    window.deleteOTPProgram = deleteOTPProgram;
    window.downloadOTPReport = downloadOTPReport;

    // Expose OTP ASIA functions to window
    window.loadOTPAsiaData = loadOTPAsiaData;
    window.filterOTPAsiaPrograms = filterOTPAsiaPrograms;
    window.toggleOTPAsiaView = toggleOTPAsiaView;
    window.changeOTPAsiaYear = changeOTPAsiaYear;
    window.openOTPAsiaEditModal = openOTPAsiaEditModal;
    window.closeOTPAsiaEditModal = closeOTPAsiaEditModal;
    window.submitOTPAsiaEdit = submitOTPAsiaEdit;
    window.openCreateOTPAsiaModal = openCreateOTPAsiaModal;
    window.closeOTPAsiaCreateModal = closeOTPAsiaCreateModal;
    window.submitNewOTPAsia = submitNewOTPAsia;
    window.deleteOTPAsiaProgram = deleteOTPAsiaProgram;
    window.downloadOTPAsiaReport = downloadOTPAsiaReport;


    // ===== MATRIX FUNCTIONS =====
    let matrixData = { year: 2026, category: 'audit', region: 'indonesia', programs: [] };
    let filteredMatrixPrograms = [];
    let currentMatrixCategory = 'audit';
    let currentMatrixRegion = 'indonesia';

    async function loadMatrixData() {
        try {
            const res = await fetch(`${API_BASE}/matrix?category=${currentMatrixCategory}&region=${currentMatrixRegion}`);
            if (res.ok) {
                matrixData = await res.json();
                filteredMatrixPrograms = matrixData.programs || [];
                renderMatrixTable();
                updateMatrixSummary();
            }
        } catch (e) { console.error('[Matrix] Load error:', e); }
    }

    function changeMatrixCategory(category) {
        currentMatrixCategory = category;
        document.getElementById('matrix-category-select').value = category;
        loadMatrixData();
    }

    function changeMatrixRegion(region) {
        currentMatrixRegion = region;
        document.getElementById('matrix-region-select').value = region;
        loadMatrixData();
    }

    let currentMatrixBase = 'all';
    function changeMatrixBase(base) {
        currentMatrixBase = base;
        document.getElementById('matrix-base-select').value = base;
        updateMatrixSummary();
    }

    function changeMatrixYear(year) {
        matrixData.year = parseInt(year);
        document.getElementById('matrix-year-select').value = year;
        updateMatrixSummary();
    }

    function updateMatrixSummary() {
        const programs = matrixData.programs || [];
        const total = programs.length;
        const completed = programs.filter(p => p.progress === 100).length;
        const inProgress = programs.filter(p => p.progress > 0 && p.progress < 100).length;
        const avgProgress = total > 0 ? Math.round(programs.reduce((sum, p) => sum + (p.progress || 0), 0) / total) : 0;

        document.getElementById('matrix-total-programs').textContent = total;
        document.getElementById('matrix-completed').textContent = completed;
        document.getElementById('matrix-in-progress').textContent = inProgress;
        document.getElementById('matrix-avg-progress').textContent = avgProgress + '%';
        const categoryLabel = { audit: 'Audit', training: 'Training', drill: 'Emergency Drill', meeting: 'Meeting' }[currentMatrixCategory] || 'Audit';
        const regionLabel = currentMatrixRegion === 'asia' ? 'Asia' : 'Indonesia';
        document.getElementById('matrix-title').textContent = `${matrixData.year} Matrix - ${categoryLabel} (${regionLabel})`;
        document.getElementById('matrix-year-select').value = matrixData.year;
        document.getElementById('matrix-category-select').value = currentMatrixCategory;
        document.getElementById('matrix-region-select').value = currentMatrixRegion;
    }

    function getMatrixCellColor(plan, actual) {
        if (plan === 0 && actual === 0) return { bg: 'transparent', color: 'var(--text-muted)' };
        if (actual >= plan) return { bg: 'rgba(39, 174, 96, 0.2)', color: '#27ae60' };
        if (actual > 0) return { bg: 'rgba(243, 156, 18, 0.2)', color: '#f39c12' };
        return { bg: 'rgba(231, 76, 60, 0.2)', color: '#e74c3c' };
    }

    function renderMatrixTable() {
        const tbody = document.getElementById('matrix-table-body');
        if (!tbody) return;

        const showActual = document.getElementById('matrix-show-actual')?.checked ?? true;
        let html = '';
        filteredMatrixPrograms.forEach((prog, idx) => {
            html += `<tr style="border-bottom: 1px solid var(--border);">`;
            html += `<td style="padding: 10px; position: sticky; left: 0; background: var(--bg-secondary); z-index: 1;">${idx + 1}</td>`;
            html += `<td style="padding: 10px; position: sticky; left: 50px; background: var(--bg-secondary); z-index: 1; font-weight: 500;">${prog.name}</td>`;
            html += `<td style="padding: 10px; text-align: center; font-size: 10px; color: var(--text-muted);">${prog.reference || '-'}</td>`;
            MONTHS.forEach(month => {
                const m = prog.months?.[month] || { plan: 0, actual: 0 };
                const colors = getMatrixCellColor(m.plan, m.actual);
                const displayVal = showActual ? `${m.plan}/${m.actual}` : m.plan;
                const wptsBadge = m.wpts_id ? `<div style="font-size:8px;color:#27ae60;">üìé${m.wpts_id}</div>` : '';
                const planDateBadge = m.plan_date ? `<div style="font-size:7px;color:#3498db;">üìÖ${m.plan_date.slice(5)}</div>` : '';
                const implDateBadge = m.impl_date ? `<div style="font-size:7px;color:#9b59b6;">‚úÖ${m.impl_date.slice(5)}</div>` : '';
                html += `<td style="padding: 6px; text-align: center; background: ${colors.bg}; color: ${colors.color}; cursor: pointer; font-weight: 600;" onclick="openMatrixEditModal(${prog.id}, '${month}')" class="admin-only-clickable" title="Plan: ${m.plan} | Actual: ${m.actual}${m.wpts_id ? ' | WPTS: ' + m.wpts_id : ''}${m.plan_date ? ' | Plan: ' + m.plan_date : ''}${m.impl_date ? ' | Impl: ' + m.impl_date : ''}">${displayVal}${wptsBadge}${planDateBadge}${implDateBadge}</td>`;
            });
            const progColor = prog.progress >= 100 ? '#27ae60' : prog.progress > 0 ? '#3498db' : 'var(--text-muted)';
            html += `<td style="padding: 10px; text-align: center;"><div style="background: var(--bg-tertiary); border-radius: 6px; overflow: hidden; height: 20px; position: relative;"><div style="position: absolute; left: 0; top: 0; height: 100%; width: ${prog.progress}%; background: ${progColor};"></div><span style="position: relative; z-index: 1; font-size: 10px; font-weight: 600;">${prog.progress}%</span></div></td>`;
            html += `<td style="padding: 10px; text-align: center;" class="admin-only"><button onclick="deleteMatrixProgram(${prog.id})" style="padding: 4px 8px; border: none; border-radius: 4px; background: #e74c3c; color: white; cursor: pointer; font-size: 10px;">üóëÔ∏è</button></td>`;
            html += `</tr>`;
        });
        if (filteredMatrixPrograms.length === 0) {
            html = '<tr><td colspan="17" style="padding: 40px; text-align: center; color: var(--text-muted);">No matrix programs found</td></tr>';
        }
        tbody.innerHTML = html;
    }

    function filterMatrixPrograms() {
        const search = document.getElementById('matrix-search')?.value.toLowerCase() || '';
        const status = document.getElementById('matrix-filter-status')?.value || 'all';
        filteredMatrixPrograms = (matrixData.programs || []).filter(p => {
            const matchSearch = p.name.toLowerCase().includes(search);
            let matchStatus = true;
            if (status === 'completed') matchStatus = p.progress === 100;
            else if (status === 'progress') matchStatus = p.progress > 0 && p.progress < 100;
            else if (status === 'notstarted') matchStatus = p.progress === 0;
            return matchSearch && matchStatus;
        });
        renderMatrixTable();
    }

    function toggleMatrixView() { renderMatrixTable(); }

    function openMatrixEditModal(programId, month) {
        if (!isAdmin) return;
        const prog = (matrixData.programs || []).find(p => p.id === programId);
        if (!prog) return;
        const m = prog.months?.[month] || { plan: 0, actual: 0, wpts_id: '' };
        document.getElementById('matrix-edit-program-id').value = programId;
        document.getElementById('matrix-edit-month').value = month;
        document.getElementById('matrix-edit-plan').value = m.plan;
        document.getElementById('matrix-edit-actual').value = m.actual;
        document.getElementById('matrix-edit-wpts').value = m.wpts_id || '';
        document.getElementById('matrix-edit-plan-date').value = m.plan_date || '';
        document.getElementById('matrix-edit-impl-date').value = m.impl_date || '';
        document.getElementById('matrix-edit-title').textContent = `Edit ${month.toUpperCase()} - ${prog.name}`;
        document.getElementById('matrix-edit-modal').style.display = 'flex';
    }

    function closeMatrixEditModal() { document.getElementById('matrix-edit-modal').style.display = 'none'; }

    async function submitMatrixEdit(e) {
        e.preventDefault();
        const programId = parseInt(document.getElementById('matrix-edit-program-id').value);
        const month = document.getElementById('matrix-edit-month').value;
        const plan = parseInt(document.getElementById('matrix-edit-plan').value) || 0;
        const actual = parseInt(document.getElementById('matrix-edit-actual').value) || 0;
        const wpts_id = document.getElementById('matrix-edit-wpts').value.trim();
        const plan_date = document.getElementById('matrix-edit-plan-date').value;
        const impl_date = document.getElementById('matrix-edit-impl-date').value;
        try {
            const res = await fetch(`${API_BASE}/matrix/${programId}/month/${month}?category=${currentMatrixCategory}&region=${currentMatrixRegion}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ plan, actual, wpts_id, plan_date, impl_date })
            });
            if (res.ok) {
                showToast('Matrix data updated!', 'success');
                closeMatrixEditModal();
                loadMatrixData();
            } else { showToast('Error updating matrix data', 'error'); }
        } catch (e) { showToast('Error connecting to server', 'error'); }
    }

    function openCreateMatrixModal() {
        document.getElementById('matrix-create-form').reset();
        document.getElementById('matrix-create-modal').style.display = 'flex';
    }

    function closeMatrixCreateModal() { document.getElementById('matrix-create-modal').style.display = 'none'; }

    async function submitNewMatrix(e) {
        e.preventDefault();
        const name = document.getElementById('matrix-new-name').value.trim();
        const reference = document.getElementById('matrix-new-reference').value.trim();
        const plan_type = document.getElementById('matrix-new-plan-type').value;
        if (!name) { showToast('Please enter a program name', 'error'); return; }
        try {
            const res = await fetch(`${API_BASE}/matrix?category=${currentMatrixCategory}&region=${currentMatrixRegion}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, reference, plan_type })
            });
            if (res.ok) {
                showToast('Matrix program created!', 'success');
                closeMatrixCreateModal();
                loadMatrixData();
            } else { showToast('Error creating matrix program', 'error'); }
        } catch (e) { showToast('Error connecting to server', 'error'); }
    }

    async function deleteMatrixProgram(programId) {
        if (!confirm('Are you sure you want to delete this matrix program?')) return;
        try {
            const res = await fetch(`${API_BASE}/matrix/${programId}?category=${currentMatrixCategory}&region=${currentMatrixRegion}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('Matrix program deleted', 'success');
                loadMatrixData();
            } else { showToast('Error deleting matrix program', 'error'); }
        } catch (e) { showToast('Error connecting to server', 'error'); }
    }

    function downloadMatrixReport() {
        let csv = 'No,Program Name,Reference,';
        csv += MONTH_LABELS.map(m => `${m}_Plan,${m}_Actual,${m}_WPTS`).join(',');
        csv += ',Progress\n';
        (matrixData.programs || []).forEach((prog, idx) => {
            csv += `${idx + 1},"${prog.name.replace(/"/g, '""')}","${(prog.reference || '').replace(/"/g, '""')}",`;
            MONTHS.forEach(month => {
                const m = prog.months?.[month] || { plan: 0, actual: 0, wpts_id: '' };
                csv += `${m.plan},${m.actual},"${(m.wpts_id || '').replace(/"/g, '""')}",`;
            });
            csv += `${prog.progress || 0}%\n`;
        });
        const categoryLabel = { audit: 'Audit', training: 'Training', drill: 'Drill', meeting: 'Meeting' }[currentMatrixCategory] || 'Matrix';
        const regionLabel = currentMatrixRegion === 'asia' ? 'Asia' : 'Indonesia';
        const baseLabel = currentMatrixBase !== 'all' ? `_${currentMatrixBase.charAt(0).toUpperCase() + currentMatrixBase.slice(1)}` : '';
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `HSE_Matrix_${categoryLabel}_${regionLabel}${baseLabel}_${matrixData.year}.csv`;
        link.click();
        showToast('Matrix report downloaded!', 'success');
    }

    // Expose Matrix functions to window
    window.loadMatrixData = loadMatrixData;
    window.changeMatrixCategory = changeMatrixCategory;
    window.changeMatrixRegion = changeMatrixRegion;
    window.changeMatrixBase = changeMatrixBase;
    window.changeMatrixYear = changeMatrixYear;
    window.filterMatrixPrograms = filterMatrixPrograms;
    window.toggleMatrixView = toggleMatrixView;
    window.openMatrixEditModal = openMatrixEditModal;
    window.closeMatrixEditModal = closeMatrixEditModal;
    window.submitMatrixEdit = submitMatrixEdit;
    window.openCreateMatrixModal = openCreateMatrixModal;
    window.closeMatrixCreateModal = closeMatrixCreateModal;
    window.submitNewMatrix = submitNewMatrix;
    window.deleteMatrixProgram = deleteMatrixProgram;
    window.downloadMatrixReport = downloadMatrixReport;


    // ===== ICON GALLERY & CRUD FUNCTIONS =====
    const HSE_ICONS = [
        // Safety & Hazard
        'üíÄ', '‚ö†Ô∏è', '‚ò†Ô∏è', 'üö®', 'üî¥', 'üü°', 'üü¢', '‚õî', 'üö´', '‚ùå',
        // Medical & Health
        'ü©π', 'üè•', 'ü©∫', 'üíâ', 'üíä', 'üß¨', 'ü¶†', 'ü´Å', 'ü´Ä', '‚ù§Ô∏è',
        '‚öïÔ∏è', 'ü§í', 'ü§ï', 'ü§¢', 'üò∑', 'üßë‚Äç‚öïÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üè®', 'üöë',
        // Fire & Emergency
        'üî•', 'üßØ', 'üöí', 'üß®', 'üí•', 'üí®', 'ÔøΩÔøΩÔ∏è', '‚ô®Ô∏è', 'üÜò', 'üìü',
        // Environment
        'üåø', 'üå±', 'üåç', 'üåä', 'üíß', 'üõ¢Ô∏è', '‚ôªÔ∏è', 'üóëÔ∏è', 'üå§Ô∏è', 'üåßÔ∏è',
        'üå™Ô∏è', '‚ö°', '‚òÄÔ∏è', 'üåô', 'üåà', 'üçÉ', 'üå≤', 'üèîÔ∏è', 'üèûÔ∏è', 'üåæ',
        // Vehicles & Transport
        'üöó', 'üöõ', 'üöö', 'üöú', 'üöß', 'üö¶', 'üö•', 'üõë', 'üõ£Ô∏è', '‚úàÔ∏è',
        'üö¢', '‚õµ', 'üöÅ', 'üèçÔ∏è', 'üö≤', '‚õΩ', 'üÖøÔ∏è', 'üöê', 'üöì', 'üöï',
        // Equipment & Tools
        'üîß', 'üî®', '‚öôÔ∏è', 'üî©', '‚õèÔ∏è', 'ü™õ', 'ü™ö', 'üîå', 'üí°', 'ÔøΩÔøΩ',
        'üî¨', 'üî≠', '‚öóÔ∏è', 'üß™', 'üß≤', 'ü™§', '‚öñÔ∏è', 'üéöÔ∏è', 'üéõÔ∏è', 'üìê',
        // PPE & Safety Equipment
        'ü¶∫', 'üë∑', 'ü•Ω', 'üò∑', 'üß§', 'ü•æ', 'ü™ñ', 'üõ°Ô∏è', 'üëì', 'üß•',
        // Documents & Admin
        'üìã', 'üìù', 'üìä', 'üìà', 'üìâ', 'üìë', 'üìÅ', 'üìÇ', 'üóÇÔ∏è', 'üóÉÔ∏è',
        'üìå', 'üìç', 'üîç', 'üîé', 'üìé', '‚úèÔ∏è', '‚úíÔ∏è', 'üìè', 'üìê', 'üóíÔ∏è',
        // People & Management
        'üëî', 'üë®‚Äçüíº', 'üë©‚Äçüíº', 'üßë‚Äçüíº', 'üë•', 'üë§', 'üßë‚Äçüè≠', 'üë∑‚Äç‚ôÇÔ∏è', 'üë∑‚Äç‚ôÄÔ∏è', 'üßë‚Äçüîß',
        // Communication
        'ÔøΩÔøΩ', 'üì£', 'üìû', 'üì±', 'üí¨', 'üìß', '‚úâÔ∏è', 'üì®', 'üîî', 'üîï',
        // Time & Schedule
        'üìÖ', 'üóìÔ∏è', '‚è∞', '‚è±Ô∏è', '‚è≤Ô∏è', 'üïê', 'üïë', 'üïí', 'üïì', 'üïî',
        // Achievement & Status
        '‚úÖ', '‚òëÔ∏è', '‚úîÔ∏è', '‚ùé', 'üéØ', 'üèÜ', 'üéñÔ∏è', 'üèÖ', '‚≠ê', 'üåü',
        'üíØ', 'üî∂', 'üî∑', 'üî∏', 'üîπ', '‚ñ∂Ô∏è', '‚è∏Ô∏è', '‚èπÔ∏è', 'üîÑ', 'üîÉ',
        // Buildings & Facilities
        'üè≠', 'üè¢', 'üèóÔ∏è', 'üè†', 'üèöÔ∏è', '‚õ∫', 'ÔøΩÔøΩÔ∏è', 'üåê', 'üóº', 'üèõÔ∏è',
        // Nature Hazards
        '‚ò¢Ô∏è', '‚ò£Ô∏è', '‚öõÔ∏è', 'üß´', 'üßø', 'üíé', 'ü™®', '‚õ∞Ô∏è', 'üåã', '‚ùÑÔ∏è'
    ];

    let iconGalleryCallback = null;
    let iconGalleryTarget = null;

    function openIconGallery(target) {
        iconGalleryTarget = target;
        const grid = document.getElementById('icon-gallery-grid');
        grid.innerHTML = HSE_ICONS.map(icon =>
            `<button onclick="selectIcon('${icon}')" style="width: 40px; height: 40px; font-size: 22px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-tertiary); cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='scale(1.1)';this.style.borderColor='var(--netflix-red)'" onmouseout="this.style.transform='scale(1)';this.style.borderColor='var(--border)'">${icon}</button>`
        ).join('');
        document.getElementById('icon-gallery-modal').classList.add('active');
    }

    function closeIconGallery() {
        document.getElementById('icon-gallery-modal').classList.remove('active');
    }

    function selectIcon(icon) {
        if (iconGalleryTarget === 'kpi') {
            document.getElementById('kpi-metric-icon-btn').textContent = icon;
        } else if (iconGalleryTarget === 'll') {
            document.getElementById('ll-indicator-icon-btn').textContent = icon;
        }
        closeIconGallery();
    }

    // ===== KPI CRUD =====
    function openAddKPIMetric() {
        document.getElementById('kpi-metric-modal-title').textContent = 'Add KPI Metric';
        document.getElementById('kpi-metric-icon-btn').textContent = 'üìä';
        document.getElementById('kpi-metric-name').value = '';
        document.getElementById('kpi-metric-id').value = '';
        document.getElementById('kpi-metric-delete-btn').style.display = 'none';
        document.getElementById('kpi-metric-modal').classList.add('active');
    }

    function openEditKPIMetric(key) {
        const yearData = kpiData[selectedKPIYear] || {};
        const metric = yearData[key];
        if (!metric) return;

        document.getElementById('kpi-metric-modal-title').textContent = 'Edit KPI Metric';
        const icons = { fatality: 'üíÄ', trir: 'ü©π', pvir: 'üöó', environment: 'üåø', fire: 'üî•', firstaid: 'ü©∫', occupational: '‚öïÔ∏è' };
        document.getElementById('kpi-metric-icon-btn').textContent = icons[key] || 'üìä';
        document.getElementById('kpi-metric-name').value = kpiLabels[key] || key;
        document.getElementById('kpi-metric-id').value = key;
        document.getElementById('kpi-metric-delete-btn').style.display = 'block';
        document.getElementById('kpi-metric-modal').classList.add('active');
    }

    function closeKPIMetricModal() {
        document.getElementById('kpi-metric-modal').classList.remove('active');
    }

    function saveKPIMetric() {
        const icon = document.getElementById('kpi-metric-icon-btn').textContent;
        const name = document.getElementById('kpi-metric-name').value.trim();
        const id = document.getElementById('kpi-metric-id').value;

        if (!name) { showToast('Please enter metric name', 'error'); return; }

        const key = id || name.toLowerCase().replace(/[^a-z0-9]/g, '_');

        if (!kpiData[selectedKPIYear]) kpiData[selectedKPIYear] = {};
        if (!kpiData[selectedKPIYear][key]) {
            kpiData[selectedKPIYear][key] = { kpi: 0, result: 0 };
        }

        kpiLabels[key] = name;
        // Store icon mapping (we'll need to persist this)
        if (!window.kpiIcons) window.kpiIcons = {};
        window.kpiIcons[key] = icon;

        closeKPIMetricModal();
        renderKPIDashboard();
        showToast(id ? 'Metric updated!' : 'Metric added!', 'success');
    }

    function deleteKPIMetric() {
        const id = document.getElementById('kpi-metric-id').value;
        if (!id) return;

        if (confirm('Delete this metric?')) {
            if (kpiData[selectedKPIYear]) delete kpiData[selectedKPIYear][id];
            delete kpiLabels[id];
            closeKPIMetricModal();
            renderKPIDashboard();
            showToast('Metric deleted!', 'success');
        }
    }

    // ===== LL CRUD =====
    function openAddLLIndicator(type) {
        document.getElementById('ll-indicator-modal-title').textContent = type === 'lagging' ? 'Add Lagging Indicator' : 'Add Leading Indicator';
        document.getElementById('ll-indicator-icon-btn').textContent = type === 'lagging' ? '‚ö†Ô∏è' : '‚úÖ';
        document.getElementById('ll-indicator-name').value = '';
        document.getElementById('ll-indicator-target').value = '';
        document.getElementById('ll-indicator-intent').value = '';
        document.getElementById('ll-indicator-id').value = '';
        document.getElementById('ll-indicator-type').value = type;
        document.getElementById('ll-indicator-delete-btn').style.display = 'none';
        document.getElementById('ll-indicator-modal').classList.add('active');
    }

    function openEditLLIndicator(type, id) {
        const indicators = llData[type] || [];
        const ind = indicators.find(i => i.id === id);
        if (!ind) return;

        document.getElementById('ll-indicator-modal-title').textContent = 'Edit ' + (type === 'lagging' ? 'Lagging' : 'Leading') + ' Indicator';
        document.getElementById('ll-indicator-icon-btn').textContent = ind.icon || 'üìä';
        document.getElementById('ll-indicator-name').value = ind.name || '';
        document.getElementById('ll-indicator-target').value = ind.target || '';
        document.getElementById('ll-indicator-intent').value = ind.intent || '';
        document.getElementById('ll-indicator-id').value = id;
        document.getElementById('ll-indicator-type').value = type;
        document.getElementById('ll-indicator-delete-btn').style.display = 'block';
        document.getElementById('ll-indicator-modal').classList.add('active');
    }

    function closeLLIndicatorModal() {
        document.getElementById('ll-indicator-modal').classList.remove('active');
    }

    function saveLLIndicator() {
        const icon = document.getElementById('ll-indicator-icon-btn').textContent;
        const name = document.getElementById('ll-indicator-name').value.trim();
        const target = document.getElementById('ll-indicator-target').value.trim();
        const intent = document.getElementById('ll-indicator-intent').value.trim();
        const id = document.getElementById('ll-indicator-id').value;
        const type = document.getElementById('ll-indicator-type').value;

        if (!name) { showToast('Please enter indicator name', 'error'); return; }

        if (!llData[type]) llData[type] = [];

        if (id) {
            const ind = llData[type].find(i => i.id === parseInt(id));
            if (ind) {
                ind.icon = icon;
                ind.name = name;
                ind.target = target;
                ind.intent = intent;
            }
        } else {
            const newId = Math.max(0, ...llData[type].map(i => i.id)) + 1;
            llData[type].push({ id: newId, name, icon, target, actual: '0', intent });
        }

        closeLLIndicatorModal();
        renderLLIndicator();
        showToast(id ? 'Indicator updated!' : 'Indicator added!', 'success');
    }

    function deleteLLIndicator() {
        const id = parseInt(document.getElementById('ll-indicator-id').value);
        const type = document.getElementById('ll-indicator-type').value;

        if (confirm('Delete this indicator?')) {
            llData[type] = (llData[type] || []).filter(i => i.id !== id);
            closeLLIndicatorModal();
            renderLLIndicator();
            showToast('Indicator deleted!', 'success');
        }
    }

    // Expose CRUD functions to window
    window.openIconGallery = openIconGallery;
    window.closeIconGallery = closeIconGallery;
    window.selectIcon = selectIcon;
    window.openAddKPIMetric = openAddKPIMetric;
    window.openEditKPIMetric = openEditKPIMetric;
    window.closeKPIMetricModal = closeKPIMetricModal;
    window.saveKPIMetric = saveKPIMetric;
    window.deleteKPIMetric = deleteKPIMetric;
    window.openAddLLIndicator = openAddLLIndicator;
    window.openEditLLIndicator = openEditLLIndicator;
    window.closeLLIndicatorModal = closeLLIndicatorModal;
    window.saveLLIndicator = saveLLIndicator;
    window.deleteLLIndicator = deleteLLIndicator;

    // ===== HSE ANNUAL PLAN MATRIX =====
    let annualPlanYear = new Date().getFullYear();

    function changeAnnualPlanYear(delta) {
        annualPlanYear += delta;
        document.getElementById('annual-plan-year').textContent = annualPlanYear;
        renderAnnualPlanMatrix();
    }

    function renderAnnualPlanMatrix() {
        const tbody = document.getElementById('annual-plan-body');
        if (!tbody) return;
        document.getElementById('annual-plan-year').textContent = annualPlanYear;
        let html = '';
        const programsWithTasks = allProjects.map(program => {
            const tasks = allTasks.filter(t => t.project_id == program.id);
            return { program, tasks };
        });
        if (programsWithTasks.length === 0) {
            html = '<tr><td colspan="25" style="padding: 20px; text-align: center; color: var(--text-muted);">No HSE Programs found.</td></tr>';
        } else {
            programsWithTasks.forEach(({ program, tasks }) => {
                html += '<tr style="background: var(--bg-tertiary);">';
                html += '<td style="padding: 8px; border: 1px solid var(--border); font-weight: 600; position: sticky; left: 0; background: var(--bg-tertiary);">üìÅ ' + (program.name || 'Unnamed') + '</td>';
                for (let m = 0; m < 12; m++) { html += '<td style="padding: 4px; border: 1px solid var(--border);"></td><td style="padding: 4px; border: 1px solid var(--border);"></td>'; }
                html += '</tr>';
                tasks.forEach(task => {
                    const planDates = calculateRecurringDates(task.implementation_date, task.frequency, annualPlanYear);
                    const isCompleted = task.status === 'Completed';
                    html += '<tr><td style="padding: 6px 8px 6px 20px; border: 1px solid var(--border); position: sticky; left: 0; background: var(--bg-secondary);">üìã ' + (task.code || '') + ' ' + (task.title || '').substring(0, 25) + '</td>';
                    for (let m = 0; m < 12; m++) {
                        const hasPlan = planDates.includes(m);
                        const hasActual = isCompleted && hasPlan;
                        html += '<td style="padding: 4px; border: 1px solid var(--border); text-align: center; background: ' + (hasPlan ? 'rgba(52,152,219,0.2)' : 'transparent') + ';">' + (hasPlan ? '<span style="color:#3498db;font-weight:600;">‚óè</span>' : '') + '</td>';
                        html += '<td style="padding: 4px; border: 1px solid var(--border); text-align: center; background: ' + (hasActual ? 'rgba(39,174,96,0.2)' : 'transparent') + ';">' + (hasActual ? '<span style="color:#27ae60;font-weight:600;">‚úì</span>' : '') + '</td>';
                    }
                    html += '</tr>';
                });
            });
        }
        tbody.innerHTML = html;
    }

    function calculateRecurringDates(startDate, frequency, year) {
        if (!startDate) return [];
        const start = new Date(startDate);
        const startMonth = start.getMonth();
        const startYear = start.getFullYear();
        if (startYear > year) return [];
        const months = [];
        switch (frequency) {
            case 'once': if (startYear === year) months.push(startMonth); break;
            case 'monthly': for (let m = (startYear === year ? startMonth : 0); m < 12; m++) months.push(m); break;
            case 'quarterly': for (let m = startMonth % 3; m < 12; m += 3) if (startYear < year || m >= startMonth) months.push(m); break;
            case 'semi-annual': for (let m = startMonth % 6; m < 12; m += 6) if (startYear < year || m >= startMonth) months.push(m); break;
            case 'annual': if (startYear <= year) months.push(startMonth); break;
            default: if (startYear === year) months.push(startMonth);
        }
        return months;
    }

    // Hook into loadData to refresh annual matrix
    const _origLoadData = loadData;
    loadData = async function () { await _origLoadData.apply(this, arguments); renderAnnualPlanMatrix(); };
</script>
</body>

</html>